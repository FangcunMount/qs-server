# ç”¨æˆ·ä½“ç³»åº”ç”¨æœåŠ¡å±‚ - å¿«é€Ÿå‚è€ƒ

## ğŸ“ ç›®å½•ç»“æ„

```
application/
â”œâ”€â”€ user/
â”‚   â”œâ”€â”€ creator.go              âœ… ç”¨æˆ·åˆ›å»ºå™¨
â”‚   â””â”€â”€ editor.go               âœ… ç”¨æˆ·ç¼–è¾‘å™¨
â”‚
â”œâ”€â”€ wechat/
â”‚   â”œâ”€â”€ account-creator.go      â­ å¾®ä¿¡è´¦å·åˆ›å»ºå™¨ (æ–°å¢)
â”‚   â”œâ”€â”€ authenticator.go        âœ… å¾®ä¿¡ç™»å½•è®¤è¯å™¨
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ role/                        â­ è§’è‰²ç®¡ç†æ¨¡å— (æ–°å¢)
    â”œâ”€â”€ testee-creator.go       â­ å—è¯•è€…åˆ›å»ºå™¨
    â”œâ”€â”€ auditor-creator.go      â­ å®¡æ ¸å‘˜åˆ›å»ºå™¨
    â””â”€â”€ writer-creator.go       â­ å¡«å†™äººåˆ›å»ºå™¨
```

## ğŸ¯ æ ¸å¿ƒæœåŠ¡

### 1ï¸âƒ£ UserCreator - ç”¨æˆ·åˆ›å»º

```go
userCreator := user.NewUserCreator(userRepo)
user, err := userCreator.CreateUser(ctx, username, password, nickname, email, phone, intro)
```

### 2ï¸âƒ£ UserEditor - ç”¨æˆ·ç¼–è¾‘

```go
userEditor := user.NewUserEditor(userRepo)
user, err := userEditor.UpdateBasicInfo(ctx, id, username, nickname, email, phone, avatar, intro)
```

### 3ï¸âƒ£ WechatAccountCreator - å¾®ä¿¡è´¦å·åˆ›å»º â­

```go
wxCreator := wechat.NewWechatAccountCreator(wxAccountRepo, appRepo)

// å°ç¨‹åºè´¦å·
wxAcc, err := wxCreator.CreateOrUpdateMiniProgramAccount(
    ctx, appID, openID, unionID, nickname, avatar, sessionKey,
)

// å…¬ä¼—å·è´¦å·
wxAcc, err := wxCreator.CreateOrUpdateOfficialAccount(
    ctx, appID, openID, unionID, nickname, avatar,
)
```

### 4ï¸âƒ£ TesteeCreator - å—è¯•è€…åˆ›å»º â­

```go
testeeCreator := role.NewTesteeCreator(testeeRepo)

// åˆ›å»º
testee, err := testeeCreator.CreateTestee(ctx, userID, name, sex, birthday)

// æ›´æ–°
testee, err := testeeCreator.UpdateTestee(ctx, userID, &name, &sex, &birthday)

// æŸ¥è¯¢
testee, err := testeeCreator.GetTesteeByUserID(ctx, userID)
exists := testeeCreator.TesteeExists(ctx, userID)
```

### 5ï¸âƒ£ AuditorCreator - å®¡æ ¸å‘˜åˆ›å»º â­

```go
auditorCreator := role.NewAuditorCreator(auditorRepo)

// åˆ›å»º
auditor, err := auditorCreator.CreateAuditor(
    ctx, userID, name, employeeID, department, position, hiredAt,
)

// çŠ¶æ€ç®¡ç†
err = auditorCreator.ActivateAuditor(ctx, userID)      // åœ¨èŒ
err = auditorCreator.SuspendAuditor(ctx, userID)       // åœèŒ
err = auditorCreator.ResignAuditor(ctx, userID)        // ç¦»èŒ
err = auditorCreator.SetAuditorOnLeave(ctx, userID)    // ä¼‘å‡

// æƒé™æ£€æŸ¥
canAudit, err := auditorCreator.CanAudit(ctx, userID)

// æŸ¥è¯¢
auditor, err := auditorCreator.GetAuditorByUserID(ctx, userID)
auditor, err := auditorCreator.GetAuditorByEmployeeID(ctx, employeeID)
```

### 6ï¸âƒ£ WriterCreator - å¡«å†™äººåˆ›å»º â­

```go
writerCreator := role.NewWriterCreator(writerRepo)

// åˆ›å»º
writer, err := writerCreator.CreateWriter(ctx, userID, name)

// æ›´æ–°
writer, err := writerCreator.UpdateWriter(ctx, userID, name)

// æŸ¥è¯¢
writer, err := writerCreator.GetWriterByUserID(ctx, userID)
```

## ğŸ”— Repository æ¥å£å®šä¹‰

### TesteeRepository

```go
type TesteeRepository interface {
    Save(ctx context.Context, testee *role.Testee) error
    Update(ctx context.Context, testee *role.Testee) error
    FindByUserID(ctx context.Context, userID user.UserID) (*role.Testee, error)
    ExistsByUserID(ctx context.Context, userID user.UserID) bool
}
```

### AuditorRepository

```go
type AuditorRepository interface {
    Save(ctx context.Context, auditor *role.Auditor) error
    Update(ctx context.Context, auditor *role.Auditor) error
    FindByUserID(ctx context.Context, userID user.UserID) (*role.Auditor, error)
    FindByEmployeeID(ctx context.Context, employeeID string) (*role.Auditor, error)
    ExistsByUserID(ctx context.Context, userID user.UserID) bool
    ExistsByEmployeeID(ctx context.Context, employeeID string) bool
}
```

### WriterRepository

```go
type WriterRepository interface {
    Save(ctx context.Context, writer *role.Writer) error
    Update(ctx context.Context, writer *role.Writer) error
    FindByUserID(ctx context.Context, userID user.UserID) (*role.Writer, error)
    ExistsByUserID(ctx context.Context, userID user.UserID) bool
}
```

## ğŸ“‹ å¸¸è§ä½¿ç”¨åœºæ™¯

### åœºæ™¯1: å°ç¨‹åºé¦–æ¬¡ç™»å½•

```go
// 1. åˆ›å»ºå¾®ä¿¡è´¦å·
wxAccount, _ := wxCreator.CreateOrUpdateMiniProgramAccount(...)

// 2. åˆ›å»ºç”¨æˆ·ï¼ˆå¦‚æœæ˜¯æ–°ç”¨æˆ·ï¼‰
if wxAccount.GetUserID().IsZero() {
    user, _ := userCreator.CreateUser(...)
    wxAccount.BindUser(user.ID())
}

// 3. åˆ›å»ºå—è¯•è€…è§’è‰²
testee, _ := testeeCreator.CreateTestee(ctx, user.ID(), name, sex, birthday)
```

### åœºæ™¯2: åˆ›å»ºå®¡æ ¸å‘˜

```go
// 1. åˆ›å»ºç”¨æˆ·
user, _ := userCreator.CreateUser(...)

// 2. åˆ›å»ºå®¡æ ¸å‘˜è§’è‰²
auditor, _ := auditorCreator.CreateAuditor(
    ctx, user.ID(), name, "EMP001", "å®¡æ ¸éƒ¨", "é«˜çº§å®¡æ ¸å‘˜", &hiredAt,
)

// 3. éªŒè¯æƒé™
canAudit, _ := auditorCreator.CanAudit(ctx, user.ID())
```

## âœ… æ€»ç»“

| æœåŠ¡ | çŠ¶æ€ | æ–‡ä»¶ |
|------|------|------|
| UserCreator | âœ… ä¿ç•™ | `application/user/creator.go` |
| UserEditor | âœ… ä¿ç•™ | `application/user/editor.go` |
| WechatAccountCreator | â­ æ–°å¢ | `application/wechat/account-creator.go` |
| TesteeCreator | â­ æ–°å¢ | `application/role/testee-creator.go` |
| AuditorCreator | â­ æ–°å¢ | `application/role/auditor-creator.go` |
| WriterCreator | â­ æ–°å¢ | `application/role/writer-creator.go` |

**æ–°å¢ä»£ç **: 569 è¡Œ
**ç¼–è¯‘çŠ¶æ€**: âœ… é€šè¿‡
