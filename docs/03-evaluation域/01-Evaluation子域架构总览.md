# 11-06-01 Evaluation å­åŸŸæ¶æ„æ€»è§ˆ

> **ç‰ˆæœ¬**ï¼šV2.0  
> **æœ€åæ›´æ–°**ï¼š2025-11-29  
> **çŠ¶æ€**ï¼šâœ… å·²å®ç°å¹¶éªŒè¯

---

## ğŸ“‹ æ–‡æ¡£å¯¼èˆª

**å½“å‰ä½ç½®**ï¼šæ¶æ„æ€»è§ˆï¼ˆä½ åœ¨è¿™é‡Œï¼‰  
**é˜…è¯»é¡ºåº**ï¼š

1. ğŸ‘‰ **æœ¬æ–‡æ¡£** - å…ˆç†è§£æ•´ä½“è®¾è®¡æ€æƒ³å’Œè¿è¡Œæœºåˆ¶
2. [11-06-02-Assessmentèšåˆè®¾è®¡](./11-06-02-Assessmentèšåˆè®¾è®¡.md) - å†æ·±å…¥èšåˆæ ¹å®ç°
3. [11-06-03-è®¡ç®—ç­–ç•¥è®¾è®¡](./11-06-03-Calculationè®¡ç®—ç­–ç•¥è®¾è®¡.md) - å­¦ä¹ ç­–ç•¥æ¨¡å¼åº”ç”¨
4. [11-06-04-è§£è¯»ç­–ç•¥è®¾è®¡](./11-06-04-Interpretationè§£è¯»ç­–ç•¥è®¾è®¡.md) - ç†è§£è§„åˆ™å¼•æ“è®¾è®¡
5. [11-06-05-æŠ¥å‘Šæ„å»ºè®¾è®¡](./11-06-05-Reportèšåˆè®¾è®¡.md) - æŒæ¡æŠ¥å‘Šç”Ÿæˆæœºåˆ¶

---

## ğŸ¯ æ ¸å¿ƒè®¾è®¡æ€æƒ³ï¼ˆ30ç§’é€Ÿè§ˆï¼‰

> **å¦‚æœåªæœ‰30ç§’ï¼Œä½ éœ€è¦çŸ¥é“è¿™äº›ï¼š**

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Evaluation å­åŸŸ = è¯„ä¼°å¼•æ“                                â”‚
â”‚                                                            â”‚
â”‚  è¾“å…¥ï¼šç­”å·æ•°æ® + é‡è¡¨è§„åˆ™                                 â”‚
â”‚   â†“                                                        â”‚
â”‚  å¤„ç†ï¼šè®¡ç®— â†’ è§£è¯» â†’ æŠ¥å‘Š                                 â”‚
â”‚   â†“                                                        â”‚
â”‚  è¾“å‡ºï¼šç»“æ„åŒ–æµ‹è¯„æŠ¥å‘Š                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ ¸å¿ƒè®¾è®¡æ¨¡å¼ï¼š
  âœ“ èšåˆæ¨¡å¼ - Assessment ç®¡æµç¨‹ï¼ŒReport ç®¡ç»“æœ
  âœ“ ç­–ç•¥æ¨¡å¼ - 8ç§è®¡ç®—ç­–ç•¥ + å¤šç§è§£è¯»ç­–ç•¥ï¼Œå¯æ’æ‹”
  âœ“ äº‹ä»¶é©±åŠ¨ - å¼‚æ­¥è¯„ä¼°ï¼Œè§£è€¦ä¸šåŠ¡æµç¨‹
  âœ“ å»ºé€ è€…æ¨¡å¼ - å¤æ‚å¯¹è±¡åˆ›å»ºè¿‡ç¨‹æ¸…æ™°å¯æ§
```

---

## ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ Evaluation å­åŸŸï¼Ÿï¼ˆé—®é¢˜åŸŸï¼‰

### 1.1 æˆ‘ä»¬è¦è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ

åœ¨å¿ƒç†æµ‹è¯„ä¸šåŠ¡ä¸­ï¼Œ**æ”¶é›†ç­”æ¡ˆåªæ˜¯ç¬¬ä¸€æ­¥**ï¼ŒçœŸæ­£çš„ä»·å€¼åœ¨äº**ä»ç­”æ¡ˆä¸­æå–æ´å¯Ÿ**ï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸šåŠ¡åœºæ™¯ï¼šå°æ˜å®Œæˆäº†"æŠ‘éƒè‡ªè¯„é‡è¡¨"çš„20é“é¢˜              â”‚
â”‚                                                             â”‚
â”‚  åŸå§‹æ•°æ®ï¼ˆæ— æ„ä¹‰ï¼‰ï¼š                                       â”‚
â”‚    Q1: é€‰äº† B (2åˆ†)                                        â”‚
â”‚    Q2: é€‰äº† C (3åˆ†)                                        â”‚
â”‚    ... å…±20é¢˜                                              â”‚
â”‚                                                             â”‚
â”‚  æœŸæœ›ç»“æœï¼ˆæœ‰æ„ä¹‰ï¼‰ï¼š                                       â”‚
â”‚    æ€»åˆ†ï¼š68 åˆ†                                             â”‚
â”‚    é£é™©ç­‰çº§ï¼šä¸­åº¦é£é™©                                      â”‚
â”‚    ç»“è®ºï¼šå­˜åœ¨æ˜æ˜¾æŠ‘éƒå€¾å‘ï¼Œå»ºè®®å¯»æ±‚ä¸“ä¸šå¸®åŠ©               â”‚
â”‚    ç»´åº¦åˆ†æï¼š                                               â”‚
â”‚      - è®¤çŸ¥å› å­ï¼š32åˆ†ï¼ˆé«˜é£é™©ï¼‰                           â”‚
â”‚      - æƒ…æ„Ÿå› å­ï¼š28åˆ†ï¼ˆä¸­é£é™©ï¼‰                           â”‚
â”‚      - èº¯ä½“å› å­ï¼š8åˆ†ï¼ˆä½é£é™©ï¼‰                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é—®é¢˜æ‹†è§£**ï¼š

| é—®é¢˜ | æŒ‘æˆ˜ | Evaluation çš„è§£å†³æ–¹æ¡ˆ |
|------|------|---------------------|
| å¦‚ä½•è®¡åˆ†ï¼Ÿ | ä¸åŒé‡è¡¨æœ‰ä¸åŒç®—æ³•ï¼ˆæ±‚å’Œã€åŠ æƒã€å¹³å‡...ï¼‰ | **ç­–ç•¥æ¨¡å¼** - 8ç§å¯æ‰©å±•è®¡ç®—ç­–ç•¥ |
| å¦‚ä½•è§£è¯»ï¼Ÿ | åˆ†æ•°éœ€è¦è½¬æ¢ä¸ºæœ‰æ„ä¹‰çš„ç»“è®º | **ç­–ç•¥æ¨¡å¼** - é˜ˆå€¼ã€ç»„åˆç­‰è§£è¯»ç­–ç•¥ |
| å¦‚ä½•ç®¡ç†æµç¨‹ï¼Ÿ | è¯„ä¼°è¿‡ç¨‹å¤æ‚ï¼ˆæäº¤â†’è®¡ç®—â†’è§£è¯»â†’æŠ¥å‘Šï¼‰ | **èšåˆæ¨¡å¼** - Assessment ç®¡ç†çŠ¶æ€æœº |
| å¦‚ä½•å­˜å‚¨ç»“æœï¼Ÿ | ç»“æ„åŒ–å¾—åˆ† + çµæ´»çš„æŠ¥å‘Šæ–‡æ¡£ | **æ··åˆå­˜å‚¨** - MySQL + MongoDB |
| å¦‚ä½•è§£è€¦ä¸šåŠ¡ï¼Ÿ | è¯„ä¼°è€—æ—¶ï¼Œä¸èƒ½é˜»å¡ä¸»æµç¨‹ | **äº‹ä»¶é©±åŠ¨** - å¼‚æ­¥è¯„ä¼° |

### 1.2 èŒè´£è¾¹ç•Œï¼ˆæˆ‘ç®¡ä»€ä¹ˆï¼Œæˆ‘ä¸ç®¡ä»€ä¹ˆï¼‰

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Evaluation å­åŸŸè¾¹ç•Œ                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  âœ… æˆ‘è´Ÿè´£çš„ï¼ˆæ ¸å¿ƒèŒè´£ï¼‰ï¼š                                  â”‚
â”‚    1. ç®¡ç†è¯„ä¼°æµç¨‹ï¼ˆPending â†’ Submitted â†’ Interpretedï¼‰   â”‚
â”‚    2. æ‰§è¡Œè®¡åˆ†è®¡ç®—ï¼ˆè°ƒåº¦è®¡ç®—ç­–ç•¥ï¼‰                         â”‚
â”‚    3. æ‰§è¡Œç»“æœè§£è¯»ï¼ˆè°ƒåº¦è§£è¯»ç­–ç•¥ï¼‰                         â”‚
â”‚    4. ç”Ÿæˆæµ‹è¯„æŠ¥å‘Šï¼ˆç»“æ„åŒ–å­˜å‚¨ + å¯¼å‡ºï¼‰                   â”‚
â”‚                                                             â”‚
â”‚  âŒ æˆ‘ä¸å…³å¿ƒçš„ï¼ˆå…¶ä»–å­åŸŸè´Ÿè´£ï¼‰ï¼š                            â”‚
â”‚    1. é—®å·é•¿ä»€ä¹ˆæ · â†’ Survey å­åŸŸ                           â”‚
â”‚    2. é‡è¡¨è§„åˆ™å¦‚ä½•é…ç½® â†’ Scale å­åŸŸ                        â”‚
â”‚    3. ç”¨æˆ·æ˜¯è° â†’ Actor å­åŸŸ                                â”‚
â”‚    4. ç­”å·å¦‚ä½•å¡«å†™ â†’ Survey å­åŸŸ                           â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€æ•´ä½“æ¶æ„è®¾è®¡ï¼ˆè§£å†³æ–¹æ¡ˆåŸŸï¼‰

### 2.1 å››å±‚æ¶æ„è§†å›¾

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Interface Layer (æ¥å£å±‚)                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ RESTful API  â”‚           â”‚   gRPC API   â”‚               â”‚
â”‚  â”‚  (Bç«¯ç®¡ç†)   â”‚           â”‚  (Cç«¯ç”¨æˆ·)   â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Application Layer (åº”ç”¨å±‚) - ç¼–æ’é¢†åŸŸå¯¹è±¡                  â”‚
â”‚         â†“                          â†“                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Evaluation   â”‚  â”‚ Submission   â”‚  â”‚ ReportQuery  â”‚      â”‚
â”‚  â”‚   Service    â”‚  â”‚   Service    â”‚  â”‚   Service    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Domain Layer (é¢†åŸŸå±‚) - ä¸šåŠ¡é€»è¾‘æ ¸å¿ƒ                       â”‚
â”‚         â†“                  â†“                  â†“              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  Assessment Aggregate (è¯„ä¼°èšåˆ)              â”‚         â”‚
â”‚  â”‚  - çŠ¶æ€æœºï¼šPending â†’ Submitted â†’ Interpreted  â”‚         â”‚
â”‚  â”‚  - å¾—åˆ†è®°å½•ï¼šScore Entity                     â”‚         â”‚
â”‚  â”‚  - äº‹ä»¶å‘å¸ƒï¼šAssessmentCreated...             â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  Report Aggregate (æŠ¥å‘Šèšåˆ)                  â”‚         â”‚
â”‚  â”‚  - ç»´åº¦è§£è¯»ï¼šDimensionInterpret Entity        â”‚         â”‚
â”‚  â”‚  - å»ºè®®ç”Ÿæˆï¼šSuggestion Value Object          â”‚         â”‚
â”‚  â”‚  - æŠ¥å‘Šå¯¼å‡ºï¼šExporter Strategy                 â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  Calculation   â”‚    â”‚ Interpretation â”‚                  â”‚
â”‚  â”‚  Domain Serviceâ”‚    â”‚ Domain Service â”‚                  â”‚
â”‚  â”‚  (ç­–ç•¥æ³¨å†Œå™¨)  â”‚    â”‚  (ç­–ç•¥æ³¨å†Œå™¨)  â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Infrastructure Layer (åŸºç¡€è®¾æ–½å±‚)                          â”‚
â”‚               â†“                   â†“                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  MySQL Storage   â”‚    â”‚ MongoDB Storage  â”‚              â”‚
â”‚  â”‚  - assessments   â”‚    â”‚ - reports é›†åˆ   â”‚              â”‚
â”‚  â”‚  - scores        â”‚    â”‚  (æ–‡æ¡£å­˜å‚¨)      â”‚              â”‚
â”‚  â”‚  (äº‹åŠ¡æ€§)        â”‚    â”‚  (çµæ´»æ€§)        â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è®¾è®¡è¦ç‚¹**ï¼š

1. **æ¥å£å±‚**ï¼šåŒåè®®æ”¯æŒï¼ˆRESTful åå°ç®¡ç† + gRPC Cç«¯æŸ¥è¯¢ï¼‰
2. **åº”ç”¨å±‚**ï¼šç¼–æ’å¤šä¸ªèšåˆï¼Œæ— ä¸šåŠ¡é€»è¾‘
3. **é¢†åŸŸå±‚**ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œèšåˆ + é¢†åŸŸæœåŠ¡
4. **åŸºç¡€è®¾æ–½å±‚**ï¼šæ··åˆå­˜å‚¨ï¼Œå„å–æ‰€é•¿

### 2.2 æ ¸å¿ƒç»„ä»¶ä¸èŒè´£

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç»„ä»¶                èŒè´£                     å­˜å‚¨ç­–ç•¥      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Assessment èšåˆ    ç®¡ç†è¯„ä¼°ç”Ÿå‘½å‘¨æœŸ          MySQL        â”‚
â”‚    - ID             å”¯ä¸€æ ‡è¯†                               â”‚
â”‚    - Status         çŠ¶æ€æœº                                 â”‚
â”‚    - Score Entity   å¾—åˆ†å®ä½“                               â”‚
â”‚    - Events         é¢†åŸŸäº‹ä»¶                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Report èšåˆ        ç®¡ç†æŠ¥å‘Šå†…å®¹              MongoDB      â”‚
â”‚    - Dimensions     ç»´åº¦è§£è¯»åˆ—è¡¨                           â”‚
â”‚    - Suggestions    å»ºè®®åˆ—è¡¨                               â”‚
â”‚    - Exporter       å¯¼å‡ºç­–ç•¥                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Calculation        æ‰§è¡Œè®¡åˆ†é€»è¾‘              æ— çŠ¶æ€       â”‚
â”‚    - 8ç§ç­–ç•¥        Sum/Average/Weighted...                â”‚
â”‚    - æ³¨å†Œå™¨æ¨¡å¼     åŠ¨æ€æ³¨å†Œå’ŒæŸ¥æ‰¾                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Interpretation     æ‰§è¡Œè§£è¯»é€»è¾‘              æ— çŠ¶æ€       â”‚
â”‚    - é˜ˆå€¼ç­–ç•¥       åŸºäºåˆ†æ•°åŒºé—´                           â”‚
â”‚    - ç»„åˆç­–ç•¥       å¤šå› å­æ¡ä»¶åˆ¤æ–­                         â”‚
â”‚    - æ³¨å†Œå™¨æ¨¡å¼     åŠ¨æ€æ³¨å†Œå’ŒæŸ¥æ‰¾                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 ä¸å…¶ä»–å­åŸŸçš„ä¾èµ–å…³ç³»

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¾èµ–æ–¹å‘ï¼šè‡ªåº•å‘ä¸Šï¼ˆEvaluation ä½äºé¡¶å±‚ï¼‰                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

     Survey å­åŸŸ                Scale å­åŸŸ              Actor å­åŸŸ
  (é—®å·&ç­”å·æ•°æ®)            (é‡è¡¨è§„åˆ™é…ç½®)           (ç”¨æˆ·ä¿¡æ¯)
         â†“                        â†“                       â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚              å¼•ç”¨å¯¹è±¡ï¼ˆReference Objectsï¼‰            â”‚
    â”‚  QuestionnaireRef  MedicalScaleRef  TesteeRef        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚            Evaluation å­åŸŸï¼ˆå½“å‰å­åŸŸï¼‰                   â”‚
    â”‚  - Assessment (æµ‹è¯„å®ä¾‹)                                â”‚
    â”‚  - Score (å¾—åˆ†)                                         â”‚
    â”‚  - Report (æŠ¥å‘Š)                                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
                      æ— å‘ä¸Šä¾èµ–
```

**ä¾èµ–è§„åˆ™**ï¼š

| è¢«ä¾èµ–å­åŸŸ | ä¾èµ–å†…å®¹ | è®¿é—®æ–¹å¼ | é˜²è…ç­–ç•¥ |
|----------|---------|---------|---------|
| Survey | é—®å·ç»“æ„ã€ç­”å·æ•°æ® | åªè¯»æŸ¥è¯¢ | ä½¿ç”¨ `QuestionnaireRef` + `AnswerSheetRef` |
| Scale | é‡è¡¨å®šä¹‰ã€è®¡ç®—è§„åˆ™ | åªè¯»æŸ¥è¯¢ | ä½¿ç”¨ `MedicalScaleRef` |
| Actor | å—è¯•è€…ä¿¡æ¯ | åªè¯»æŸ¥è¯¢ | ä½¿ç”¨ `TesteeRef` (testee.ID) |

### 2.4 é˜²è…å±‚è®¾è®¡ï¼ˆå¼•ç”¨å¯¹è±¡æ¨¡å¼ï¼‰

**ä¸ºä»€ä¹ˆä¸ç›´æ¥æŒæœ‰å…¶ä»–èšåˆï¼Ÿ**

```go
// âŒ é”™è¯¯åšæ³•ï¼šç›´æ¥ä¾èµ–å…¶ä»–å­åŸŸçš„èšåˆæ ¹
type Assessment struct {
    questionnaire *questionnaire.Questionnaire  // ç›´æ¥æŒæœ‰
    answerSheet   *answersheet.AnswerSheet      // ç›´æ¥æŒæœ‰
    medicalScale  *scale.MedicalScale           // ç›´æ¥æŒæœ‰
}
// é—®é¢˜ï¼š
// 1. å¼ºè€¦åˆï¼šä¿®æ”¹ questionnaire ç»“æ„ä¼šå½±å“ assessment
// 2. ç”Ÿå‘½å‘¨æœŸæ··ä¹±ï¼šquestionnaire çš„åŠ è½½å’ŒæŒä¹…åŒ–ä¸ assessment çº ç¼ 
// 3. äº‹åŠ¡è¾¹ç•Œä¸æ¸…ï¼šè·¨èšåˆäº‹åŠ¡éš¾ä»¥æ§åˆ¶
```

```go
// âœ… æ­£ç¡®åšæ³•ï¼šä½¿ç”¨å¼•ç”¨å¯¹è±¡ï¼ˆReferenceï¼‰
type Assessment struct {
    questionnaireRef QuestionnaireRef  // å€¼å¯¹è±¡ï¼šCode + Version
    answerSheetRef   AnswerSheetRef    // å€¼å¯¹è±¡ï¼šID
    medicalScaleRef  *MedicalScaleRef  // å€¼å¯¹è±¡ï¼šCodeï¼ˆå¯é€‰ï¼‰
}

// QuestionnaireRef é—®å·å¼•ç”¨å€¼å¯¹è±¡
type QuestionnaireRef struct {
    code    string  // é—®å·ç¼–ç 
    version string  // é—®å·ç‰ˆæœ¬
}

// ä»£ç ä½ç½®ï¼šinternal/apiserver/domain/evaluation/assessment/types.go
```

**ä¼˜åŠ¿**ï¼š

* âœ… **è§£è€¦**ï¼šåªå­˜å‚¨å¿…è¦çš„å¼•ç”¨ä¿¡æ¯ï¼Œä¸ä¾èµ–èšåˆæ ¹ç»“æ„
* âœ… **è½»é‡**ï¼šå€¼å¯¹è±¡æ˜“äºåºåˆ—åŒ–å’Œä¼ è¾“
* âœ… **ç‹¬ç«‹**ï¼šå¯ä»¥ç‹¬ç«‹éªŒè¯å¼•ç”¨çš„æœ‰æ•ˆæ€§
* âœ… **æ¸…æ™°**ï¼šæ˜ç¡®è·¨èšåˆè¾¹ç•Œï¼Œé¿å…äº‹åŠ¡è†¨èƒ€

---

## ä¸‰ã€æ ¸å¿ƒæµç¨‹è®¾è®¡ï¼ˆå®ƒå¦‚ä½•è¿è½¬ï¼Ÿï¼‰

### 3.1 è¯„ä¼°æµç¨‹å…¨æ™¯å›¾ï¼ˆç«¯åˆ°ç«¯ï¼‰

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ1: åˆ›å»ºæµ‹è¯„ï¼ˆåŒæ­¥ï¼Œå¿«é€Ÿå“åº”ï¼‰                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Actor: Bç«¯ç®¡ç†å‘˜ / Cç«¯ç”¨æˆ·                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  åˆ›å»ºè¯·æ±‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  éªŒè¯+åˆ›å»º  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Client  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚ SubmissionSvc â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚  Assessment  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚  (Pending)   â”‚  â”‚
â”‚                                                         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚           â”‚
â”‚                                                    å‘å¸ƒ AssessmentCreated  â”‚
â”‚                                                                â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ2: å¼‚æ­¥è¯„ä¼°ï¼ˆåå°å¤„ç†ï¼Œè€—æ—¶æ“ä½œï¼‰                         â”‚           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚           â”‚
â”‚  Actor: qs-worker (äº‹ä»¶æ¶ˆè´¹è€…)                                 â†“           â”‚
â”‚                                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  ç›‘å¬äº‹ä»¶  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   EventBus        â”‚    â”‚
â”‚  â”‚qs-worker â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  EventBus     â”‚      â”‚   (RabbitMQ/      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚    NSQç­‰)         â”‚    â”‚
â”‚       â”‚                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚       â”‚ è°ƒç”¨                                                               â”‚
â”‚       â†“                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  EvaluationService.Evaluate(assessmentID)                   â”‚         â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚         â”‚
â”‚  â”‚                                                              â”‚         â”‚
â”‚  â”‚  æ­¥éª¤1: åŠ è½½æ•°æ®                                             â”‚         â”‚
â”‚  â”‚    â”œâ”€ Assessment (MySQL)                                   â”‚         â”‚
â”‚  â”‚    â”œâ”€ MedicalScale (MySQL)                                 â”‚         â”‚
â”‚  â”‚    â””â”€ AnswerSheet (é€šè¿‡ Survey å­åŸŸæ¥å£)                  â”‚         â”‚
â”‚  â”‚                                                              â”‚         â”‚
â”‚  â”‚  æ­¥éª¤2: è®¡ç®—åˆ†æ•° â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“                        â”‚         â”‚
â”‚  â”‚    for each Factor:                â”ƒ                        â”‚         â”‚
â”‚  â”‚      â”œâ”€ æå–é¢˜ç›®ç­”æ¡ˆ               â”ƒ ç­–ç•¥æ¨¡å¼              â”‚         â”‚
â”‚  â”‚      â”œâ”€ é€‰æ‹©è®¡ç®—ç­–ç•¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”ƒ Calculation          â”‚         â”‚
â”‚  â”‚      â”‚   (Sum/Average/Weighted)   â”ƒ Strategy Registry    â”‚         â”‚
â”‚  â”‚      â””â”€ è®¡ç®—å› å­å¾—åˆ†               â”ƒ                        â”‚         â”‚
â”‚  â”‚                                     â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚         â”‚
â”‚  â”‚  æ­¥éª¤3: ç”Ÿæˆè§£è¯» â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“                        â”‚         â”‚
â”‚  â”‚    for each FactorScore:           â”ƒ                        â”‚         â”‚
â”‚  â”‚      â”œâ”€ é€‰æ‹©è§£è¯»ç­–ç•¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”ƒ ç­–ç•¥æ¨¡å¼              â”‚         â”‚
â”‚  â”‚      â”‚   (Threshold/Composite)    â”ƒ Interpretation       â”‚         â”‚
â”‚  â”‚      â””â”€ ç”Ÿæˆè§£è¯»æ–‡æœ¬               â”ƒ Strategy Registry    â”‚         â”‚
â”‚  â”‚                                     â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚         â”‚
â”‚  â”‚  æ­¥éª¤4: æ„å»ºæŠ¥å‘Š â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“                        â”‚         â”‚
â”‚  â”‚    ReportBuilder                   â”ƒ å»ºé€ è€…æ¨¡å¼            â”‚         â”‚
â”‚  â”‚      .WithScale(...)               â”ƒ                        â”‚         â”‚
â”‚  â”‚      .WithTotalScore(...)          â”ƒ                        â”‚         â”‚
â”‚  â”‚      .AddDimension(...)            â”ƒ                        â”‚         â”‚
â”‚  â”‚      .AddSuggestion(...)           â”ƒ                        â”‚         â”‚
â”‚  â”‚      .Build()                      â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚         â”‚
â”‚  â”‚                                                              â”‚         â”‚
â”‚  â”‚  æ­¥éª¤5: æŒä¹…åŒ–                                               â”‚         â”‚
â”‚  â”‚    â”œâ”€ Update Assessment.Status â†’ Interpreted              â”‚         â”‚
â”‚  â”‚    â”œâ”€ Save Scores â†’ MySQL                                 â”‚         â”‚
â”‚  â”‚    â””â”€ Save Report â†’ MongoDB                               â”‚         â”‚
â”‚  â”‚                                                              â”‚         â”‚
â”‚  â”‚  æ­¥éª¤6: å‘å¸ƒäº‹ä»¶                                             â”‚         â”‚
â”‚  â”‚    â””â”€ Publish EvaluationCompletedEvent                    â”‚         â”‚
â”‚  â”‚                                                              â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ3: ç»“æœæŸ¥è¯¢ï¼ˆå¿«é€Ÿå“åº”ï¼‰                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Actor: Bç«¯ç®¡ç†å‘˜ / Cç«¯ç”¨æˆ·                                               â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  æŸ¥è¯¢è¯·æ±‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   è¯»å–   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Client  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ QueryService â”‚ â”€â”€â”€â”€â”€â”€â”€â†’ â”‚   Report     â”‚      â”‚
â”‚  â”‚         â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€ â”‚              â”‚ â†â”€â”€â”€â”€â”€â”€â”€ â”‚  (MongoDB)   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  è¿”å›æŠ¥å‘Š  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä»£ç å…¥å£**ï¼š

* åˆ›å»ºæµ‹è¯„ï¼š`internal/apiserver/application/evaluation/assessment/submission_service.go`
* å¼‚æ­¥è¯„ä¼°ï¼š`internal/apiserver/application/evaluation/assessment/evaluation_service.go`
* æŸ¥è¯¢æŠ¥å‘Šï¼š`internal/apiserver/application/evaluation/report/query_service.go`

### 3.2 Assessment çŠ¶æ€æœºè®¾è®¡

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Assessment ç”Ÿå‘½å‘¨æœŸçŠ¶æ€æœº                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Pending â”‚ å¾…æäº¤ï¼ˆåˆå§‹çŠ¶æ€ï¼‰
     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
          â”‚
          â”‚ Submit() - æäº¤æµ‹è¯„
          â”‚ è§¦å‘ï¼šAssessmentCreatedEvent
          â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Submitted â”‚ å·²æäº¤ï¼ˆç­‰å¾…è¯„ä¼°ï¼‰
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ StartEvaluation() - å¼€å§‹è¯„ä¼°ï¼ˆå¼‚æ­¥ï¼‰
         â”‚ ç”± qs-worker è§¦å‘
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Evaluating â”‚ è¯„ä¼°ä¸­
    â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜
      â”‚        â”‚
      â”‚        â”‚ MarkAsFailed() - æ ‡è®°å¤±è´¥
      â”‚        â”‚ åŸå› ï¼šè®¡ç®—é”™è¯¯ã€è§£è¯»å¤±è´¥ç­‰
      â”‚        â†“
      â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚    â”‚ Failed â”‚ å¤±è´¥ï¼ˆç»ˆæ€ï¼‰
      â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚    äº‹ä»¶ï¼šEvaluationFailedEvent
      â”‚
      â”‚ ApplyEvaluation() - åº”ç”¨è¯„ä¼°ç»“æœ
      â”‚ è®°å½•ï¼štotalScore + riskLevel
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Interpreted â”‚ å·²è§£è¯»ï¼ˆç»ˆæ€ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
äº‹ä»¶ï¼šEvaluationCompletedEvent
```

**çŠ¶æ€è½¬æ¢è§„åˆ™**ï¼ˆä»£ç ä½ç½®ï¼š`internal/apiserver/domain/evaluation/assessment/types.go`ï¼‰ï¼š

```go
// Status çŠ¶æ€æšä¸¾
type Status string

const (
    StatusPending     Status = "pending"      // å¾…æäº¤
    StatusSubmitted   Status = "submitted"    // å·²æäº¤
    StatusInterpreted Status = "interpreted"  // å·²è§£è¯»
    StatusFailed      Status = "failed"       // å¤±è´¥
)

// çŠ¶æ€è½¬æ¢æ–¹æ³•ï¼ˆéƒ¨åˆ†ä¼ªä»£ç ï¼‰
func (a *Assessment) Submit() error {
    if a.status != StatusPending {
        return errors.New("åªæœ‰ Pending çŠ¶æ€æ‰èƒ½æäº¤")
    }
    a.status = StatusSubmitted
    a.submittedAt = time.Now()
    a.addEvent(NewAssessmentCreatedEvent(...))
    return nil
}

func (a *Assessment) ApplyEvaluation(result *EvaluationResult) error {
    if a.status != StatusSubmitted {
        return errors.New("åªæœ‰ Submitted çŠ¶æ€æ‰èƒ½åº”ç”¨è¯„ä¼°ç»“æœ")
    }
    a.status = StatusInterpreted
    a.totalScore = result.TotalScore
    a.riskLevel = result.RiskLevel
    a.interpretedAt = time.Now()
    a.addEvent(NewEvaluationCompletedEvent(...))
    return nil
}

func (a *Assessment) MarkAsFailed(reason string) {
    a.status = StatusFailed
    a.failureReason = &reason
    a.failedAt = time.Now()
    a.addEvent(NewEvaluationFailedEvent(...))
}
```

---

## å››ã€æ ¸å¿ƒèšåˆè®¾è®¡

### 4.1 Assessment èšåˆæ€»è§ˆ

Evaluation å­åŸŸåŒ…å«å››ä¸ªæ ¸å¿ƒé¢†åŸŸæ¦‚å¿µï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Evaluation å­åŸŸ                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           â‘  Assessment èšåˆï¼ˆæµ‹è¯„å®ä¾‹ï¼‰              â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  èŒè´£ï¼šç®¡ç†æµ‹è¯„ç”Ÿå‘½å‘¨æœŸã€è®°å½•è¯„ä¼°ç»“æœ               â”‚   â”‚
â”‚  â”‚  çŠ¶æ€ï¼šPending â†’ Submitted â†’ Interpreted / Failed   â”‚   â”‚
â”‚  â”‚  å­˜å‚¨ï¼šMySQLï¼ˆå…³ç³»å‹ï¼Œæ”¯æŒå¤æ‚æŸ¥è¯¢ï¼‰                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                      â”‚ åè°ƒ                                 â”‚
â”‚                      â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚      â‘¡ Calculation é¢†åŸŸæœåŠ¡ï¼ˆè®¡ç®—ç­–ç•¥æ—ï¼‰            â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  èŒè´£ï¼šå°†ç­”æ¡ˆè½¬åŒ–ä¸ºåˆ†æ•°                             â”‚   â”‚
â”‚  â”‚  ç­–ç•¥ï¼šæ±‚å’Œã€å¹³å‡ã€åŠ æƒå’Œã€æå€¼ã€è®¡æ•°ç­‰             â”‚   â”‚
â”‚  â”‚  æ¨¡å¼ï¼šç­–ç•¥æ¨¡å¼ + æ³¨å†Œå™¨æ¨¡å¼                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                      â”‚                                       â”‚
â”‚                      â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚    â‘¢ Interpretation é¢†åŸŸæœåŠ¡ï¼ˆè§£è¯»ç­–ç•¥æ—ï¼‰           â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  èŒè´£ï¼šå°†åˆ†æ•°è½¬åŒ–ä¸ºä¸šåŠ¡ç»“è®º                         â”‚   â”‚
â”‚  â”‚  ç­–ç•¥ï¼šé˜ˆå€¼è§£è¯»ã€å¤åˆæ¡ä»¶è§£è¯»                       â”‚   â”‚
â”‚  â”‚  æ¨¡å¼ï¼šç­–ç•¥æ¨¡å¼ + æ³¨å†Œå™¨æ¨¡å¼                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                      â”‚                                       â”‚
â”‚                      â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         â‘£ Report èšåˆï¼ˆè§£è¯»æŠ¥å‘Šï¼‰                    â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  èŒè´£ï¼šç»“æ„åŒ–å­˜å‚¨è§£è¯»ç»“æœã€æ”¯æŒå¤šæ ¼å¼å¯¼å‡º           â”‚   â”‚
â”‚  â”‚  å†…å®¹ï¼šç»´åº¦è§£è¯»ã€å»ºè®®åˆ—è¡¨ã€é£é™©ç­‰çº§                 â”‚   â”‚
â”‚  â”‚  å­˜å‚¨ï¼šMongoDBï¼ˆæ–‡æ¡£å‹ï¼Œçµæ´»ç»“æ„ï¼‰                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒèšåˆè¯¦è§£

#### 2.2.1 Assessment èšåˆï¼ˆæµ‹è¯„å®ä¾‹ï¼‰

**æ ¸å¿ƒèŒè´£**ï¼šè®°å½•"ä¸€æ¬¡å…·ä½“çš„æµ‹è¯„è¡Œä¸º"

```go
// ä¼ªä»£ç ï¼šAssessment èšåˆæ ¹
type Assessment struct {
    // èº«ä»½æ ‡è¯†
    ID        ID
    OrgID     int64
    
    // å…³è”å®ä½“å¼•ç”¨
    TesteeRef        testee.ID         // è°åšçš„æµ‹è¯„ï¼Ÿ
    QuestionnaireRef QuestionnaireRef  // ç”¨ä»€ä¹ˆé—®å·ï¼Ÿ
    AnswerSheetRef   AnswerSheetRef    // ç­”å·åœ¨å“ªé‡Œï¼Ÿ
    MedicalScaleRef  *MedicalScaleRef  // ç”¨ä»€ä¹ˆé‡è¡¨ï¼Ÿï¼ˆå¯é€‰ï¼‰
    
    // ä¸šåŠ¡æ¥æº
    Origin Origin  // adhocï¼ˆä¸€æ¬¡æ€§ï¼‰| planï¼ˆæµ‹è¯„è®¡åˆ’ï¼‰| screeningï¼ˆå…¥æ ¡ç­›æŸ¥ï¼‰
    
    // çŠ¶æ€ä¸ç»“æœ
    Status     Status      // pending â†’ submitted â†’ interpreted / failed
    TotalScore *float64    // æ€»åˆ†ï¼ˆè¯„ä¼°åå¡«å……ï¼‰
    RiskLevel  *RiskLevel  // é£é™©ç­‰çº§ï¼ˆè¯„ä¼°åå¡«å……ï¼‰
    
    // æ—¶é—´æˆ³
    CreatedAt     time.Time
    SubmittedAt   *time.Time
    InterpretedAt *time.Time
    FailedAt      *time.Time
    
    // é¢†åŸŸäº‹ä»¶
    Events []DomainEvent
}
```

**ä»£ç ä½ç½®**ï¼š[`assessment/assessment.go`](../../../internal/apiserver/domain/evaluation/assessment/assessment.go)

**çŠ¶æ€æœº**ï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   Submit()   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   ApplyEvaluation()   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pending  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Submitted  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Interpreted  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ MarkAsFailed()
                               â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚  Failed  â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®è®¾è®¡**ï¼š

* âœ… ä½¿ç”¨**å€¼å¯¹è±¡å¼•ç”¨**ï¼ˆQuestionnaireRefã€AnswerSheetRefï¼‰è€Œéç›´æ¥æŒæœ‰å¯¹è±¡ï¼Œä¿æŒèšåˆè¾¹ç•Œ
* âœ… çŠ¶æ€æœºä¿è¯çŠ¶æ€è¿ç§»åˆæ³•æ€§ï¼ˆåªèƒ½å•å‘æµè½¬ï¼‰
* âœ… å‘å¸ƒé¢†åŸŸäº‹ä»¶ï¼ˆAssessmentSubmittedEventã€AssessmentInterpretedEventï¼‰é©±åŠ¨å¼‚æ­¥è¯„ä¼°

#### 2.2.2 Calculation é¢†åŸŸæœåŠ¡ï¼ˆè®¡ç®—ç­–ç•¥ï¼‰

**æ ¸å¿ƒèŒè´£**ï¼šå°†ç­”æ¡ˆè½¬åŒ–ä¸ºåˆ†æ•°

```go
// ä¼ªä»£ç ï¼šè®¡ç®—ç­–ç•¥æ¥å£
type CalculationStrategy interface {
    Calculate(values []float64, params map[string]string) (float64, error)
    StrategyType() StrategyType
}

// å†…ç½®ç­–ç•¥
- SumStrategy        // æ±‚å’Œï¼šâˆ‘values
- AverageStrategy    // å¹³å‡ï¼šâˆ‘values / len(values)
- WeightedSumStrategy // åŠ æƒå’Œï¼šâˆ‘(values[i] * weights[i])
- MaxStrategy        // æœ€å¤§å€¼ï¼šmax(values)
- MinStrategy        // æœ€å°å€¼ï¼šmin(values)
- CountStrategy      // è®¡æ•°ï¼šlen(values)
- FirstValueStrategy // é¦–å€¼ï¼švalues[0]
```

**ä»£ç ä½ç½®**ï¼š[`calculation/strategy.go`](../../../internal/apiserver/domain/evaluation/calculation/strategy.go)

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```go
// è·å–ç­–ç•¥å¹¶è®¡ç®—
strategy := calculation.GetStrategy(calculation.TypeSum)
score, err := strategy.Calculate([]float64{1, 2, 3}, nil)
// score = 6
```

**è®¾è®¡æ¨¡å¼**ï¼š

* âœ… **ç­–ç•¥æ¨¡å¼**ï¼šå°è£…ç®—æ³•æ—ï¼Œè¿è¡Œæ—¶åŠ¨æ€é€‰æ‹©
* âœ… **æ³¨å†Œå™¨æ¨¡å¼**ï¼šæ”¯æŒåŠ¨æ€æ³¨å†Œè‡ªå®šä¹‰ç­–ç•¥

#### 2.2.3 Interpretation é¢†åŸŸæœåŠ¡ï¼ˆè§£è¯»ç­–ç•¥ï¼‰

**æ ¸å¿ƒèŒè´£**ï¼šå°†åˆ†æ•°è½¬åŒ–ä¸ºä¸šåŠ¡ç»“è®º

```go
// ä¼ªä»£ç ï¼šè§£è¯»ç­–ç•¥æ¥å£
type InterpretationStrategy interface {
    Interpret(score float64, config *InterpretConfig) (*InterpretResult, error)
    StrategyType() StrategyType
}

// å†…ç½®ç­–ç•¥
- ThresholdStrategy  // é˜ˆå€¼ç­–ç•¥ï¼šæ ¹æ®åˆ†æ•°åŒºé—´è§£è¯»
- CompositeStrategy  // å¤åˆç­–ç•¥ï¼šå¤šç»´åº¦æ¡ä»¶ç»„åˆ
```

**ä»£ç ä½ç½®**ï¼š[`interpretation/strategy.go`](../../../internal/apiserver/domain/evaluation/interpretation/strategy.go)

**é˜ˆå€¼ç­–ç•¥ç¤ºä¾‹**ï¼š

```go
// é…ç½®è§£è¯»è§„åˆ™
config := &InterpretConfig{
    Ranges: []ScoreRange{
        {Min: 0, Max: 50, Level: "æ­£å¸¸", Conclusion: "çŠ¶æ€è‰¯å¥½"},
        {Min: 51, Max: 70, Level: "è½»åº¦", Conclusion: "éœ€è¦å…³æ³¨"},
        {Min: 71, Max: 100, Level: "é‡åº¦", Conclusion: "å»ºè®®å¹²é¢„"},
    },
}

// æ‰§è¡Œè§£è¯»
strategy := interpretation.GetStrategy(interpretation.TypeThreshold)
result, err := strategy.Interpret(65, config)
// result: { Level: "è½»åº¦", Conclusion: "éœ€è¦å…³æ³¨" }
```

**è®¾è®¡æ¨¡å¼**ï¼š

* âœ… **ç­–ç•¥æ¨¡å¼**ï¼šå°è£…è§£è¯»è§„åˆ™ï¼Œæ”¯æŒå¤šç§è§£è¯»æ–¹å¼
* âœ… **å¤åˆæ¡ä»¶æ¨¡å¼**ï¼šæ”¯æŒ AND/OR é€»è¾‘ç»„åˆ

#### 2.2.4 Report èšåˆï¼ˆè§£è¯»æŠ¥å‘Šï¼‰

**æ ¸å¿ƒèŒè´£**ï¼šç»“æ„åŒ–å­˜å‚¨è§£è¯»ç»“æœ

```go
// ä¼ªä»£ç ï¼šReport èšåˆæ ¹
type InterpretReport struct {
    ID       ID  // ä¸ AssessmentID ä¸€è‡´
    
    // é‡è¡¨ä¿¡æ¯
    ScaleName string
    ScaleCode string
    
    // è¯„ä¼°ç»“æœæ±‡æ€»
    TotalScore float64
    RiskLevel  RiskLevel
    Conclusion string
    
    // ç»´åº¦è§£è¯»åˆ—è¡¨
    Dimensions []DimensionInterpret {
        FactorCode  string   // å› å­ç¼–ç 
        FactorName  string   // å› å­åç§°
        Score       float64  // å› å­å¾—åˆ†
        Level       string   // é£é™©ç­‰çº§
        Conclusion  string   // å› å­ç»“è®º
    }
    
    // å»ºè®®åˆ—è¡¨
    Suggestions []string
    
    // æ—¶é—´æˆ³
    CreatedAt time.Time
    UpdatedAt *time.Time
}
```

**ä»£ç ä½ç½®**ï¼š[`report/report.go`](../../../internal/apiserver/domain/evaluation/report/report.go)

**è®¾è®¡å†³ç­–**ï¼š

* âœ… ä½¿ç”¨ MongoDB å­˜å‚¨ï¼ˆçµæ´»çš„æ–‡æ¡£ç»“æ„ï¼Œé€‚åˆè§£è¯»æŠ¥å‘Šçš„å¤šæ ·æ€§ï¼‰
* âœ… ä¸ Assessment 1:1 å…³ç³»ï¼ˆID ä¸ AssessmentID ä¸€è‡´ï¼‰
* âœ… åˆ†ç¦»å­˜å‚¨ï¼ˆAssessment å…³æ³¨æµç¨‹çŠ¶æ€ï¼ŒReport å…³æ³¨å†…å®¹å‘ˆç°ï¼‰

---

## 3. æ¶æ„åˆ†å±‚è®¾è®¡

### 3.1 å…­è¾¹å½¢æ¶æ„è§†å›¾

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Interface Layer                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ REST Handler â”‚  â”‚ gRPC Service â”‚  â”‚ Event Handlerâ”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚                  â”‚
          â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Application Layer                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚EvaluationService â”‚  â”‚ ReportExportSvc  â”‚  â”‚ QueryService â”‚  â”‚
â”‚  â”‚ (æµ‹è¯„è¯„ä¼°ç¼–æ’)    â”‚  â”‚  (æŠ¥å‘Šå¯¼å‡º)      â”‚  â”‚  (æŸ¥è¯¢èšåˆ)  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚  åè°ƒé¢†åŸŸæœåŠ¡         â”‚                    â”‚
            â–¼                     â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Domain Layer                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Assessment èšåˆ                                         â”‚   â”‚
â”‚  â”‚  â”œâ”€ Assessment (èšåˆæ ¹)                                 â”‚   â”‚
â”‚  â”‚  â”œâ”€ Score (å®ä½“)                                        â”‚   â”‚
â”‚  â”‚  â”œâ”€ AssessmentCreator (åˆ›å»ºå™¨ - Builder æ¨¡å¼)          â”‚   â”‚
â”‚  â”‚  â””â”€ AssessmentRepository (ä»“å‚¨æ¥å£)                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Calculation é¢†åŸŸæœåŠ¡                                    â”‚   â”‚
â”‚  â”‚  â”œâ”€ CalculationStrategy (ç­–ç•¥æ¥å£)                      â”‚   â”‚
â”‚  â”‚  â”œâ”€ SumStrategy / AverageStrategy / ...                 â”‚   â”‚
â”‚  â”‚  â””â”€ StrategyRegistry (æ³¨å†Œå™¨)                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Interpretation é¢†åŸŸæœåŠ¡                                 â”‚   â”‚
â”‚  â”‚  â”œâ”€ InterpretationStrategy (ç­–ç•¥æ¥å£)                   â”‚   â”‚
â”‚  â”‚  â”œâ”€ ThresholdStrategy / CompositeStrategy               â”‚   â”‚
â”‚  â”‚  â””â”€ StrategyRegistry (æ³¨å†Œå™¨)                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Report èšåˆ                                             â”‚   â”‚
â”‚  â”‚  â”œâ”€ InterpretReport (èšåˆæ ¹)                            â”‚   â”‚
â”‚  â”‚  â”œâ”€ DimensionInterpret (å®ä½“)                           â”‚   â”‚
â”‚  â”‚  â”œâ”€ ReportBuilder (æ„å»ºå™¨ - Builder æ¨¡å¼)              â”‚   â”‚
â”‚  â”‚  â”œâ”€ ReportExporter (å¯¼å‡ºå™¨ - Strategy æ¨¡å¼)            â”‚   â”‚
â”‚  â”‚  â””â”€ ReportRepository (ä»“å‚¨æ¥å£)                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Infrastructure Layer                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚MySQL Repository  â”‚  â”‚MongoDB Repositoryâ”‚  â”‚ Event Bus    â”‚  â”‚
â”‚  â”‚(Assessment/Score)â”‚  â”‚     (Report)     â”‚  â”‚  (Kafka)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 åˆ†å±‚èŒè´£è¯´æ˜

| å±‚çº§ | èŒè´£ | å…³é”®ç±» |
|-----|------|--------|
| **Interface** | åè®®é€‚é…ï¼ˆREST/gRPC/Eventï¼‰ | AssessmentHandlerã€ReportHandler |
| **Application** | ä¸šåŠ¡æµç¨‹ç¼–æ’ã€äº‹åŠ¡è¾¹ç•Œç®¡ç† | EvaluationServiceã€QueryService |
| **Domain** | æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€é¢†åŸŸè§„åˆ™ | Assessmentã€Calculationã€Interpretationã€Report |
| **Infrastructure** | æŒä¹…åŒ–ã€æ¶ˆæ¯é˜Ÿåˆ—ã€å¤–éƒ¨æœåŠ¡ | MySQLRepositoryã€MongoRepositoryã€EventBus |

---

## 4. æ ¸å¿ƒæµç¨‹è®¾è®¡

### 4.1 æµ‹è¯„è¯„ä¼°å®Œæ•´æµç¨‹

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                      
â”‚  User   â”‚                                                      
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                      
     â”‚ 1. æäº¤ç­”å·                                              
     â–¼                                                           
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             
â”‚ Interface Layer â”‚                                             
â”‚  (REST API)     â”‚                                             
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             
         â”‚ 2. è°ƒç”¨åˆ›å»ºæµ‹è¯„æœåŠ¡                                   
         â–¼                                                       
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     
â”‚   Application Layer     â”‚                                     
â”‚  SubmissionService      â”‚                                     
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     
         â”‚ 3. éªŒè¯ & åˆ›å»º Assessment                            
         â–¼                                                       
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     
â”‚      Domain Layer       â”‚                                     
â”‚  AssessmentCreator      â”‚                                     
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     
         â”‚ 4. çŠ¶æ€ï¼šPending â†’ Submitted                         
         â”‚ 5. å‘å¸ƒ AssessmentSubmittedEvent                     
         â–¼                                                       
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     
â”‚  Infrastructure Layer   â”‚                                     
â”‚   MySQL + EventBus      â”‚                                     
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     
         â”‚                                                       
         â”‚ 6. Event: AssessmentSubmittedEvent                   
         â–¼                                                       
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     
â”‚    qs-worker (å¼‚æ­¥)      â”‚                                     
â”‚   EvaluationService     â”‚                                     
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     
         â”‚ 7. åŠ è½½ Assessmentã€Scaleã€AnswerSheet               
         â”‚ 8. æ‰§è¡Œè®¡ç®—ç­–ç•¥ï¼ˆCalculationï¼‰                        
         â”‚ 9. æ‰§è¡Œè§£è¯»ç­–ç•¥ï¼ˆInterpretationï¼‰                     
         â”‚ 10. æ„å»ºæŠ¥å‘Šï¼ˆReportBuilderï¼‰                         
         â”‚ 11. æ›´æ–° Assessment çŠ¶æ€ â†’ Interpreted               
         â”‚ 12. ä¿å­˜ Report åˆ° MongoDB                           
         â–¼                                                       
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     
â”‚   MySQL + MongoDB       â”‚                                     
â”‚  (æŒä¹…åŒ–å®Œæˆ)            â”‚                                     
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     
```

### 4.2 å…³é”®æ­¥éª¤è¯¦è§£

#### æ­¥éª¤ 3-5ï¼šåˆ›å»ºæµ‹è¯„ï¼ˆåŒæ­¥ï¼‰

```go
// ä¼ªä»£ç ï¼šSubmissionService.Submit()
func (s *SubmissionService) Submit(ctx context.Context, req SubmitRequest) (*AssessmentDTO, error) {
    // 1. è·¨èšåˆéªŒè¯ï¼ˆå—è¯•è€…ã€é—®å·ã€ç­”å·ã€é‡è¡¨ï¼‰
    creator := assessment.NewAssessmentCreator(
        testeeValidator,
        questionnaireValidator,
        answerSheetValidator,
        scaleValidator,
    )
    
    // 2. åˆ›å»ºæµ‹è¯„ï¼ˆè‡ªåŠ¨æäº¤ï¼‰
    req := assessment.NewCreateAssessmentRequest(
        orgID, testeeID, questionnaireRef, answerSheetRef, origin,
    ).WithMedicalScale(scaleRef)
    
    assess, err := creator.Create(ctx, req)
    if err != nil {
        return nil, err
    }
    
    // 3. æŒä¹…åŒ–ï¼ˆäº‹åŠ¡è¾¹ç•Œï¼‰
    if err := s.assessmentRepo.Save(ctx, assess); err != nil {
        return nil, err
    }
    
    // 4. å‘å¸ƒé¢†åŸŸäº‹ä»¶ï¼ˆè§¦å‘å¼‚æ­¥è¯„ä¼°ï¼‰
    events := assess.GetEvents()
    for _, event := range events {
        s.eventBus.Publish(ctx, event)
    }
    
    return toDTO(assess), nil
}
```

**ä»£ç ä½ç½®**ï¼š[`application/evaluation/assessment/submission_service.go`](../../../internal/apiserver/application/evaluation/assessment/submission_service.go)

#### æ­¥éª¤ 7-12ï¼šè¯„ä¼°æµ‹è¯„ï¼ˆå¼‚æ­¥ï¼‰

```go
// ä¼ªä»£ç ï¼šEvaluationService.Evaluate()
func (s *EvaluationService) Evaluate(ctx context.Context, assessmentID uint64) error {
    // 1. åŠ è½½ Assessment
    assess, err := s.assessmentRepo.FindByID(ctx, assessmentID)
    if err != nil || !assess.Status().IsSubmitted() {
        return err
    }
    
    // 2. åŠ è½½ MedicalScale
    scale, err := s.scaleRepo.FindByCode(ctx, assess.MedicalScaleRef().Code())
    if err != nil {
        return err
    }
    
    // 3. åŠ è½½ AnswerSheetï¼ˆä» Survey å­åŸŸï¼‰
    answerSheet, err := s.answerSheetRepo.FindByID(ctx, assess.AnswerSheetRef().ID())
    if err != nil {
        return err
    }
    
    // 4. æ‰§è¡Œè®¡ç®—ç­–ç•¥
    factorScores := []assessment.FactorScore{}
    for _, factor := range scale.Factors() {
        strategy := calculation.GetStrategy(factor.ScoringStrategy())
        score, _ := strategy.Calculate(factor.GetValues(answerSheet), factor.Params())
        factorScores = append(factorScores, assessment.FactorScore{
            FactorCode: factor.Code(),
            Score:      score,
        })
    }
    
    // 5. æ‰§è¡Œè§£è¯»ç­–ç•¥
    interpretResults := []assessment.InterpretResult{}
    for _, fs := range factorScores {
        strategy := interpretation.GetStrategy(factor.InterpretStrategy())
        result, _ := strategy.Interpret(fs.Score, factor.InterpretConfig())
        interpretResults = append(interpretResults, result)
    }
    
    // 6. ç»„è£…è¯„ä¼°ç»“æœ
    evalResult := &assessment.EvaluationResult{
        TotalScore:   calculateTotal(factorScores),
        RiskLevel:    determineRiskLevel(interpretResults),
        FactorScores: factorScores,
    }
    
    // 7. åº”ç”¨è¯„ä¼°ç»“æœåˆ° Assessment
    assess.ApplyEvaluation(evalResult)
    
    // 8. æ„å»ºæŠ¥å‘Š
    reportBuilder := report.NewDefaultReportBuilder()
    interpretReport, _ := reportBuilder.Build(assess, scale, evalResult)
    
    // 9. æŒä¹…åŒ–ï¼ˆäº‹åŠ¡è¾¹ç•Œï¼‰
    if err := s.assessmentRepo.Save(ctx, assess); err != nil {
        return err
    }
    if err := s.reportRepo.Save(ctx, interpretReport); err != nil {
        return err
    }
    
    return nil
}
```

**ä»£ç ä½ç½®**ï¼š[`application/evaluation/assessment/evaluation_service.go`](../../../internal/apiserver/application/evaluation/assessment/evaluation_service.go)

---

## 5. æ ¸å¿ƒè®¾è®¡æ¨¡å¼

### 5.1 ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰

**åº”ç”¨åœºæ™¯**ï¼š

1. **è®¡ç®—ç­–ç•¥**ï¼ˆCalculationï¼‰ï¼šå°è£…ä¸åŒçš„è®¡åˆ†ç®—æ³•
2. **è§£è¯»ç­–ç•¥**ï¼ˆInterpretationï¼‰ï¼šå°è£…ä¸åŒçš„è§£è¯»è§„åˆ™
3. **å¯¼å‡ºç­–ç•¥**ï¼ˆReport Exporterï¼‰ï¼šå°è£…ä¸åŒçš„å¯¼å‡ºæ ¼å¼

**è®¾è®¡ç»“æ„**ï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     CalculationStrategy (æ¥å£)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + Calculate(values, params): score â”‚
â”‚ + StrategyType(): string            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚         â”‚         â”‚         â”‚
     â–¼         â–¼         â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Sum   â”‚ â”‚ Average â”‚ â”‚Weighted â”‚ â”‚   Max   â”‚
â”‚Strategy â”‚ â”‚Strategy â”‚ â”‚  Sum    â”‚ â”‚Strategy â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜åŠ¿**ï¼š

* âœ… ç®—æ³•å°è£…ï¼šæ¯ç§ç­–ç•¥ç‹¬ç«‹å°è£…ï¼ŒèŒè´£å•ä¸€
* âœ… åŠ¨æ€é€‰æ‹©ï¼šè¿è¡Œæ—¶æ ¹æ®é…ç½®é€‰æ‹©ç­–ç•¥
* âœ… æ˜“äºæ‰©å±•ï¼šæ–°å¢ç­–ç•¥æ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç ï¼ˆå¼€é—­åŸåˆ™ï¼‰

**ä»£ç ç¤ºä¾‹**ï¼š

```go
// æ³¨å†Œç­–ç•¥
calculation.RegisterStrategy(&CustomMedianStrategy{})

// ä½¿ç”¨ç­–ç•¥
strategy := calculation.GetStrategy("median")
score, err := strategy.Calculate(values, params)
```

### 5.2 æ„å»ºå™¨æ¨¡å¼ï¼ˆBuilder Patternï¼‰

**åº”ç”¨åœºæ™¯**ï¼š

1. **AssessmentCreator**ï¼šåˆ›å»º Assessment èšåˆæ ¹ï¼ˆéœ€éªŒè¯å¤šä¸ªä¾èµ–ï¼‰
2. **ReportBuilder**ï¼šæ„å»º InterpretReportï¼ˆå¤æ‚å¯¹è±¡åˆ†æ­¥æ„å»ºï¼‰

**è®¾è®¡ç»“æ„**ï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      AssessmentCreator           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + ValidateTestee()               â”‚
â”‚ + ValidateQuestionnaire()        â”‚
â”‚ + ValidateAnswerSheet()          â”‚
â”‚ + ValidateScale()                â”‚
â”‚ + Build(): Assessment            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜åŠ¿**ï¼š

* âœ… éš”ç¦»å¤æ‚æ€§ï¼šå°†å¤æ‚çš„åˆ›å»ºè¿‡ç¨‹å°è£…åœ¨ Creator ä¸­
* âœ… æ­¥éª¤å¯æ§ï¼šåˆ†æ­¥éªŒè¯ï¼Œä»»ä¸€æ­¥éª¤å¤±è´¥å³åœæ­¢
* âœ… å¯æµ‹è¯•æ€§ï¼šä¾¿äº Mock å„ä¸ªéªŒè¯å™¨è¿›è¡Œå•å…ƒæµ‹è¯•

**ä»£ç ç¤ºä¾‹**ï¼š

```go
// åˆ›å»ºå™¨ä½¿ç”¨ç¤ºä¾‹
creator := assessment.NewAssessmentCreator(
    testeeValidator,
    questionnaireValidator,
    answerSheetValidator,
    scaleValidator,
)

assess, err := creator.Create(ctx, request)
```

### 5.3 æ³¨å†Œå™¨æ¨¡å¼ï¼ˆRegistry Patternï¼‰

**åº”ç”¨åœºæ™¯**ï¼šç­–ç•¥åŠ¨æ€æ³¨å†Œä¸è·å–

**è®¾è®¡ç»“æ„**ï¼š

```go
// å…¨å±€æ³¨å†Œè¡¨
var strategyRegistry = make(map[StrategyType]CalculationStrategy)

// æ³¨å†Œç­–ç•¥
func RegisterStrategy(strategy CalculationStrategy) {
    strategyRegistry[strategy.StrategyType()] = strategy
}

// è·å–ç­–ç•¥
func GetStrategy(strategyType StrategyType) CalculationStrategy {
    return strategyRegistry[strategyType]
}

// åˆå§‹åŒ–æ—¶è‡ªåŠ¨æ³¨å†Œ
func init() {
    RegisterStrategy(&SumStrategy{})
    RegisterStrategy(&AverageStrategy{})
    // ...
}
```

**ä¼˜åŠ¿**ï¼š

* âœ… è§£è€¦ï¼šç­–ç•¥å®ç°ä¸ä½¿ç”¨æ–¹è§£è€¦
* âœ… å¯æ‰©å±•ï¼šç¬¬ä¸‰æ–¹å¯æ³¨å†Œè‡ªå®šä¹‰ç­–ç•¥
* âœ… é›†ä¸­ç®¡ç†ï¼šç»Ÿä¸€çš„ç­–ç•¥è·å–å…¥å£

### 5.4 çŠ¶æ€æœºæ¨¡å¼ï¼ˆState Machineï¼‰

**åº”ç”¨åœºæ™¯**ï¼šAssessment çŠ¶æ€ç®¡ç†

**çŠ¶æ€æµè½¬**ï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   Submit()   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   ApplyEvaluation()   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pending  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Submitted  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Interpreted  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ MarkAsFailed()
                               â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚  Failed  â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®ç°æ–¹å¼**ï¼š

```go
// çŠ¶æ€è¿ç§»æ–¹æ³•ï¼ˆé¢†åŸŸé€»è¾‘ï¼‰
func (a *Assessment) Submit() error {
    if !a.status.IsPending() {
        return ErrInvalidStatusTransition
    }
    a.status = StatusSubmitted
    a.submittedAt = &now
    a.publishEvent(NewAssessmentSubmittedEvent(...))
    return nil
}

func (a *Assessment) ApplyEvaluation(result *EvaluationResult) error {
    if !a.status.IsSubmitted() {
        return ErrInvalidStatusTransition
    }
    a.status = StatusInterpreted
    a.totalScore = &result.TotalScore
    a.riskLevel = &result.RiskLevel
    a.interpretedAt = &now
    a.publishEvent(NewAssessmentInterpretedEvent(...))
    return nil
}
```

**ä¼˜åŠ¿**ï¼š

* âœ… çŠ¶æ€çº¦æŸï¼šä»£ç å±‚é¢ä¿è¯çŠ¶æ€è¿ç§»åˆæ³•æ€§
* âœ… é¢†åŸŸè¯­ä¹‰ï¼šçŠ¶æ€è¿ç§»æ–¹æ³•åæ˜ ä¸šåŠ¡æœ¯è¯­ï¼ˆSubmitã€ApplyEvaluationï¼‰
* âœ… äº‹ä»¶é©±åŠ¨ï¼šçŠ¶æ€è¿ç§»è‡ªåŠ¨å‘å¸ƒé¢†åŸŸäº‹ä»¶

### 5.5 é¢†åŸŸäº‹ä»¶æ¨¡å¼ï¼ˆDomain Eventï¼‰

**åº”ç”¨åœºæ™¯**ï¼šå¼‚æ­¥è§£è€¦ã€äº‹ä»¶é©±åŠ¨

**äº‹ä»¶å®šä¹‰**ï¼š

```go
// AssessmentSubmittedEvent - æµ‹è¯„å·²æäº¤
type AssessmentSubmittedEvent struct {
    EventID      string
    OccurredAt   time.Time
    AssessmentID ID
    TesteeID     testee.ID
    // ...
}

// AssessmentInterpretedEvent - æµ‹è¯„å·²è§£è¯»
type AssessmentInterpretedEvent struct {
    EventID      string
    OccurredAt   time.Time
    AssessmentID ID
    TotalScore   float64
    RiskLevel    RiskLevel
    // ...
}
```

**äº‹ä»¶æµ**ï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  Submit()   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Assessment  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ AssessmentSubmittedEvent   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â”‚ EventBus.Publish()
                                       â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚    qs-worker         â”‚
                            â”‚  (Event Consumer)    â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚ Evaluate()
                                       â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚ AssessmentInterpretedEvent  â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜åŠ¿**ï¼š

* âœ… å¼‚æ­¥å¤„ç†ï¼šè¯„ä¼°è€—æ—¶æ“ä½œä¸é˜»å¡ä¸»æµç¨‹
* âœ… è§£è€¦ï¼šäº‹ä»¶å‘å¸ƒè€…ä¸å…³å¿ƒè®¢é˜…è€…
* âœ… å¯æ‰©å±•ï¼šæ–°å¢è®¢é˜…è€…ä¸å½±å“ç°æœ‰é€»è¾‘

---

## 6. ç›®å½•ç»“æ„è®¾è®¡

### 6.1 é¢†åŸŸå±‚ç»“æ„

```text
internal/apiserver/domain/evaluation/
â”œâ”€â”€ assessment/                     # Assessment èšåˆ
â”‚   â”œâ”€â”€ assessment.go               # èšåˆæ ¹ï¼ˆçŠ¶æ€æœºã€äº‹ä»¶å‘å¸ƒï¼‰
â”‚   â”œâ”€â”€ score.go                    # Score å®ä½“ï¼ˆå› å­å¾—åˆ†ï¼‰
â”‚   â”œâ”€â”€ creator.go                  # åˆ›å»ºå™¨ï¼ˆBuilder æ¨¡å¼ï¼‰
â”‚   â”œâ”€â”€ types.go                    # å€¼å¯¹è±¡ï¼ˆStatusã€Originã€RiskLevelï¼‰
â”‚   â”œâ”€â”€ events.go                   # é¢†åŸŸäº‹ä»¶
â”‚   â”œâ”€â”€ errors.go                   # é¢†åŸŸé”™è¯¯
â”‚   â””â”€â”€ repository.go               # ä»“å‚¨æ¥å£
â”‚
â”œâ”€â”€ calculation/                    # Calculation ç­–ç•¥
â”‚   â”œâ”€â”€ strategy.go                 # ç­–ç•¥æ¥å£ + æ³¨å†Œå™¨
â”‚   â”œâ”€â”€ sum.go                      # æ±‚å’Œç­–ç•¥
â”‚   â”œâ”€â”€ average.go                  # å¹³å‡å€¼ç­–ç•¥
â”‚   â”œâ”€â”€ weighted_sum.go             # åŠ æƒå’Œç­–ç•¥
â”‚   â”œâ”€â”€ extremum.go                 # æå€¼ç­–ç•¥ï¼ˆMax/Minï¼‰
â”‚   â”œâ”€â”€ auxiliary.go                # è¾…åŠ©ç­–ç•¥ï¼ˆCount/FirstValueï¼‰
â”‚   â””â”€â”€ types.go                    # é€šç”¨ç±»å‹
â”‚
â”œâ”€â”€ interpretation/                 # Interpretation ç­–ç•¥
â”‚   â”œâ”€â”€ strategy.go                 # ç­–ç•¥æ¥å£ + æ³¨å†Œå™¨
â”‚   â”œâ”€â”€ threshold.go                # é˜ˆå€¼ç­–ç•¥
â”‚   â”œâ”€â”€ composite.go                # å¤åˆç­–ç•¥
â”‚   â”œâ”€â”€ types.go                    # å€¼å¯¹è±¡ï¼ˆScoreRangeã€InterpretItemï¼‰
â”‚   â””â”€â”€ errors.go                   # é¢†åŸŸé”™è¯¯
â”‚
â””â”€â”€ report/                         # Report èšåˆ
    â”œâ”€â”€ report.go                   # èšåˆæ ¹
    â”œâ”€â”€ dimension.go                # Dimension å®ä½“
    â”œâ”€â”€ suggestion.go               # Suggestion å€¼å¯¹è±¡
    â”œâ”€â”€ builder.go                  # æ„å»ºå™¨ï¼ˆBuilder æ¨¡å¼ï¼‰
    â”œâ”€â”€ exporter.go                 # å¯¼å‡ºå™¨ï¼ˆStrategy æ¨¡å¼ï¼‰
    â”œâ”€â”€ types.go                    # å€¼å¯¹è±¡
    â”œâ”€â”€ errors.go                   # é¢†åŸŸé”™è¯¯
    â””â”€â”€ repository.go               # ä»“å‚¨æ¥å£
```

### 6.2 åº”ç”¨æœåŠ¡å±‚ç»“æ„

```text
internal/apiserver/application/evaluation/
â”œâ”€â”€ assessment/                     # Assessment åº”ç”¨æœåŠ¡
â”‚   â”œâ”€â”€ evaluation_service.go       # è¯„ä¼°ç¼–æ’æœåŠ¡ï¼ˆqs-worker è°ƒç”¨ï¼‰
â”‚   â”œâ”€â”€ submission_service.go       # æäº¤æœåŠ¡ï¼ˆAPI è°ƒç”¨ï¼‰
â”‚   â”œâ”€â”€ query_service.go            # æŸ¥è¯¢æœåŠ¡
â”‚   â””â”€â”€ dto.go                      # DTO å®šä¹‰
â”‚
â””â”€â”€ report/                         # Report åº”ç”¨æœåŠ¡
    â”œâ”€â”€ query_service.go            # æŠ¥å‘ŠæŸ¥è¯¢æœåŠ¡
    â”œâ”€â”€ export_service.go           # æŠ¥å‘Šå¯¼å‡ºæœåŠ¡
    â””â”€â”€ dto.go                      # DTO å®šä¹‰
```

---

## 7. å­˜å‚¨è®¾è®¡

### 7.1 åŒå­˜å‚¨ç­–ç•¥

| èšåˆ | å­˜å‚¨ | åŸå›  | è¡¨ç»“æ„ |
|-----|------|------|--------|
| **Assessment** | MySQL | éœ€è¦å¤æ‚æŸ¥è¯¢ï¼ˆæŒ‰çŠ¶æ€ã€æ—¶é—´ã€æ¥æºç­‰ï¼‰ | `assessments` è¡¨ |
| **Score** | MySQL | éœ€è¦è¶‹åŠ¿åˆ†æï¼ˆå¤šæ¬¡æµ‹è¯„å¯¹æ¯”ï¼‰ | `assessment_scores` è¡¨ |
| **Report** | MongoDB | çµæ´»çš„æ–‡æ¡£ç»“æ„ï¼ˆç»´åº¦ã€å»ºè®®åˆ—è¡¨ï¼‰ | `interpret_reports` é›†åˆ |

### 7.2 MySQL è¡¨è®¾è®¡

```sql
-- assessments è¡¨
CREATE TABLE assessments (
    id BIGINT UNSIGNED PRIMARY KEY,
    org_id BIGINT UNSIGNED NOT NULL,
    testee_id BIGINT UNSIGNED NOT NULL,
    questionnaire_id BIGINT UNSIGNED NOT NULL,
    questionnaire_version INT NOT NULL,
    answer_sheet_id VARCHAR(50) NOT NULL,
    medical_scale_code VARCHAR(50),
    origin_type VARCHAR(20) NOT NULL,
    origin_ref_id VARCHAR(50),
    status VARCHAR(20) NOT NULL,
    total_score DECIMAL(10,2),
    risk_level VARCHAR(20),
    created_at TIMESTAMP NOT NULL,
    submitted_at TIMESTAMP,
    interpreted_at TIMESTAMP,
    failed_at TIMESTAMP,
    failure_reason TEXT,
    INDEX idx_testee_status (testee_id, status),
    INDEX idx_origin (origin_type, origin_ref_id),
    INDEX idx_created_at (created_at)
);

-- assessment_scores è¡¨
CREATE TABLE assessment_scores (
    id BIGINT UNSIGNED PRIMARY KEY,
    assessment_id BIGINT UNSIGNED NOT NULL,
    factor_code VARCHAR(50) NOT NULL,
    factor_name VARCHAR(100) NOT NULL,
    score DECIMAL(10,2) NOT NULL,
    risk_level VARCHAR(20),
    created_at TIMESTAMP NOT NULL,
    INDEX idx_assessment (assessment_id),
    UNIQUE KEY uk_assessment_factor (assessment_id, factor_code)
);
```

### 7.3 MongoDB æ–‡æ¡£è®¾è®¡

```json
// interpret_reports é›†åˆ
{
  "_id": "1234567890",  // ä¸ AssessmentID ä¸€è‡´
  "scale_name": "æŠ‘éƒè‡ªè¯„é‡è¡¨",
  "scale_code": "SDS",
  "total_score": 65.0,
  "risk_level": "moderate",
  "conclusion": "å­˜åœ¨è½»åº¦æŠ‘éƒç—‡çŠ¶ï¼Œå»ºè®®è¿›ä¸€æ­¥å…³æ³¨ã€‚",
  "dimensions": [
    {
      "factor_code": "F1",
      "factor_name": "æƒ…æ„Ÿç»´åº¦",
      "score": 22.0,
      "level": "high",
      "conclusion": "æƒ…æ„Ÿç»´åº¦å¾—åˆ†è¾ƒé«˜ï¼Œæç¤ºæƒ…ç»ªä½è½ã€‚"
    },
    {
      "factor_code": "F2",
      "factor_name": "è®¤çŸ¥ç»´åº¦",
      "score": 18.0,
      "level": "moderate",
      "conclusion": "è®¤çŸ¥ç»´åº¦å¾—åˆ†ä¸­ç­‰ï¼Œå­˜åœ¨ä¸€å®šçš„è®¤çŸ¥åå·®ã€‚"
    }
  ],
  "suggestions": [
    "å»ºè®®å®šæœŸè¿›è¡Œå¿ƒç†å’¨è¯¢",
    "ä¿æŒè§„å¾‹çš„ä½œæ¯æ—¶é—´",
    "é€‚å½“è¿›è¡Œä½“è‚²é”»ç‚¼"
  ],
  "created_at": ISODate("2025-01-29T10:00:00Z"),
  "updated_at": ISODate("2025-01-29T10:00:00Z")
}
```

---

## 8. æ‰©å±•æ€§è®¾è®¡

### 8.1 å¦‚ä½•æ–°å¢è®¡ç®—ç­–ç•¥

```go
// 1. å®šä¹‰ç­–ç•¥ç±»å‹
const TypeMedian StrategyType = "median"

// 2. å®ç°ç­–ç•¥æ¥å£
type MedianStrategy struct{}

func (s *MedianStrategy) Calculate(values []float64, params map[string]string) (float64, error) {
    // ä¸­ä½æ•°è®¡ç®—é€»è¾‘
    sort.Float64s(values)
    n := len(values)
    if n%2 == 0 {
        return (values[n/2-1] + values[n/2]) / 2, nil
    }
    return values[n/2], nil
}

func (s *MedianStrategy) StrategyType() StrategyType {
    return TypeMedian
}

// 3. æ³¨å†Œç­–ç•¥
func init() {
    calculation.RegisterStrategy(&MedianStrategy{})
}
```

**è¯¦è§**ï¼šã€Š11-06-08 æ‰©å±•æŒ‡å—ã€‹

### 8.2 å¦‚ä½•æ–°å¢è§£è¯»ç­–ç•¥

```go
// 1. å®šä¹‰ç­–ç•¥ç±»å‹
const TypePercentile StrategyType = "percentile"

// 2. å®ç°ç­–ç•¥æ¥å£
type PercentileStrategy struct{}

func (s *PercentileStrategy) Interpret(score float64, config *InterpretConfig) (*InterpretResult, error) {
    // ç™¾åˆ†ä½è§£è¯»é€»è¾‘
    percentile := calculatePercentile(score, config.NormData)
    return &InterpretResult{
        Level:      determineLevel(percentile),
        Conclusion: fmt.Sprintf("æ‚¨çš„å¾—åˆ†è¶…è¿‡äº† %.0f%% çš„äººç¾¤", percentile),
    }, nil
}

func (s *PercentileStrategy) StrategyType() StrategyType {
    return TypePercentile
}

// 3. æ³¨å†Œç­–ç•¥
func init() {
    interpretation.RegisterStrategy(&PercentileStrategy{})
}
```

### 8.3 å¦‚ä½•æ–°å¢å¯¼å‡ºæ ¼å¼

```go
// 1. å®ç°å¯¼å‡ºå™¨æ¥å£
type ExcelExporter struct{}

func (e *ExcelExporter) Export(report *InterpretReport) ([]byte, error) {
    // Excel å¯¼å‡ºé€»è¾‘
    file := excel.NewFile()
    // ... å¡«å……æ•°æ®
    return file.WriteToBuffer()
}

func (e *ExcelExporter) Format() ExportFormat {
    return FormatExcel
}

// 2. æ³¨å†Œå¯¼å‡ºå™¨
report.RegisterExporter(&ExcelExporter{})
```

---

## 9. æ€§èƒ½ä¼˜åŒ–è€ƒè™‘

### 9.1 å¼‚æ­¥è¯„ä¼°

* âœ… æäº¤ç­”å·ï¼ˆåŒæ­¥ï¼‰ï¼šåªåˆ›å»º Assessmentï¼ŒçŠ¶æ€ä¸º Submitted
* âœ… è¯„ä¼°è®¡ç®—ï¼ˆå¼‚æ­¥ï¼‰ï¼šqs-worker æ¶ˆè´¹äº‹ä»¶ï¼Œæ‰§è¡Œè€—æ—¶è®¡ç®—
* âœ… ç”¨æˆ·ä½“éªŒï¼šç”¨æˆ·æäº¤åç«‹å³è¿”å›ï¼Œåå°å¼‚æ­¥å¤„ç†

### 9.2 ç¼“å­˜ç­–ç•¥

| ç¼“å­˜å¯¹è±¡ | ç¼“å­˜æ—¶é—´ | å¤±æ•ˆç­–ç•¥ |
|---------|---------|---------|
| **MedicalScale** | 1 å°æ—¶ | é‡è¡¨æ›´æ–°æ—¶ä¸»åŠ¨æ¸…é™¤ |
| **Questionnaire** | 30 åˆ†é’Ÿ | ç‰ˆæœ¬å˜æ›´æ—¶æ¸…é™¤ |
| **InterpretReport** | æ°¸ä¹…ï¼ˆé™¤éé‡æ–°è¯„ä¼°ï¼‰ | Assessment é‡æ–°è¯„ä¼°æ—¶æ¸…é™¤ |

### 9.3 æ‰¹é‡æŸ¥è¯¢ä¼˜åŒ–

```go
// æ‰¹é‡åŠ è½½ Assessment + Report
func (s *QueryService) BatchGetWithReports(ctx context.Context, assessmentIDs []uint64) ([]AssessmentWithReportDTO, error) {
    // 1. æ‰¹é‡åŠ è½½ Assessmentï¼ˆå•æ¬¡ MySQL æŸ¥è¯¢ï¼‰
    assessments, _ := s.assessmentRepo.FindByIDs(ctx, assessmentIDs)
    
    // 2. æ‰¹é‡åŠ è½½ Reportï¼ˆå•æ¬¡ MongoDB æŸ¥è¯¢ï¼‰
    reportIDs := extractReportIDs(assessments)
    reports, _ := s.reportRepo.FindByIDs(ctx, reportIDs)
    
    // 3. å†…å­˜ä¸­ç»„è£…
    return assembleResults(assessments, reports), nil
}
```

---

## 10. æµ‹è¯•ç­–ç•¥

### 10.1 å•å…ƒæµ‹è¯•

**æµ‹è¯•é‡ç‚¹**ï¼š

* âœ… Assessment çŠ¶æ€æœºï¼ˆçŠ¶æ€è¿ç§»åˆæ³•æ€§ï¼‰
* âœ… è®¡ç®—ç­–ç•¥ï¼ˆå„ç§ç­–ç•¥çš„è®¡ç®—æ­£ç¡®æ€§ï¼‰
* âœ… è§£è¯»ç­–ç•¥ï¼ˆåˆ†æ•°åŒºé—´è§£è¯»å‡†ç¡®æ€§ï¼‰
* âœ… é¢†åŸŸäº‹ä»¶å‘å¸ƒï¼ˆäº‹ä»¶å†…å®¹å®Œæ•´æ€§ï¼‰

**ç¤ºä¾‹**ï¼š

```go
func TestAssessment_Submit(t *testing.T) {
    // åˆ›å»º pending çŠ¶æ€çš„æµ‹è¯„
    assess, _ := assessment.NewAssessment(...)
    
    // æäº¤æµ‹è¯„
    err := assess.Submit()
    
    // æ–­è¨€
    assert.NoError(t, err)
    assert.Equal(t, assessment.StatusSubmitted, assess.Status())
    assert.NotNil(t, assess.SubmittedAt())
    assert.Len(t, assess.GetEvents(), 1) // å‘å¸ƒäº† AssessmentSubmittedEvent
}
```

### 10.2 é›†æˆæµ‹è¯•

**æµ‹è¯•é‡ç‚¹**ï¼š

* âœ… å®Œæ•´è¯„ä¼°æµç¨‹ï¼ˆæäº¤ â†’ è®¡ç®— â†’ è§£è¯» â†’ æŠ¥å‘Šï¼‰
* âœ… è·¨èšåˆéªŒè¯ï¼ˆAssessmentCreatorï¼‰
* âœ… äº‹ä»¶é©±åŠ¨æµç¨‹ï¼ˆEvent â†’ qs-worker â†’ Evaluationï¼‰

### 10.3 ç«¯åˆ°ç«¯æµ‹è¯•

**æµ‹è¯•åœºæ™¯**ï¼š

1. ç”¨æˆ·æäº¤ç­”å· â†’ åˆ›å»ºæµ‹è¯„ â†’ å¼‚æ­¥è¯„ä¼° â†’ æŸ¥è¯¢æŠ¥å‘Š
2. é‡æ–°è¯„ä¼° â†’ æ›´æ–° Assessment â†’ æ›´æ–° Report
3. å¯¼å‡ºæŠ¥å‘Š â†’ PDF/Word æ ¼å¼éªŒè¯

---

## 11. å…³é”®è®¾è®¡å†³ç­–æ€»ç»“

### 11.1 ä¸ºä»€ä¹ˆä½¿ç”¨ç­–ç•¥æ¨¡å¼ï¼Ÿ

**é—®é¢˜**ï¼šä¸åŒé‡è¡¨æœ‰ä¸åŒçš„è®¡åˆ†æ–¹æ³•å’Œè§£è¯»è§„åˆ™

**æ–¹æ¡ˆ**ï¼š

* âŒ ç¡¬ç¼–ç ï¼šåœ¨ä»£ç ä¸­ if-else åˆ¤æ–­é‡è¡¨ç±»å‹ï¼ˆä¸å¯æ‰©å±•ï¼‰
* âœ… ç­–ç•¥æ¨¡å¼ï¼šå°è£…ç®—æ³•æ—ï¼Œé…ç½®åŒ–é€‰æ‹©ç­–ç•¥ï¼ˆå¼€é—­åŸåˆ™ï¼‰

**æ”¶ç›Š**ï¼š

* æ–°å¢é‡è¡¨åªéœ€é…ç½®ç­–ç•¥ç±»å‹ï¼Œæ— éœ€ä¿®æ”¹ä»£ç 
* ç¬¬ä¸‰æ–¹å¯æ³¨å†Œè‡ªå®šä¹‰ç­–ç•¥ï¼ˆå¦‚è‡ªå®šä¹‰è®¡åˆ†ç®—æ³•ï¼‰

### 11.2 ä¸ºä»€ä¹ˆä½¿ç”¨ Builder æ¨¡å¼ï¼Ÿ

**é—®é¢˜**ï¼šåˆ›å»º Assessment éœ€è¦éªŒè¯å¤šä¸ªä¾èµ–å¯¹è±¡ï¼ˆå—è¯•è€…ã€é—®å·ã€ç­”å·ã€é‡è¡¨ï¼‰

**æ–¹æ¡ˆ**ï¼š

* âŒ ç›´æ¥æ„é€ ï¼šåœ¨åº”ç”¨æœåŠ¡å±‚é€ä¸ªéªŒè¯ï¼ˆé€»è¾‘åˆ†æ•£ï¼‰
* âœ… Builder æ¨¡å¼ï¼šå°è£…åˆ›å»ºæµç¨‹ï¼Œé›†ä¸­éªŒè¯é€»è¾‘ï¼ˆé¢†åŸŸæœåŠ¡ï¼‰

**æ”¶ç›Š**ï¼š

* é¢†åŸŸé€»è¾‘é›†ä¸­åœ¨é¢†åŸŸå±‚ï¼Œåº”ç”¨æœåŠ¡å±‚åªè´Ÿè´£ç¼–æ’
* ä¾¿äºå•å…ƒæµ‹è¯•ï¼ˆMock å„ä¸ªéªŒè¯å™¨ï¼‰

### 11.3 ä¸ºä»€ä¹ˆä½¿ç”¨äº‹ä»¶é©±åŠ¨ï¼Ÿ

**é—®é¢˜**ï¼šè¯„ä¼°è®¡ç®—è€—æ—¶ï¼Œä¸èƒ½é˜»å¡ç”¨æˆ·æäº¤

**æ–¹æ¡ˆ**ï¼š

* âŒ åŒæ­¥è¯„ä¼°ï¼šç”¨æˆ·æäº¤åç­‰å¾…è®¡ç®—å®Œæˆï¼ˆç”¨æˆ·ä½“éªŒå·®ï¼‰
* âœ… å¼‚æ­¥è¯„ä¼°ï¼šå‘å¸ƒäº‹ä»¶ï¼Œqs-worker å¼‚æ­¥å¤„ç†ï¼ˆè§£è€¦ï¼‰

**æ”¶ç›Š**ï¼š

* ç”¨æˆ·æäº¤åç«‹å³è¿”å›ï¼Œæå‡ä½“éªŒ
* è¯„ä¼°å¤±è´¥ä¸å½±å“ç­”å·æäº¤
* åç»­å¯æ‰©å±•ï¼ˆå¦‚å‘é€é€šçŸ¥ã€è§¦å‘å…¶ä»–ä¸šåŠ¡ï¼‰

### 11.4 ä¸ºä»€ä¹ˆåˆ†ç¦» Assessment å’Œ Reportï¼Ÿ

**é—®é¢˜**ï¼šAssessment ç®¡ç†æµç¨‹ï¼ŒReport ç®¡ç†ç»“æœï¼ŒèŒè´£ä¸åŒ

**æ–¹æ¡ˆ**ï¼š

* âŒ åˆå¹¶å­˜å‚¨ï¼šAssessment åŒ…å« Report å­—æ®µï¼ˆèšåˆè¿‡å¤§ï¼‰
* âœ… åˆ†ç¦»å­˜å‚¨ï¼šAssessment ç”¨ MySQLï¼ŒReport ç”¨ MongoDBï¼ˆå„å¸å…¶èŒï¼‰

**æ”¶ç›Š**ï¼š

* Assessment æ”¯æŒå¤æ‚æŸ¥è¯¢ï¼ˆçŠ¶æ€ã€æ—¶é—´ã€æ¥æºï¼‰
* Report æ”¯æŒçµæ´»ç»“æ„ï¼ˆç»´åº¦ã€å»ºè®®åˆ—è¡¨ï¼‰
* å¯ç‹¬ç«‹æ‰©å±•ï¼ˆå¦‚ Report æ”¯æŒæ›´å¤šå¯¼å‡ºæ ¼å¼ï¼‰

---

## 12. åç»­æ–‡æ¡£é¢„å‘Š

| æ–‡æ¡£ç¼–å· | æ ‡é¢˜ | æ ¸å¿ƒå†…å®¹ |
|---------|------|---------|
| **11-06-02** | Assessment èšåˆè®¾è®¡ | èšåˆæ ¹ã€Score å®ä½“ã€çŠ¶æ€æœºã€é¢†åŸŸäº‹ä»¶ |
| **11-06-03** | Calculation è®¡ç®—ç­–ç•¥è®¾è®¡ | 7 ç§å†…ç½®ç­–ç•¥ã€æ³¨å†Œå™¨ã€æ‰©å±•ç¤ºä¾‹ |
| **11-06-04** | Interpretation è§£è¯»ç­–ç•¥è®¾è®¡ | é˜ˆå€¼ç­–ç•¥ã€å¤åˆç­–ç•¥ã€é«˜å±è¯†åˆ« |
| **11-06-05** | Report èšåˆè®¾è®¡ | æŠ¥å‘Šç»“æ„ã€Builderã€Exporter |
| **11-06-06** | åº”ç”¨æœåŠ¡å±‚è®¾è®¡ | EvaluationServiceã€QueryServiceã€DTO |
| **11-06-07** | è®¾è®¡æ¨¡å¼åº”ç”¨æ€»ç»“ | æ¨¡å¼åä½œã€æ‰©å±•æ€§ä¿è¯ |
| **11-06-08** | æ‰©å±•æŒ‡å— | è‡ªå®šä¹‰ç­–ç•¥ã€è‡ªå®šä¹‰å¯¼å‡ºæ ¼å¼ |

---

## 13. ç›¸å…³æ–‡æ¡£é“¾æ¥

* ã€Š11-01-é—®å·&é‡è¡¨BCé¢†åŸŸæ¨¡å‹æ€»è§ˆ-v2.mdã€‹
* ã€Š11-02-qs-apiserveré¢†åŸŸå±‚ä»£ç ç»“æ„è®¾è®¡-v2.mdã€‹
* ã€Š11-04-Surveyå­åŸŸè®¾è®¡ã€‹
* ã€Š11-05-Scaleå­åŸŸè®¾è®¡-v2.mdã€‹

---

## é™„å½•ï¼šæœ¯è¯­è¡¨

| æœ¯è¯­ | è‹±æ–‡ | è¯´æ˜ |
|-----|------|------|
| æµ‹è¯„ | Assessment | ä¸€æ¬¡å…·ä½“çš„æµ‹è¯„è¡Œä¸ºï¼ˆè°ã€ç”¨ä»€ä¹ˆé—®å·ã€ä»€ä¹ˆæ—¶å€™åšçš„ï¼‰ |
| ç­”å· | AnswerSheet | ç”¨æˆ·å¡«å†™çš„ç­”æ¡ˆå†…å®¹ |
| é‡è¡¨ | MedicalScale | ä¸“ä¸šè¯„ä¼°å·¥å…·ï¼ˆå¦‚ SDSã€SASï¼‰ |
| å› å­ | Factor | é‡è¡¨çš„ç»´åº¦ï¼ˆå¦‚æƒ…æ„Ÿç»´åº¦ã€è®¤çŸ¥ç»´åº¦ï¼‰ |
| è®¡åˆ† | Scoring | å°†ç­”æ¡ˆè½¬åŒ–ä¸ºåˆ†æ•° |
| è§£è¯» | Interpretation | å°†åˆ†æ•°è½¬åŒ–ä¸ºä¸šåŠ¡ç»“è®º |
| é£é™©ç­‰çº§ | RiskLevel | ä½é£é™©ã€ä¸­é£é™©ã€é«˜é£é™© |
| èšåˆæ ¹ | Aggregate Root | DDD ä¸­çš„æ ¸å¿ƒæ¦‚å¿µï¼Œèšåˆçš„å…¥å£å¯¹è±¡ |
| å€¼å¯¹è±¡ | Value Object | æ— èº«ä»½çš„ä¸å¯å˜å¯¹è±¡ |
| é¢†åŸŸäº‹ä»¶ | Domain Event | é¢†åŸŸä¸­å‘ç”Ÿçš„é‡è¦ä¸šåŠ¡äº‹ä»¶ |

---

> **ä½œè€…**ï¼šEvaluation å­åŸŸè®¾è®¡å›¢é˜Ÿ  
> **å®¡é˜…**ï¼šé¢†åŸŸæ¶æ„å¸ˆ  
> **ç‰ˆæœ¬å†å²**ï¼š
>
> * V1.0 (2025-01-29)ï¼šåˆå§‹ç‰ˆæœ¬ï¼ŒåŸºäºå®é™…ä»£ç ç¼–å†™
