# 11-06-03 Calculation 计算策略设计

> **版本**：V2.0  
> **最后更新**：2025-11-29  
> **状态**：✅ 已实现并验证

---

## 📋 文档导航

**当前位置**：Calculation 计算策略设计（你在这里）  
**前置阅读**：[11-06-02 Assessment聚合设计](./11-06-02-Assessment聚合设计.md)  
**后续阅读**：

- [11-06-04 Interpretation解读策略设计](./11-06-04-Interpretation解读策略设计.md)
- [11-06-05 Report聚合设计](./11-06-05-Report聚合设计.md)

---

## 🎯 核心设计思想（30秒速览）

> **如果只有30秒，你需要知道这些：**

```text
┌────────────────────────────────────────────────────────────────────────────┐
│                                                                            │
│   Calculation = 计分引擎 = "把答案变成分数"                                │
│                                                                            │
│   ┌─────────────┐     ┌─────────────────┐     ┌─────────────┐              │
│   │   答案数据   │ ──▶ │   计算策略引擎   │ ──▶ │   因子得分   │              │
│   │ [2,3,1,4,2] │     │   (8种策略)     │     │  score=12   │              │
│   └─────────────┘     └─────────────────┘     └─────────────┘              │
│                              │                                             │
│                    ┌─────────┴─────────┐                                   │
│                    ▼                   ▼                                   │
│              ┌──────────┐        ┌──────────┐                              │
│              │ 求和 sum │        │ 平均 avg │  ...还有6种                  │
│              └──────────┘        └──────────┘                              │
│                                                                            │
├────────────────────────────────────────────────────────────────────────────┤
│  核心设计模式：                                                            │
│    ✓ 策略模式 - 8种计算策略，可插拔、可扩展                               │
│    ✓ 注册表模式 - 策略自注册，运行时动态获取                              │
│    ✓ 无状态设计 - 纯函数计算，线程安全                                    │
│    ✓ 单一职责 - 只负责计算，不涉及解读和存储                              │
└────────────────────────────────────────────────────────────────────────────┘
```

---

## 一、为什么需要 Calculation？（问题域）

### 1.1 业务场景：小明的抑郁量表计分

```text
┌─────────────────────────────────────────────────────────────────────────────┐
│  场景：小明完成了"抑郁自评量表(SDS)"的20道题                              │
│                                                                             │
│  原始答案（每题1-4分）：                                                   │
│    Q1=2, Q2=3, Q3=1, Q4=4, Q5=2 ...共20题                                 │
│                                                                             │
│  量表配置的计分规则：                                                       │
│    ┌─────────────────┬─────────────┬────────────────────┐                  │
│    │     因子名称     │   包含题目   │      计分方式      │                  │
│    ├─────────────────┼─────────────┼────────────────────┤                  │
│    │ 精神情感症状     │ Q1-Q5       │ 求和 (sum)         │                  │
│    │ 躯体症状         │ Q6-Q10      │ 求和 (sum)         │                  │
│    │ 精神运动障碍     │ Q11-Q15     │ 平均分 (average)   │                  │
│    │ 抑郁心理障碍     │ Q16-Q20     │ 加权求和 (weighted)│                  │
│    │ 总分             │ 全部因子    │ 求和 (sum)         │                  │
│    └─────────────────┴─────────────┴────────────────────┘                  │
│                                                                             │
│  期望输出：                                                                 │
│    精神情感症状 = 12分                                                     │
│    躯体症状 = 15分                                                         │
│    精神运动障碍 = 2.8分                                                    │
│    抑郁心理障碍 = 18.5分                                                   │
│    总分 = 48.3分                                                           │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 1.2 问题拆解与解决方案

| 问题 | 挑战 | Calculation 的解决方案 |
|------|------|----------------------|
| **算法多样** | 不同因子用不同算法（求和、平均、加权...） | **策略模式** - 每种算法一个策略类 |
| **易于扩展** | 未来可能新增算法（如：标准分、T分） | **注册表模式** - 新策略自动注册 |
| **配置驱动** | 计分规则来自量表配置，非硬编码 | **参数化设计** - 策略接收参数 |
| **多处调用** | answersheet 和 assessment 都需要计算 | **无状态设计** - 可安全复用 |

### 1.3 职责边界

```text
┌─────────────────────────────────────────────────────────────────────────────┐
│                        Calculation 功能域边界                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ✅ 我负责的：                        ❌ 我不关心的：                       │
│    • 执行各类数学计算                   • 分数的业务含义（解读）            │
│    • 策略的注册与获取                   • 结果的持久化存储                  │
│    • 参数解析（如权重配置）             • 答案数据从哪里来                  │
│    • 边界情况处理（空值）               • 计算结果怎么用                    │
│                                                                             │
│  调用方：                                                                   │
│    • Survey 子域：计算单题得分                                             │
│    • Assessment 聚合：计算因子汇总得分                                     │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 二、整体架构（是什么？）

### 2.1 计算策略在评估流程中的位置

```text
┌─────────────────────────────────────────────────────────────────────────────┐
│                          评估流程全景图                                     │
│                                                                             │
│   ┌──────────────────────────────────────────────────────────────────────┐ │
│   │ Phase 1: 数据准备                                                    │ │
│   │                                                                      │ │
│   │   AnswerSheet ──────▶ 答案数据 ──────▶ [2,3,1,4,2,...]             │ │
│   │   MedicalScale ─────▶ 因子配置 ──────▶ [F1, F2, F3, ...]           │ │
│   │                                                                      │ │
│   └──────────────────────────────────────────────────────────────────────┘ │
│                                    │                                        │
│                                    ▼                                        │
│   ┌──────────────────────────────────────────────────────────────────────┐ │
│   │ Phase 2: 分数计算  ◀─────── 【你在这里：Calculation】               │ │
│   │                                                                      │ │
│   │   for each Factor:                                                   │ │
│   │     1. 提取该因子关联的答案值                                        │ │
│   │     2. 获取对应计算策略                                              │ │
│   │     3. 执行计算得到因子分                                            │ │
│   │                                                                      │ │
│   │   输出：[{F1:12}, {F2:15}, {F3:2.8}, ...]                           │ │
│   │                                                                      │ │
│   └──────────────────────────────────────────────────────────────────────┘ │
│                                    │                                        │
│                                    ▼                                        │
│   ┌──────────────────────────────────────────────────────────────────────┐ │
│   │ Phase 3: 结果解读  ──────▶ Interpretation                           │ │
│   │                                                                      │ │
│   │   分数 ──▶ 风险等级 + 结论文本                                       │ │
│   │   12分 ──▶ "中度风险" + "存在明显抑郁倾向"                          │ │
│   │                                                                      │ │
│   └──────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 Calculation 内部结构

```text
┌─────────────────────────────────────────────────────────────────────────────┐
│                         calculation/（功能域）                              │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  strategy.go                          策略接口 + 注册表              │  │
│   │  ┌───────────────────────────────────────────────────────────────┐  │  │
│   │  │  type ScoringStrategy interface {                             │  │  │
│   │  │      Calculate(values []float64, params map[string]string)    │  │  │
│   │  │      StrategyType() StrategyType                              │  │  │
│   │  │  }                                                            │  │  │
│   │  │                                                               │  │  │
│   │  │  var strategyRegistry = map[StrategyType]ScoringStrategy{}   │  │  │
│   │  │  func RegisterStrategy(s ScoringStrategy)                     │  │  │
│   │  │  func GetStrategy(t StrategyType) ScoringStrategy             │  │  │
│   │  └───────────────────────────────────────────────────────────────┘  │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  types.go                             类型定义                       │  │
│   │  ┌───────────────────────────────────────────────────────────────┐  │  │
│   │  │  StrategyTypeSum         = "sum"                              │  │  │
│   │  │  StrategyTypeAverage     = "average"                          │  │  │
│   │  │  StrategyTypeWeightedSum = "weighted_sum"                     │  │  │
│   │  │  StrategyTypeMax         = "max"                              │  │  │
│   │  │  StrategyTypeMin         = "min"                              │  │  │
│   │  │  StrategyTypeCount       = "count"                            │  │  │
│   │  │  StrategyTypeFirst       = "first"                            │  │  │
│   │  │  StrategyTypeLast        = "last"                             │  │  │
│   │  └───────────────────────────────────────────────────────────────┘  │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   ┌────────────────┬────────────────┬────────────────┬────────────────┐   │
│   │   sum.go       │  average.go    │ weighted_sum.go│  extremum.go   │   │
│   │   求和策略     │   平均策略      │   加权求和     │  最值策略      │   │
│   └────────────────┴────────────────┴────────────────┴────────────────┘   │
│                                                                             │
│   ┌────────────────────────────────────────────────────────────────────┐   │
│   │   auxiliary.go                                                     │   │
│   │   辅助策略：count / first / last                                   │   │
│   └────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 三、策略模式详解（怎么做？）

### 3.1 设计模式：策略模式 + 注册表模式

```text
┌─────────────────────────────────────────────────────────────────────────────┐
│                          策略模式 UML 类图                                  │
│                                                                             │
│                       ┌─────────────────────┐                               │
│                       │ <<interface>>       │                               │
│                       │ ScoringStrategy     │                               │
│                       ├─────────────────────┤                               │
│                       │ +Calculate()        │                               │
│                       │ +StrategyType()     │                               │
│                       └──────────┬──────────┘                               │
│                                  │                                          │
│          ┌───────────┬───────────┼───────────┬───────────┐                  │
│          │           │           │           │           │                  │
│          ▼           ▼           ▼           ▼           ▼                  │
│   ┌────────────┐┌────────────┐┌────────────┐┌────────────┐┌────────────┐   │
│   │SumStrategy ││AverageStr..││WeightedSum.││MaxStrategy ││MinStrategy │   │
│   ├────────────┤├────────────┤├────────────┤├────────────┤├────────────┤   │
│   │+Calculate()││+Calculate()││+Calculate()││+Calculate()││+Calculate()│   │
│   └────────────┘└────────────┘└────────────┘└────────────┘└────────────┘   │
│                                                                             │
│                       ┌─────────────────────┐                               │
│                       │  StrategyRegistry   │                               │
│                       ├─────────────────────┤                               │
│                       │ +Register(strategy) │ ◀── init() 自动注册           │
│                       │ +Get(type) strategy │ ◀── 运行时获取                │
│                       └─────────────────────┘                               │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 策略接口定义

```go
// 代码位置：internal/apiserver/domain/evaluation/calculation/strategy.go

// ScoringStrategy 计分策略接口
// 设计原则：无状态，纯函数式计算
type ScoringStrategy interface {
    // Calculate 执行计分计算
    // values: 待计算的值列表（如：[2,3,1,4,2]）
    // params: 计分参数（如权重、精度等）
    // 返回：计算结果和可能的错误
    Calculate(values []float64, params map[string]string) (float64, error)
    
    // StrategyType 返回策略类型标识
    StrategyType() StrategyType
}
```

> 📎 **完整代码**：[strategy.go](../../../internal/apiserver/domain/evaluation/calculation/strategy.go)

### 3.3 注册表机制

```text
┌─────────────────────────────────────────────────────────────────────────────┐
│                          策略注册流程                                        │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  程序启动时 (init)                                                   │  │
│   │                                                                      │  │
│   │   sum.go      ─────▶  RegisterStrategy(&SumStrategy{})              │  │
│   │   average.go  ─────▶  RegisterStrategy(&AverageStrategy{})          │  │
│   │   weighted.go ─────▶  RegisterStrategy(&WeightedSumStrategy{})      │  │
│   │   extremum.go ─────▶  RegisterStrategy(&MaxStrategy{})              │  │
│   │               ─────▶  RegisterStrategy(&MinStrategy{})              │  │
│   │   auxiliary.go ────▶  RegisterStrategy(&CountStrategy{})            │  │
│   │                ────▶  RegisterStrategy(&FirstStrategy{})            │  │
│   │                ────▶  RegisterStrategy(&LastStrategy{})             │  │
│   │                                                                      │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                    │                                        │
│                                    ▼                                        │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  策略注册表 (strategyRegistry)                                       │  │
│   │                                                                      │  │
│   │   "sum"          ──▶ &SumStrategy{}                                 │  │
│   │   "average"      ──▶ &AverageStrategy{}                             │  │
│   │   "weighted_sum" ──▶ &WeightedSumStrategy{}                         │  │
│   │   "max"          ──▶ &MaxStrategy{}                                 │  │
│   │   "min"          ──▶ &MinStrategy{}                                 │  │
│   │   "count"        ──▶ &CountStrategy{}                               │  │
│   │   "first"        ──▶ &FirstStrategy{}                               │  │
│   │   "last"         ──▶ &LastStrategy{}                                │  │
│   │                                                                      │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                    │                                        │
│                                    ▼                                        │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │  运行时使用                                                          │  │
│   │                                                                      │  │
│   │   strategy := GetStrategy("sum")                                    │  │
│   │   result, _ := strategy.Calculate([]float64{2,3,1,4,2}, nil)       │  │
│   │   // result = 12                                                    │  │
│   │                                                                      │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────┘
```

伪代码实现：

```go
// 策略注册表（全局单例）
var strategyRegistry = make(map[StrategyType]ScoringStrategy)

// 注册策略
func RegisterStrategy(strategy ScoringStrategy) {
    strategyRegistry[strategy.StrategyType()] = strategy
}

// 获取策略
func GetStrategy(strategyType StrategyType) ScoringStrategy {
    return strategyRegistry[strategyType]
}

// init() 自动注册（每个策略文件都有）
func init() {
    RegisterStrategy(&SumStrategy{})
    RegisterStrategy(&AverageStrategy{})
    // ... 其他策略
}
```

> 📎 **完整代码**：[strategy.go](../../../internal/apiserver/domain/evaluation/calculation/strategy.go)

---

## 四、8种计算策略详解

### 4.1 策略一览表

```text
┌─────────────────────────────────────────────────────────────────────────────┐
│                           8种计算策略总览                                   │
│                                                                             │
│  ┌─────────┬──────────────┬─────────────────────┬───────────────────────┐  │
│  │  类型   │    名称       │      公式           │       应用场景        │  │
│  ├─────────┼──────────────┼─────────────────────┼───────────────────────┤  │
│  │   sum   │    求和       │   Σ(values)         │ 抑郁/焦虑量表总分     │  │
│  │ average │    平均       │   Σ(values)/n       │ 满意度均分            │  │
│  │weighted │  加权求和     │   Σ(v[i]*w[i])      │ 权重不同的因子        │  │
│  │   max   │   最大值      │   max(values)       │ 峰值症状检测          │  │
│  │   min   │   最小值      │   min(values)       │ 最低功能水平          │  │
│  │  count  │    计数       │   len(values)       │ 症状计数              │  │
│  │  first  │   首值        │   values[0]         │ 基线测量              │  │
│  │  last   │   末值        │   values[n-1]       │ 最终状态              │  │
│  └─────────┴──────────────┴─────────────────────┴───────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 4.2 核心策略实现

#### 求和策略 (Sum)

```text
输入: [2, 3, 1, 4, 2]
计算: 2 + 3 + 1 + 4 + 2 = 12
输出: 12.0
```

```go
// SumStrategy 求和计分策略
type SumStrategy struct{}

func (s *SumStrategy) Calculate(values []float64, params map[string]string) (float64, error) {
    if len(values) == 0 {
        return 0, nil
    }
    var total float64
    for _, v := range values {
        total += v
    }
    return total, nil
}
```

> 📎 **完整代码**：[sum.go](../../../internal/apiserver/domain/evaluation/calculation/sum.go)

#### 加权求和策略 (WeightedSum)

```text
输入: values=[10, 20, 30], weights=[0.5, 0.3, 0.2]
计算: 10*0.5 + 20*0.3 + 30*0.2 = 5 + 6 + 6 = 17
输出: 17.0
```

```go
// WeightedSumStrategy 加权求和策略
type WeightedSumStrategy struct{}

func (s *WeightedSumStrategy) Calculate(values []float64, params map[string]string) (float64, error) {
    weights, err := s.parseWeights(params, len(values))
    if err != nil {
        return 0, err
    }
    
    var total float64
    for i, v := range values {
        total += v * weights[i]
    }
    return total, nil
}

// 解析权重参数：params["weights"] = "[0.5, 0.3, 0.2]"
func (s *WeightedSumStrategy) parseWeights(params map[string]string, count int) ([]float64, error) {
    // 如果未配置权重，默认全为1.0
    // 否则解析 JSON 格式的权重数组
}
```

> 📎 **完整代码**：[weighted_sum.go](../../../internal/apiserver/domain/evaluation/calculation/weighted_sum.go)

#### 极值策略 (Max/Min)

```text
输入: [2, 8, 1, 6, 3]
Max:  8.0 (最严重症状得分)
Min:  1.0 (最轻症状得分)
```

> 📎 **完整代码**：[extremum.go](../../../internal/apiserver/domain/evaluation/calculation/extremum.go)

---

## 五、运行时调用流程

### 5.1 因子得分计算流程

```text
┌─────────────────────────────────────────────────────────────────────────────┐
│                       因子得分计算时序图                                    │
│                                                                             │
│   EvaluationService        Calculation           SumStrategy               │
│         │                      │                      │                     │
│         │  1. 获取策略         │                      │                     │
│         │─────────────────────▶│                      │                     │
│         │   GetStrategy("sum") │                      │                     │
│         │                      │                      │                     │
│         │  2. 返回策略实例     │                      │                     │
│         │◀─────────────────────│                      │                     │
│         │   &SumStrategy{}     │                      │                     │
│         │                      │                      │                     │
│         │  3. 执行计算                                │                     │
│         │─────────────────────────────────────────────▶                     │
│         │   Calculate([2,3,1,4,2], nil)               │                     │
│         │                                             │                     │
│         │  4. 返回结果                                │                     │
│         │◀─────────────────────────────────────────────                     │
│         │   12.0, nil                                 │                     │
│         │                                             │                     │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 5.2 完整评估中的调用

```go
// 伪代码：评估服务中调用计算策略
func (s *EvaluationService) calculateFactorScores(
    answerSheet *AnswerSheet,
    scale *MedicalScale,
) []FactorScore {
    
    factorScores := []FactorScore{}
    
    // 遍历量表的每个因子
    for _, factor := range scale.Factors() {
        
        // 1. 提取该因子关联题目的答案值
        values := extractValues(answerSheet, factor.QuestionCodes())
        // values = [2, 3, 1, 4, 2]
        
        // 2. 获取该因子配置的计算策略
        strategy := calculation.GetStrategy(factor.ScoringStrategy())
        // strategy = &SumStrategy{}
        
        // 3. 执行计算
        score, err := strategy.Calculate(values, factor.ScoringParams())
        // score = 12.0
        
        // 4. 记录因子得分
        factorScores = append(factorScores, FactorScore{
            FactorCode: factor.Code(),
            RawScore:   score,
        })
    }
    
    return factorScores
}
```

---

## 六、扩展指南

### 6.1 添加新策略（3步完成）

```text
┌─────────────────────────────────────────────────────────────────────────────┐
│                        添加新策略：中位数 (Median)                          │
│                                                                             │
│  Step 1: 定义策略类型                                                       │
│  ─────────────────────────────────────────────────────────────────────────  │
│                                                                             │
│    // types.go                                                             │
│    const StrategyTypeMedian StrategyType = "median"                        │
│                                                                             │
│  Step 2: 实现策略接口                                                       │
│  ─────────────────────────────────────────────────────────────────────────  │
│                                                                             │
│    // median.go (新文件)                                                   │
│    type MedianStrategy struct{}                                            │
│                                                                             │
│    func (s *MedianStrategy) Calculate(values []float64, params ...) {      │
│        sort.Float64s(values)                                               │
│        n := len(values)                                                    │
│        if n%2 == 0 {                                                       │
│            return (values[n/2-1] + values[n/2]) / 2, nil                   │
│        }                                                                   │
│        return values[n/2], nil                                             │
│    }                                                                       │
│                                                                             │
│    func (s *MedianStrategy) StrategyType() StrategyType {                  │
│        return StrategyTypeMedian                                           │
│    }                                                                       │
│                                                                             │
│  Step 3: 注册策略                                                           │
│  ─────────────────────────────────────────────────────────────────────────  │
│                                                                             │
│    // median.go 或 strategy.go                                             │
│    func init() {                                                           │
│        RegisterStrategy(&MedianStrategy{})                                 │
│    }                                                                       │
│                                                                             │
│  ✅ 完成！新策略自动可用                                                    │
│                                                                             │
│    strategy := GetStrategy("median")                                       │
│    result, _ := strategy.Calculate([]float64{1,3,5,7,9}, nil) // 5.0      │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 6.2 开闭原则体现

```text
┌─────────────────────────────────────────────────────────────────────────────┐
│                          开闭原则 (OCP)                                     │
│                                                                             │
│   "对扩展开放，对修改关闭"                                                  │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                     现有代码（无需修改）                             │  │
│   │                                                                     │  │
│   │   strategy.go    ──▶ 接口定义不变                                  │  │
│   │   sum.go         ──▶ 求和策略不变                                  │  │
│   │   average.go     ──▶ 平均策略不变                                  │  │
│   │   调用方代码     ──▶ GetStrategy() 不变                            │  │
│   │                                                                     │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│                                    +                                        │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                     新增代码（扩展）                                 │  │
│   │                                                                     │  │
│   │   median.go      ──▶ 新策略实现                                    │  │
│   │   init()         ──▶ 自动注册                                      │  │
│   │                                                                     │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 七、设计思想总结

### 7.1 核心设计决策

| 设计决策 | 选择 | 理由 |
|---------|------|------|
| **无状态设计** | 策略对象无实例变量 | 线程安全，可全局复用 |
| **接口抽象** | ScoringStrategy 接口 | 统一调用方式，易于扩展 |
| **全局注册表** | map + init() 自注册 | 解耦创建与使用 |
| **参数化配置** | params map[string]string | 灵活配置（如权重） |
| **功能域定位** | 非聚合，纯计算 | 单一职责，可被多处调用 |

### 7.2 与其他模块的协作

```text
┌─────────────────────────────────────────────────────────────────────────────┐
│                        Calculation 协作关系图                               │
│                                                                             │
│                        ┌──────────────────┐                                 │
│                        │   Calculation    │                                 │
│                        │  (计算策略引擎)  │                                 │
│                        └────────┬─────────┘                                 │
│                                 │                                           │
│               ┌─────────────────┼─────────────────┐                         │
│               │                 │                 │                         │
│               ▼                 ▼                 ▼                         │
│   ┌───────────────────┐ ┌───────────────┐ ┌───────────────────┐            │
│   │ Survey.AnswerSheet│ │  Assessment   │ │  Interpretation   │            │
│   │ (计算单题得分)    │ │(计算因子得分) │ │ (分数→解读)       │            │
│   └───────────────────┘ └───────────────┘ └───────────────────┘            │
│                                                                             │
│   数据流向：                                                                │
│     答卷 ──▶ Calculation ──▶ 因子分 ──▶ Interpretation ──▶ 解读结果        │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 八、代码索引

| 文件 | 职责 | 路径 |
|------|------|------|
| `strategy.go` | 接口定义 + 注册表 | `internal/apiserver/domain/evaluation/calculation/` |
| `types.go` | 类型常量定义 | 同上 |
| `sum.go` | 求和策略 | 同上 |
| `average.go` | 平均策略 | 同上 |
| `weighted_sum.go` | 加权求和策略 | 同上 |
| `extremum.go` | 最值策略(Max/Min) | 同上 |
| `auxiliary.go` | 辅助策略(Count/First/Last) | 同上 |

---

## 📖 延伸阅读

- **前一篇**：[11-06-02 Assessment聚合设计](./11-06-02-Assessment聚合设计.md) - 理解计算结果如何存储
- **后一篇**：[11-06-04 Interpretation解读策略设计](./11-06-04-Interpretation解读策略设计.md) - 学习分数如何转换为结论
- **设计模式**：《设计模式：可复用面向对象软件的基础》- 策略模式章节
