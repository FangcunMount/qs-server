# Plan 子域文档索引

> **版本**：V3.0  
> **更新日期**：2025-01-XX  
> **实现状态**：✅ 已实现

## 文档列表

### 1. [01-测评计划子域设计.md](./01-测评计划子域设计.md)

**核心设计文档**，包含：

- Plan 子域的定位与职责
- 核心聚合（AssessmentPlan、AssessmentTask）的设计
- 周期性测评管理业务流程
- 领域服务设计
- 应用服务设计
- 仓储接口定义
- REST API 接口列表
- 数据库迁移说明

**适用对象**：架构师、开发人员

### 2. [02-领域事件说明.md](./02-领域事件说明.md)

**领域事件文档**，包含：

- 事件列表（PlanCreatedEvent、TaskOpenedEvent、TaskCompletedEvent、TaskExpiredEvent）
- 事件数据结构和触发时机
- 事件消费者和潜在用途
- 事件订阅配置
- 事件处理实现状态

**适用对象**：开发人员、运维人员

### 3. [03-任务调度机制说明.md](./03-任务调度机制说明.md)

**任务调度文档**，包含：

- 调度架构设计
- 外部定时任务配置（Cron/Systemd Timer/Kubernetes CronJob）
- 调度流程说明
- EntryGenerator 实现细节
- 错误处理策略

**适用对象**：开发人员、运维人员

### 4. [04-实现总结.md](./04-实现总结.md)

**实现总结文档**，包含：

- 实现概览和目录结构
- 核心设计决策说明
- 关键业务流程
- 数据模型和索引设计
- 待实现功能列表

**适用对象**：开发人员、项目经理

## 快速导航

### 设计相关

- [核心聚合设计](./01-测评计划子域设计.md#3-assessmentplan-聚合根)
- [领域服务设计](./01-测评计划子域设计.md#9-领域服务)
- [应用服务设计](./01-测评计划子域设计.md#10-应用服务)

### 实现相关

- [目录结构](./04-实现总结.md#2-目录结构)
- [核心设计决策](./04-实现总结.md#3-核心设计决策)
- [关键业务流程](./04-实现总结.md#4-关键业务流程)

### 运维相关

- [任务调度配置](./03-任务调度机制说明.md#方式一定时任务cron-job调用-httpgrpc-接口推荐)
- [事件订阅配置](./02-领域事件说明.md#事件订阅配置)
- [数据库迁移](./01-测评计划子域设计.md#14-数据库迁移)

## 核心概念

### AssessmentPlan（测评计划模板）

- **定位**：周期性测评策略模板，不关联具体的受试者
- **职责**：定义"应该如何测"的策略（测什么、什么时候测、测几次）
- **状态**：active（活跃）、paused（暂停）、finished（已完成）、canceled（已取消）

### AssessmentTask（测评任务）

- **定位**：计划分解后的"应测实例"，代表"某个受试者的第 N 次测评"
- **职责**：记录计划的第 N 次测评应该在什么时候进行，管理任务状态
- **状态**：pending（待推送）、opened（已推送）、completed（已完成）、expired（已过期）、canceled（已取消）

### 周期策略

- **by_week**：每 N 周一次
- **by_day**：每 N 天一次
- **custom**：自定义周次（如 [2,4,8,12]）
- **fixed_date**：固定日期列表

## 关键设计原则

1. **Plan 是模板**：不关联 testeeID，多个受试者可以加入同一个 Plan
2. **相对时间窗口**：Plan 不包含 startDate/endDate，而是使用相对时间窗口
3. **审计字段分离**：领域对象不包含审计字段，由基础设施层处理
4. **领域服务封装业务规则**：状态变更方法由领域服务调用，确保一致性

## 相关链接

- [数据库迁移脚本](../../internal/pkg/migration/migrations/mysql/000003_init_plan_schema.up.sql)
- [事件配置](../../configs/events.yaml)
- [Worker 事件处理器](../../internal/worker/handlers/plan_handler.go)

