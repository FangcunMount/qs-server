# 11-06-02 Assessment èšåˆè®¾è®¡

> **ç‰ˆæœ¬**ï¼šV2.0  
> **æœ€åæ›´æ–°**ï¼š2025-11-29  
> **çŠ¶æ€**ï¼šâœ… å·²å®ç°å¹¶éªŒè¯

---

## ğŸ“‹ æ–‡æ¡£å¯¼èˆª

**å½“å‰ä½ç½®**ï¼šAssessment èšåˆè®¾è®¡ï¼ˆä½ åœ¨è¿™é‡Œï¼‰  
**å‰ç½®é˜…è¯»**ï¼š[11-06-01 Evaluationå­åŸŸæ¶æ„æ€»è§ˆ](./11-06-01-Evaluationå­åŸŸæ¶æ„æ€»è§ˆ.md)  
**åç»­é˜…è¯»**ï¼š

- [11-06-03 Calculationè®¡ç®—ç­–ç•¥è®¾è®¡](./11-06-03-Calculationè®¡ç®—ç­–ç•¥è®¾è®¡.md)
- [11-06-04 Interpretationè§£è¯»ç­–ç•¥è®¾è®¡](./11-06-04-Interpretationè§£è¯»ç­–ç•¥è®¾è®¡.md)

---

## ğŸ¯ æ ¸å¿ƒè®¾è®¡æ€æƒ³ï¼ˆ30ç§’é€Ÿè§ˆï¼‰

> **å¦‚æœåªæœ‰30ç§’ï¼Œä½ éœ€è¦çŸ¥é“è¿™äº›ï¼š**

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Assessment = æµ‹è¯„å®ä¾‹ = "ä¸€æ¬¡å…·ä½“çš„æµ‹è¯„è¡Œä¸º"             â”‚
â”‚                                                            â”‚
â”‚  å®ƒå›ç­”ä¸‰ä¸ªå…³é”®é—®é¢˜ï¼š                                      â”‚
â”‚    1. è°åœ¨ä»€ä¹ˆæ—¶å€™ç”¨ä»€ä¹ˆé‡è¡¨åšäº†æµ‹è¯„ï¼Ÿï¼ˆå…ƒæ•°æ®ï¼‰          â”‚
â”‚    2. æµ‹è¯„å¤„äºä»€ä¹ˆçŠ¶æ€ï¼Ÿï¼ˆçŠ¶æ€æœºï¼‰                        â”‚
â”‚    3. æµ‹è¯„ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿï¼ˆå¾—åˆ† + é£é™©ç­‰çº§ï¼‰                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ ¸å¿ƒè®¾è®¡ï¼š
  âœ“ èšåˆæ ¹æ¨¡å¼ - Assessment ç®¡ç† Score å®ä½“ï¼Œä¿è¯ä¸€è‡´æ€§
  âœ“ çŠ¶æ€æœºæ¨¡å¼ - 4ä¸ªçŠ¶æ€ï¼Œå•å‘æµè½¬ï¼Œä¸å¯å›é€€
  âœ“ å»ºé€ è€…æ¨¡å¼ - AssessmentCreator éªŒè¯å¹¶åˆ›å»ºå¤æ‚å¯¹è±¡
  âœ“ äº‹ä»¶é©±åŠ¨ - çŠ¶æ€å˜æ›´è‡ªåŠ¨å‘å¸ƒé¢†åŸŸäº‹ä»¶
  âœ“ å¼•ç”¨å¯¹è±¡ - ä¸ç›´æ¥æŒæœ‰å…¶ä»–èšåˆï¼Œç”¨å€¼å¯¹è±¡å¼•ç”¨
```

---

## ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ Assessment èšåˆï¼Ÿï¼ˆé—®é¢˜åŸŸï¼‰

### 1.1 æˆ‘ä»¬è¦è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ

åœ¨æµ‹è¯„ä¸šåŠ¡ä¸­ï¼Œ**ä¸€æ¬¡æµ‹è¯„ä¸æ˜¯ä¸€ä¸ªç®€å•çš„æ•°æ®è®°å½•**ï¼Œè€Œæ˜¯ä¸€ä¸ª**å¤æ‚çš„ä¸šåŠ¡æµç¨‹**ï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸šåŠ¡åœºæ™¯ï¼šå°æ˜éœ€è¦åšä¸€æ¬¡å¿ƒç†å¥åº·æµ‹è¯„                      â”‚
â”‚                                                             â”‚
â”‚  æµç¨‹1ï¼šåˆ›å»ºæµ‹è¯„                                            â”‚
â”‚    - å°æ˜ï¼ˆTesteeï¼‰                                        â”‚
â”‚    - ä½¿ç”¨"æŠ‘éƒè‡ªè¯„é‡è¡¨"ï¼ˆMedicalScaleï¼‰                   â”‚
â”‚    - åŸºäº"SDSé—®å· v1.0"ï¼ˆQuestionnaireï¼‰                  â”‚
â”‚    - ç­”å·ID: AS-20250129-001                               â”‚
â”‚    â†’ ç”Ÿæˆ Assessment: A-12345                              â”‚
â”‚                                                             â”‚
â”‚  æµç¨‹2ï¼šæäº¤æµ‹è¯„                                            â”‚
â”‚    - å°æ˜å¡«å†™å®Œ20é“é¢˜                                      â”‚
â”‚    - ç‚¹å‡»"æäº¤"                                            â”‚
â”‚    â†’ Assessment çŠ¶æ€ï¼šPending â†’ Submitted                  â”‚
â”‚    â†’ å‘å¸ƒäº‹ä»¶ï¼šAssessmentCreated                           â”‚
â”‚                                                             â”‚
â”‚  æµç¨‹3ï¼šå¼‚æ­¥è¯„ä¼°ï¼ˆqs-workerï¼‰                              â”‚
â”‚    - è®¡ç®—å„å› å­å¾—åˆ†                                        â”‚
â”‚    - è®¡ç®—æ€»åˆ†                                              â”‚
â”‚    - ç”Ÿæˆè§£è¯»                                              â”‚
â”‚    â†’ Assessment çŠ¶æ€ï¼šSubmitted â†’ Interpreted              â”‚
â”‚    â†’ è®°å½•ç»“æœï¼šTotalScore = 68, RiskLevel = Moderate       â”‚
â”‚                                                             â”‚
â”‚  æµç¨‹4ï¼šæŸ¥è¯¢ç»“æœ                                            â”‚
â”‚    - å°æ˜æŸ¥çœ‹æµ‹è¯„æŠ¥å‘Š                                      â”‚
â”‚    - ç®¡ç†å‘˜æŸ¥çœ‹ç»Ÿè®¡æ•°æ®                                    â”‚
â”‚    â†’ åŸºäº Assessment æŸ¥è¯¢å†å²ã€è¶‹åŠ¿ã€ç»Ÿè®¡                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é—®é¢˜æ‹†è§£**ï¼š

| é—®é¢˜ | æŒ‘æˆ˜ | Assessment çš„è§£å†³æ–¹æ¡ˆ |
|------|------|---------------------|
| å¦‚ä½•å…³è”å¤šä¸ªå®ä½“ï¼Ÿ | æµ‹è¯„æ¶‰åŠå—è¯•è€…ã€é—®å·ã€ç­”å·ã€é‡è¡¨ | **å¼•ç”¨å¯¹è±¡æ¨¡å¼** - ä½¿ç”¨å€¼å¯¹è±¡å¼•ç”¨ï¼Œä¸ç›´æ¥æŒæœ‰ |
| å¦‚ä½•ç®¡ç†å¤æ‚æµç¨‹ï¼Ÿ | åˆ›å»º â†’ æäº¤ â†’ è¯„ä¼° â†’ å®Œæˆ/å¤±è´¥ | **çŠ¶æ€æœºæ¨¡å¼** - 4ä¸ªçŠ¶æ€ï¼Œåˆæ³•æ€§æ ¡éªŒ |
| å¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Ÿ | æµ‹è¯„ + å¾—åˆ†å¿…é¡»åŒæ—¶æˆåŠŸæˆ–å¤±è´¥ | **èšåˆæ¨¡å¼** - Assessment ç®¡ç† Score å®ä½“ |
| å¦‚ä½•è§¦å‘åç»­æµç¨‹ï¼Ÿ | æäº¤åéœ€è¦å¼‚æ­¥è¯„ä¼° | **äº‹ä»¶é©±åŠ¨** - å‘å¸ƒ AssessmentCreated äº‹ä»¶ |
| å¦‚ä½•ç®€åŒ–å¤æ‚åˆ›å»ºï¼Ÿ | éœ€è¦éªŒè¯å¤šä¸ªä¾èµ–å¯¹è±¡ | **å»ºé€ è€…æ¨¡å¼** - AssessmentCreator |

### 1.2 èŒè´£è¾¹ç•Œï¼ˆæˆ‘ç®¡ä»€ä¹ˆï¼Œæˆ‘ä¸ç®¡ä»€ä¹ˆï¼‰

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Assessment èšåˆè¾¹ç•Œ                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  âœ… æˆ‘è´Ÿè´£çš„ï¼ˆæ ¸å¿ƒèŒè´£ï¼‰ï¼š                                  â”‚
â”‚    1. è®°å½•æµ‹è¯„å…ƒæ•°æ®ï¼ˆè°ã€é—®å·ã€ç­”å·ã€é‡è¡¨ã€æ¥æºï¼‰         â”‚
â”‚    2. ç®¡ç†æµ‹è¯„çŠ¶æ€ï¼ˆPending â†’ Submitted â†’ Interpretedï¼‰   â”‚
â”‚    3. è®°å½•è¯„ä¼°ç»“æœï¼ˆæ€»åˆ†ã€é£é™©ç­‰çº§ï¼‰                       â”‚
â”‚    4. ç®¡ç†å¾—åˆ†å®ä½“ï¼ˆScore ç”Ÿå‘½å‘¨æœŸï¼‰                       â”‚
â”‚    5. å‘å¸ƒé¢†åŸŸäº‹ä»¶ï¼ˆçŠ¶æ€å˜æ›´ã€è¯„ä¼°å®Œæˆï¼‰                   â”‚
â”‚                                                             â”‚
â”‚  âŒ æˆ‘ä¸å…³å¿ƒçš„ï¼ˆå…¶ä»–æ¨¡å—è´Ÿè´£ï¼‰ï¼š                            â”‚
â”‚    1. å¦‚ä½•è®¡ç®—åˆ†æ•° â†’ Calculation é¢†åŸŸæœåŠ¡                  â”‚
â”‚    2. å¦‚ä½•è§£è¯»ç»“æœ â†’ Interpretation é¢†åŸŸæœåŠ¡               â”‚
â”‚    3. å¦‚ä½•ç”ŸæˆæŠ¥å‘Š â†’ Report èšåˆ                           â”‚
â”‚    4. é—®å·/é‡è¡¨çš„å†…éƒ¨ç»“æ„ â†’ Survey/Scale å­åŸŸ              â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€Assessment èšåˆç»“æ„ï¼ˆæ˜¯ä»€ä¹ˆï¼Ÿï¼‰

### 2.1 èšåˆæ ¹ï¼šAssessment

**æ ¸å¿ƒå®šä½**ï¼šæµ‹è¯„å®ä¾‹çš„èšåˆæ ¹ï¼Œä»£è¡¨"ä¸€æ¬¡å…·ä½“çš„æµ‹è¯„è¡Œä¸º"

```go
// ä»£ç ä½ç½®ï¼šinternal/apiserver/domain/evaluation/assessment/assessment.go
type Assessment struct {
    // ===== æ ¸å¿ƒæ ‡è¯† =====
    id    ID              // æµ‹è¯„å”¯ä¸€æ ‡è¯†
    orgID int64           // æ‰€å±æœºæ„
    
    // ===== å…³è”å®ä½“å¼•ç”¨ï¼ˆé˜²è…å±‚ï¼‰=====
    testeeRef        testee.ID         // å—è¯•è€…å¼•ç”¨
    questionnaireRef QuestionnaireRef  // é—®å·å¼•ç”¨ï¼ˆCode + Versionï¼‰
    answerSheetRef   AnswerSheetRef    // ç­”å·å¼•ç”¨ï¼ˆIDï¼‰
    medicalScaleRef  *MedicalScaleRef  // é‡è¡¨å¼•ç”¨ï¼ˆå¯é€‰ï¼‰
    
    // ===== ä¸šåŠ¡æ¥æº =====
    origin Origin  // adhoc | plan | screening
    
    // ===== çŠ¶æ€ä¸ç»“æœ =====
    status     Status      // pending | submitted | interpreted | failed
    totalScore *float64    // æ€»åˆ†ï¼ˆè¯„ä¼°åå¡«å……ï¼‰
    riskLevel  *RiskLevel  // é£é™©ç­‰çº§ï¼ˆè¯„ä¼°åå¡«å……ï¼‰
    
    // ===== æ—¶é—´æˆ³ =====
    createdAt     time.Time    // åˆ›å»ºæ—¶é—´
    submittedAt   *time.Time   // æäº¤æ—¶é—´
    interpretedAt *time.Time   // è§£è¯»å®Œæˆæ—¶é—´
    failedAt      *time.Time   // å¤±è´¥æ—¶é—´
    
    // ===== å¤±è´¥ä¿¡æ¯ =====
    failureReason *string
    
    // ===== é¢†åŸŸäº‹ä»¶ï¼ˆæœªæŒä¹…åŒ–ï¼‰=====
    events []DomainEvent
}
```

**èšåˆç»“æ„å›¾**ï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Assessmentï¼ˆèšåˆæ ¹ï¼‰                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ ¸å¿ƒå±æ€§ï¼š                                              â”‚
â”‚  - ID, OrgID                                            â”‚
â”‚  - Statusï¼ˆçŠ¶æ€æœºï¼‰                                     â”‚
â”‚  - TotalScore, RiskLevelï¼ˆè¯„ä¼°ç»“æœï¼‰                   â”‚
â”‚                                                          â”‚
â”‚  å¼•ç”¨å¯¹è±¡ï¼ˆå€¼å¯¹è±¡ï¼‰ï¼š                                    â”‚
â”‚  - TesteeRef                                            â”‚
â”‚  - QuestionnaireRef (Code + Version)                   â”‚
â”‚  - AnswerSheetRef (ID)                                 â”‚
â”‚  - MedicalScaleRef (Code, å¯é€‰)                        â”‚
â”‚                                                          â”‚
â”‚  èšåˆè¾¹ç•Œå†…çš„å®ä½“ï¼š                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  Scoreï¼ˆå¾—åˆ†å®ä½“ï¼‰                 â”‚                â”‚
â”‚  â”‚  - AssessmentIDï¼ˆå¤–é”®ï¼‰            â”‚                â”‚
â”‚  â”‚  - FactorCodeï¼ˆå› å­ç¼–ç ï¼‰          â”‚                â”‚
â”‚  â”‚  - Scoreï¼ˆå¾—åˆ†å€¼ï¼‰                 â”‚                â”‚
â”‚  â”‚  - RiskLevelï¼ˆé£é™©ç­‰çº§ï¼‰           â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                          â”‚
â”‚  é¢†åŸŸäº‹ä»¶ï¼š                                              â”‚
â”‚  - AssessmentCreatedEvent                               â”‚
â”‚  - EvaluationCompletedEvent                             â”‚
â”‚  - EvaluationFailedEvent                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å®ä½“ï¼šScoreï¼ˆå¾—åˆ†ï¼‰

**æ ¸å¿ƒå®šä½**ï¼šè®°å½•è¯„ä¼°çš„å…·ä½“å¾—åˆ†ï¼ˆå› å­å¾—åˆ†æˆ–æ€»åˆ†ï¼‰

```go
// ä»£ç ä½ç½®ï¼šinternal/apiserver/domain/evaluation/assessment/score.go
type Score struct {
    id           ID            // å¾—åˆ†ID
    assessmentID AssessmentID  // æ‰€å±æµ‹è¯„
    
    // å› å­ä¿¡æ¯ï¼ˆnil è¡¨ç¤ºæ€»åˆ†ï¼‰
    factorCode *string  // å› å­ç¼–ç ï¼ˆå¦‚ "F1", "F2"ï¼‰
    factorName *string  // å› å­åç§°ï¼ˆå¦‚ "è®¤çŸ¥å› å­"ï¼‰
    
    // å¾—åˆ†ä¿¡æ¯
    score      float64    // å¾—åˆ†å€¼
    percentage *float64   // ç™¾åˆ†æ¯”ï¼ˆç›¸å¯¹äºæ»¡åˆ†ï¼‰
    
    // è§£è¯»ä¿¡æ¯
    level          *string  // é£é™©ç­‰çº§ï¼ˆlow/moderate/highï¼‰
    interpretation *string  // è§£è¯»æ–‡æœ¬
    
    // æ—¶é—´æˆ³
    createdAt time.Time
}
```

**Score ä¸ Assessment çš„å…³ç³»**ï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Assessment (1) â”€â”€â”€ç®¡ç†â”€â”€â”€> (N) Score                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                        â”‚
â”‚  èšåˆè¾¹ç•Œï¼šScore åªèƒ½é€šè¿‡ Assessment è®¿é—®             â”‚
â”‚  ç”Ÿå‘½å‘¨æœŸï¼šScore éš Assessment åˆ›å»ºå’Œé”€æ¯             â”‚
â”‚  äº‹åŠ¡è¾¹ç•Œï¼šAssessment + Scores åœ¨åŒä¸€äº‹åŠ¡ä¸­æŒä¹…åŒ–     â”‚
â”‚                                                        â”‚
â”‚  ç¤ºä¾‹ï¼š                                                â”‚
â”‚    Assessment ID: A-12345                             â”‚
â”‚      â”œâ”€ Score: FactorCode=null (æ€»åˆ†)                â”‚
â”‚      â”œâ”€ Score: FactorCode="F1" (è®¤çŸ¥å› å­)            â”‚
â”‚      â”œâ”€ Score: FactorCode="F2" (æƒ…æ„Ÿå› å­)            â”‚
â”‚      â””â”€ Score: FactorCode="F3" (èº¯ä½“å› å­)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 å€¼å¯¹è±¡ï¼šå¼•ç”¨å¯¹è±¡ï¼ˆReference Objectsï¼‰

**ä¸ºä»€ä¹ˆä½¿ç”¨å¼•ç”¨å¯¹è±¡ï¼Ÿ**

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é—®é¢˜ï¼šå¦‚ä½•å¼•ç”¨å…¶ä»–å­åŸŸçš„èšåˆæ ¹ï¼Ÿ                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  âŒ é”™è¯¯åšæ³•ï¼šç›´æ¥æŒæœ‰èšåˆæ ¹                             â”‚
â”‚                                                          â”‚
â”‚    type Assessment struct {                             â”‚
â”‚        questionnaire *Questionnaire  // ç›´æ¥ä¾èµ–        â”‚
â”‚        answerSheet   *AnswerSheet    // å¼ºè€¦åˆ          â”‚
â”‚    }                                                     â”‚
â”‚                                                          â”‚
â”‚  é—®é¢˜ï¼š                                                  â”‚
â”‚    - è·¨èšåˆè€¦åˆä¸¥é‡                                     â”‚
â”‚    - ç”Ÿå‘½å‘¨æœŸæ··ä¹±                                       â”‚
â”‚    - äº‹åŠ¡è¾¹ç•Œä¸æ¸…                                       â”‚
â”‚    - åŠ è½½æ€§èƒ½å·®                                         â”‚
â”‚                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  âœ… æ­£ç¡®åšæ³•ï¼šä½¿ç”¨å¼•ç”¨å¯¹è±¡ï¼ˆå€¼å¯¹è±¡ï¼‰                     â”‚
â”‚                                                          â”‚
â”‚    type Assessment struct {                             â”‚
â”‚        questionnaireRef QuestionnaireRef  // å€¼å¯¹è±¡å¼•ç”¨ â”‚
â”‚        answerSheetRef   AnswerSheetRef    // è½»é‡çº§     â”‚
â”‚    }                                                     â”‚
â”‚                                                          â”‚
â”‚    type QuestionnaireRef struct {                       â”‚
â”‚        code    string  // é—®å·ç¼–ç                       â”‚
â”‚        version string  // é—®å·ç‰ˆæœ¬                      â”‚
â”‚    }                                                     â”‚
â”‚                                                          â”‚
â”‚  ä¼˜åŠ¿ï¼š                                                  â”‚
â”‚    âœ“ è§£è€¦ï¼šåªå­˜å‚¨å¿…è¦çš„å¼•ç”¨ä¿¡æ¯                         â”‚
â”‚    âœ“ è½»é‡ï¼šæ˜“äºåºåˆ—åŒ–å’Œä¼ è¾“                             â”‚
â”‚    âœ“ ç‹¬ç«‹ï¼šå¯ä»¥ç‹¬ç«‹éªŒè¯æœ‰æ•ˆæ€§                           â”‚
â”‚    âœ“ æ¸…æ™°ï¼šæ˜ç¡®è·¨èšåˆè¾¹ç•Œ                               â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å¼•ç”¨å¯¹è±¡å®šä¹‰**ï¼š

```go
// ä»£ç ä½ç½®ï¼šinternal/apiserver/domain/evaluation/assessment/types.go

// QuestionnaireRef é—®å·å¼•ç”¨
type QuestionnaireRef struct {
    code    string  // é—®å·ç¼–ç ï¼ˆå¦‚ "SDS"ï¼‰
    version string  // é—®å·ç‰ˆæœ¬ï¼ˆå¦‚ "v1.0"ï¼‰
}

// AnswerSheetRef ç­”å·å¼•ç”¨
type AnswerSheetRef struct {
    id string  // ç­”å·IDï¼ˆMongoDB ObjectIDï¼‰
}

// MedicalScaleRef é‡è¡¨å¼•ç”¨
type MedicalScaleRef struct {
    code string  // é‡è¡¨ç¼–ç ï¼ˆå¦‚ "SDS"ï¼‰
}
```

### 2.4 å€¼å¯¹è±¡ï¼šOriginï¼ˆæµ‹è¯„æ¥æºï¼‰

**æ ¸å¿ƒå®šä½**ï¼šè®°å½•æµ‹è¯„çš„ä¸šåŠ¡æ¥æº

```go
// ä»£ç ä½ç½®ï¼šinternal/apiserver/domain/evaluation/assessment/types.go

// OriginType æ¥æºç±»å‹
type OriginType string

const (
    OriginAdhoc     OriginType = "adhoc"      // ä¸€æ¬¡æ€§æµ‹è¯„ï¼ˆæ‰‹åŠ¨åˆ›å»ºï¼‰
    OriginPlan      OriginType = "plan"       // æµ‹è¯„è®¡åˆ’
    OriginScreening OriginType = "screening"  // å…¥æ ¡ç­›æŸ¥
)

// Origin æµ‹è¯„æ¥æºå€¼å¯¹è±¡
type Origin struct {
    originType OriginType  // æ¥æºç±»å‹
    refID      *string     // å…³è”IDï¼ˆplan/screening æ—¶å¿…å¡«ï¼‰
}

// å·¥å‚æ–¹æ³•
func NewAdhocOrigin() Origin {
    return Origin{originType: OriginAdhoc}
}

func NewPlanOrigin(planID string) Origin {
    return Origin{originType: OriginPlan, refID: &planID}
}

func NewScreeningOrigin(screeningProjectID string) Origin {
    return Origin{originType: OriginScreening, refID: &screeningProjectID}
}
```

**Origin çš„ä½œç”¨**ï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Origin çš„ä¸‰ç§ç±»å‹åŠå…¶ç”¨é€”                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  1. Adhocï¼ˆä¸€æ¬¡æ€§æµ‹è¯„ï¼‰                                 â”‚
â”‚     åœºæ™¯ï¼šç®¡ç†å‘˜æ‰‹åŠ¨ä¸ºæŸç”¨æˆ·åˆ›å»ºæµ‹è¯„                    â”‚
â”‚     ç‰¹ç‚¹ï¼šä¸å…³è”ä»»ä½•è®¡åˆ’æˆ–ç­›æŸ¥                          â”‚
â”‚     ç¤ºä¾‹ï¼šOrigin{type: "adhoc"}                         â”‚
â”‚                                                          â”‚
â”‚  2. Planï¼ˆæµ‹è¯„è®¡åˆ’ï¼‰                                    â”‚
â”‚     åœºæ™¯ï¼šæ‚£è€…å‡ºé™¢åå‘¨æœŸæ€§éšè®¿æµ‹è¯„                      â”‚
â”‚     ç‰¹ç‚¹ï¼šå…³è” AssessmentPlanï¼Œå¯èƒ½é‡å¤æ‰§è¡Œ             â”‚
â”‚     ç¤ºä¾‹ï¼šOrigin{type: "plan", refID: "PLAN-001"}      â”‚
â”‚                                                          â”‚
â”‚  3. Screeningï¼ˆå…¥æ ¡ç­›æŸ¥ï¼‰                               â”‚
â”‚     åœºæ™¯ï¼šæ–°ç”Ÿå…¥å­¦å¿ƒç†å¥åº·ç­›æŸ¥                          â”‚
â”‚     ç‰¹ç‚¹ï¼šå…³è” ScreeningProjectï¼Œæ‰¹é‡æ‰§è¡Œ               â”‚
â”‚     ç¤ºä¾‹ï¼šOrigin{type: "screening", refID: "SCR-001"}  â”‚
â”‚                                                          â”‚
â”‚  ä½œç”¨ï¼š                                                  â”‚
â”‚    - ç»Ÿè®¡åˆ†æï¼šæŒ‰æ¥æºç»Ÿè®¡æµ‹è¯„æ•°é‡                       â”‚
â”‚    - ä¸šåŠ¡è¿½æº¯ï¼šå›æº¯æµ‹è¯„çš„ä¸šåŠ¡åœºæ™¯                       â”‚
â”‚    - æƒé™æ§åˆ¶ï¼šä¸åŒæ¥æºæœ‰ä¸åŒçš„è®¿é—®æƒé™                 â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€Assessment çŠ¶æ€æœºï¼ˆå¦‚ä½•è¿è½¬ï¼Ÿï¼‰

### 3.1 çŠ¶æ€æœºå…¨æ™¯å›¾

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Assessment ç”Ÿå‘½å‘¨æœŸçŠ¶æ€æœº                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   åˆ›å»º â”‚  Pending  â”‚  å¾…æäº¤ï¼ˆåˆå§‹çŠ¶æ€ï¼‰
        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ Submit()
              â”‚ - éªŒè¯ç­”å·å®Œæ•´æ€§
              â”‚ - å‘å¸ƒ AssessmentCreatedEvent
              â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Submitted â”‚  å·²æäº¤ï¼ˆç­‰å¾…è¯„ä¼°ï¼‰
        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ qs-worker æ¶ˆè´¹äº‹ä»¶
              â”‚ è°ƒç”¨ EvaluationService.Evaluate()
              â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Evaluating â”‚  è¯„ä¼°ä¸­ï¼ˆç¬æ€ï¼Œå¯é€‰ï¼‰
        â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
           â”‚      â”‚
           â”‚      â”‚ MarkAsFailed(reason)
           â”‚      â”‚ - è®°å½•å¤±è´¥åŸå› 
           â”‚      â”‚ - å‘å¸ƒ EvaluationFailedEvent
           â”‚      â†“
           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  â”‚ Failed â”‚  å¤±è´¥ï¼ˆç»ˆæ€ï¼‰
           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ ApplyEvaluation(result)
           â”‚ - è®°å½•æ€»åˆ†å’Œé£é™©ç­‰çº§
           â”‚ - å‘å¸ƒ EvaluationCompletedEvent
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Interpreted  â”‚  å·²è§£è¯»ï¼ˆç»ˆæ€ï¼‰
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**çŠ¶æ€å®šä¹‰**ï¼š

```go
// ä»£ç ä½ç½®ï¼šinternal/apiserver/domain/evaluation/assessment/types.go

type Status string

const (
    StatusPending     Status = "pending"      // å¾…æäº¤
    StatusSubmitted   Status = "submitted"    // å·²æäº¤
    StatusInterpreted Status = "interpreted"  // å·²è§£è¯»
    StatusFailed      Status = "failed"       // å¤±è´¥
)

// çŠ¶æ€åˆ¤æ–­æ–¹æ³•
func (s Status) IsPending() bool     { return s == StatusPending }
func (s Status) IsSubmitted() bool   { return s == StatusSubmitted }
func (s Status) IsInterpreted() bool { return s == StatusInterpreted }
func (s Status) IsFailed() bool      { return s == StatusFailed }
func (s Status) IsTerminal() bool    { return s.IsInterpreted() || s.IsFailed() }
```

### 3.2 çŠ¶æ€è½¬æ¢æ–¹æ³•ï¼ˆé¢†åŸŸé€»è¾‘ï¼‰

#### 3.2.1 Submit() - æäº¤æµ‹è¯„

```go
// ä»£ç ä½ç½®ï¼šinternal/apiserver/domain/evaluation/assessment/assessment.go

func (a *Assessment) Submit() error {
    // 1. çŠ¶æ€æ ¡éªŒ
    if !a.status.IsPending() {
        return ErrInvalidStatusTransition
    }
    
    // 2. çŠ¶æ€è¿ç§»
    a.status = StatusSubmitted
    now := time.Now()
    a.submittedAt = &now
    
    // 3. å‘å¸ƒé¢†åŸŸäº‹ä»¶
    event := NewAssessmentCreatedEvent(
        a.id,
        a.testeeRef,
        a.questionnaireRef,
        a.answerSheetRef,
        a.medicalScaleRef,
        a.origin,
        now,
    )
    a.publishEvent(event)
    
    return nil
}
```

**æµç¨‹å›¾**ï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Submit() æ‰§è¡Œæµç¨‹                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  1. æ£€æŸ¥å‰ç½®æ¡ä»¶                                    â”‚
â”‚     â”œâ”€ çŠ¶æ€å¿…é¡»æ˜¯ Pending                          â”‚
â”‚     â””â”€ å¦‚æœä¸æ˜¯ â†’ è¿”å›é”™è¯¯                         â”‚
â”‚                                                     â”‚
â”‚  2. çŠ¶æ€è¿ç§»                                        â”‚
â”‚     â”œâ”€ status: Pending â†’ Submitted                 â”‚
â”‚     â””â”€ submittedAt: time.Now()                     â”‚
â”‚                                                     â”‚
â”‚  3. å‘å¸ƒé¢†åŸŸäº‹ä»¶                                    â”‚
â”‚     â””â”€ AssessmentCreatedEvent                      â”‚
â”‚         â”œâ”€ EventType: "assessment.created"         â”‚
â”‚         â”œâ”€ AssessmentID                            â”‚
â”‚         â”œâ”€ TesteeID                                â”‚
â”‚         â””â”€ ... (å…¶ä»–å…ƒæ•°æ®)                        â”‚
â”‚                                                     â”‚
â”‚  4. è¿”å›æˆåŠŸ                                        â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.2.2 ApplyEvaluation() - åº”ç”¨è¯„ä¼°ç»“æœ

```go
func (a *Assessment) ApplyEvaluation(result *EvaluationResult) error {
    // 1. çŠ¶æ€æ ¡éªŒ
    if !a.status.IsSubmitted() {
        return ErrInvalidStatusTransition
    }
    
    // 2. éªŒè¯è¯„ä¼°ç»“æœ
    if result == nil || result.TotalScore < 0 {
        return ErrInvalidEvaluationResult
    }
    
    // 3. è®°å½•è¯„ä¼°ç»“æœ
    a.totalScore = &result.TotalScore
    a.riskLevel = &result.RiskLevel
    
    // 4. çŠ¶æ€è¿ç§»
    a.status = StatusInterpreted
    now := time.Now()
    a.interpretedAt = &now
    
    // 5. å‘å¸ƒé¢†åŸŸäº‹ä»¶
    event := NewEvaluationCompletedEvent(
        a.id,
        result.TotalScore,
        result.RiskLevel,
        now,
    )
    a.publishEvent(event)
    
    return nil
}
```

#### 3.2.3 MarkAsFailed() - æ ‡è®°å¤±è´¥

```go
func (a *Assessment) MarkAsFailed(reason string) {
    // 1. è®°å½•å¤±è´¥ä¿¡æ¯
    a.status = StatusFailed
    a.failureReason = &reason
    now := time.Now()
    a.failedAt = &now
    
    // 2. å‘å¸ƒé¢†åŸŸäº‹ä»¶
    event := NewEvaluationFailedEvent(
        a.id,
        reason,
        now,
    )
    a.publishEvent(event)
}
```

### 3.3 çŠ¶æ€è½¬æ¢åˆæ³•æ€§æ ¡éªŒ

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  çŠ¶æ€è½¬æ¢è§„åˆ™ï¼ˆçŠ¶æ€æœºä¸å˜æ€§ï¼‰                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  âœ… åˆæ³•è½¬æ¢ï¼š                                              â”‚
â”‚     Pending     â†’ Submitted     (Submit)                   â”‚
â”‚     Submitted   â†’ Interpreted   (ApplyEvaluation)          â”‚
â”‚     Submitted   â†’ Failed        (MarkAsFailed)             â”‚
â”‚                                                             â”‚
â”‚  âŒ éæ³•è½¬æ¢ï¼ˆä»£ç å±‚é¢ç¦æ­¢ï¼‰ï¼š                              â”‚
â”‚     Interpreted â†’ Pending       (å·²å®Œæˆä¸èƒ½å›é€€)           â”‚
â”‚     Failed      â†’ Submitted     (å¤±è´¥ä¸èƒ½é‡æ–°æäº¤)         â”‚
â”‚     Pending     â†’ Interpreted   (å¿…é¡»ç»è¿‡ Submitted)       â”‚
â”‚                                                             â”‚
â”‚  ç»ˆæ€åˆ¤æ–­ï¼š                                                 â”‚
â”‚     Interpreted - ç»ˆæ€ï¼ˆæˆåŠŸå®Œæˆï¼‰                         â”‚
â”‚     Failed      - ç»ˆæ€ï¼ˆå¤±è´¥ç»“æŸï¼‰                         â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å››ã€AssessmentCreatorï¼ˆå»ºé€ è€…æ¨¡å¼ï¼‰

### 4.1 ä¸ºä»€ä¹ˆéœ€è¦ Creatorï¼Ÿ

**é—®é¢˜åœºæ™¯**ï¼šåˆ›å»º Assessment éœ€è¦éªŒè¯å¤šä¸ªä¾èµ–å¯¹è±¡

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆ›å»º Assessment çš„æŒ‘æˆ˜                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  éœ€è¦éªŒè¯ï¼š                                              â”‚
â”‚    1. Testee æ˜¯å¦å­˜åœ¨ï¼Ÿ                                 â”‚
â”‚    2. Questionnaire æ˜¯å¦å­˜åœ¨ä¸”å·²å‘å¸ƒï¼Ÿ                  â”‚
â”‚    3. AnswerSheet æ˜¯å¦å­˜åœ¨ä¸”å±äºè¯¥é—®å·ï¼Ÿ                â”‚
â”‚    4. MedicalScale æ˜¯å¦å­˜åœ¨ä¸”ä¸é—®å·å…³è”ï¼Ÿï¼ˆå¯é€‰ï¼‰       â”‚
â”‚                                                          â”‚
â”‚  å¦‚æœä¸ç”¨ Builderï¼š                                      â”‚
â”‚    âŒ éªŒè¯é€»è¾‘åˆ†æ•£åœ¨åº”ç”¨æœåŠ¡å±‚ï¼ˆé€»è¾‘æ³„æ¼ï¼‰              â”‚
â”‚    âŒ æ¯ä¸ªè°ƒç”¨æ–¹éƒ½è¦é‡å¤éªŒè¯ï¼ˆä»£ç é‡å¤ï¼‰                â”‚
â”‚    âŒ éªŒè¯å¤±è´¥æ—¶ï¼Œéƒ¨åˆ†å¯¹è±¡å·²åˆ›å»ºï¼ˆä¸ä¸€è‡´ï¼‰              â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å»ºé€ è€…æ¨¡å¼è§£å†³æ–¹æ¡ˆ**ï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AssessmentCreatorï¼ˆå»ºé€ è€…ï¼‰                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  èŒè´£ï¼š                                                  â”‚
â”‚    1. éªŒè¯æ‰€æœ‰ä¾èµ–å¯¹è±¡ï¼ˆè·¨èšåˆéªŒè¯ï¼‰                    â”‚
â”‚    2. åˆ›å»º Assessment èšåˆæ ¹                            â”‚
â”‚    3. è‡ªåŠ¨æäº¤ï¼ˆè°ƒç”¨ Submitï¼‰                           â”‚
â”‚    4. è¿”å›å®Œæ•´çš„ Assessment å¯¹è±¡                        â”‚
â”‚                                                          â”‚
â”‚  ä¼˜åŠ¿ï¼š                                                  â”‚
â”‚    âœ“ éªŒè¯é€»è¾‘å°è£…åœ¨é¢†åŸŸå±‚                               â”‚
â”‚    âœ“ åˆ›å»ºè¿‡ç¨‹å¯æ§ï¼ˆåˆ†æ­¥éªŒè¯ï¼‰                           â”‚
â”‚    âœ“ æ˜“äºæµ‹è¯•ï¼ˆMock éªŒè¯å™¨ï¼‰                            â”‚
â”‚    âœ“ åŸå­æ€§ä¿è¯ï¼ˆå…¨éƒ¨æˆåŠŸæˆ–å…¨éƒ¨å¤±è´¥ï¼‰                   â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Creator æ¥å£è®¾è®¡

```go
// ä»£ç ä½ç½®ï¼šinternal/apiserver/domain/evaluation/assessment/creator.go

// AssessmentCreator æµ‹è¯„åˆ›å»ºå™¨æ¥å£ï¼ˆé¢†åŸŸæœåŠ¡ï¼‰
type AssessmentCreator interface {
    // Create åˆ›å»ºæµ‹è¯„
    // - éªŒè¯æ‰€æœ‰ä¾èµ–å¯¹è±¡
    // - åˆ›å»º Assessment èšåˆæ ¹
    // - è‡ªåŠ¨æäº¤ï¼ˆçŠ¶æ€ â†’ Submittedï¼‰
    // - å‘å¸ƒ AssessmentCreatedEvent
    Create(ctx context.Context, req CreateAssessmentRequest) (*Assessment, error)
}

// CreateAssessmentRequest åˆ›å»ºè¯·æ±‚
type CreateAssessmentRequest struct {
    // å¿…å¡«å­—æ®µ
    OrgID            int64
    TesteeID         testee.ID
    QuestionnaireRef QuestionnaireRef
    AnswerSheetRef   AnswerSheetRef
    
    // æ¥æºä¿¡æ¯
    Origin Origin
    
    // å¯é€‰å­—æ®µ
    MedicalScaleRef *MedicalScaleRef
    
    // æ˜¯å¦è‡ªåŠ¨æäº¤ï¼ˆé»˜è®¤ trueï¼‰
    AutoSubmit bool
}
```

### 4.3 Creator å®ç°

```go
// DefaultAssessmentCreator é»˜è®¤å®ç°
type DefaultAssessmentCreator struct {
    testeeValidator        TesteeValidator
    questionnaireValidator QuestionnaireValidator
    answerSheetValidator   AnswerSheetValidator
    scaleValidator         ScaleValidator
}

// Create åˆ›å»ºæµ‹è¯„
func (c *DefaultAssessmentCreator) Create(
    ctx context.Context,
    req CreateAssessmentRequest,
) (*Assessment, error) {
    
    // ========== æ­¥éª¤1: éªŒè¯å—è¯•è€… ==========
    exists, err := c.testeeValidator.Exists(ctx, req.TesteeID)
    if err != nil {
        return nil, fmt.Errorf("éªŒè¯å—è¯•è€…å¤±è´¥: %w", err)
    }
    if !exists {
        return nil, ErrTesteeNotFound
    }
    
    // ========== æ­¥éª¤2: éªŒè¯é—®å· ==========
    exists, err = c.questionnaireValidator.Exists(ctx, req.QuestionnaireRef)
    if err != nil {
        return nil, fmt.Errorf("éªŒè¯é—®å·å¤±è´¥: %w", err)
    }
    if !exists {
        return nil, ErrQuestionnaireNotFound
    }
    
    // æ£€æŸ¥é—®å·æ˜¯å¦å·²å‘å¸ƒ
    published, err := c.questionnaireValidator.IsPublished(ctx, req.QuestionnaireRef)
    if err != nil {
        return nil, fmt.Errorf("æ£€æŸ¥é—®å·çŠ¶æ€å¤±è´¥: %w", err)
    }
    if !published {
        return nil, ErrQuestionnaireNotPublished
    }
    
    // ========== æ­¥éª¤3: éªŒè¯ç­”å· ==========
    exists, err = c.answerSheetValidator.Exists(ctx, req.AnswerSheetRef)
    if err != nil {
        return nil, fmt.Errorf("éªŒè¯ç­”å·å¤±è´¥: %w", err)
    }
    if !exists {
        return nil, ErrAnswerSheetNotFound
    }
    
    // æ£€æŸ¥ç­”å·æ˜¯å¦å±äºè¯¥é—®å·
    belongs, err := c.answerSheetValidator.BelongsToQuestionnaire(
        ctx, 
        req.AnswerSheetRef, 
        req.QuestionnaireRef,
    )
    if err != nil {
        return nil, fmt.Errorf("æ£€æŸ¥ç­”å·å½’å±å¤±è´¥: %w", err)
    }
    if !belongs {
        return nil, ErrAnswerSheetNotBelongsToQuestionnaire
    }
    
    // ========== æ­¥éª¤4: éªŒè¯é‡è¡¨ï¼ˆå¯é€‰ï¼‰==========
    if req.MedicalScaleRef != nil {
        exists, err = c.scaleValidator.Exists(ctx, *req.MedicalScaleRef)
        if err != nil {
            return nil, fmt.Errorf("éªŒè¯é‡è¡¨å¤±è´¥: %w", err)
        }
        if !exists {
            return nil, ErrMedicalScaleNotFound
        }
        
        // æ£€æŸ¥é‡è¡¨æ˜¯å¦ä¸é—®å·å…³è”
        linked, err := c.scaleValidator.IsLinkedToQuestionnaire(
            ctx,
            *req.MedicalScaleRef,
            req.QuestionnaireRef,
        )
        if err != nil {
            return nil, fmt.Errorf("æ£€æŸ¥é‡è¡¨å…³è”å¤±è´¥: %w", err)
        }
        if !linked {
            return nil, ErrMedicalScaleNotLinkedToQuestionnaire
        }
    }
    
    // ========== æ­¥éª¤5: åˆ›å»º Assessment ==========
    assess, err := NewAssessment(
        req.OrgID,
        req.TesteeID,
        req.QuestionnaireRef,
        req.AnswerSheetRef,
        req.Origin,
        WithMedicalScale(req.MedicalScaleRef),
    )
    if err != nil {
        return nil, fmt.Errorf("åˆ›å»ºæµ‹è¯„å¤±è´¥: %w", err)
    }
    
    // ========== æ­¥éª¤6: è‡ªåŠ¨æäº¤ï¼ˆå¯é€‰ï¼‰==========
    if req.AutoSubmit {
        if err := assess.Submit(); err != nil {
            return nil, fmt.Errorf("æäº¤æµ‹è¯„å¤±è´¥: %w", err)
        }
    }
    
    return assess, nil
}
```

**åˆ›å»ºæµç¨‹å›¾**ï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AssessmentCreator.Create() æ‰§è¡Œæµç¨‹                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  1. éªŒè¯ Testee                                            â”‚
â”‚     â”œâ”€ è°ƒç”¨ TesteeValidator.Exists()                      â”‚
â”‚     â””â”€ ä¸å­˜åœ¨ â†’ è¿”å› ErrTesteeNotFound                    â”‚
â”‚                                                            â”‚
â”‚  2. éªŒè¯ Questionnaire                                     â”‚
â”‚     â”œâ”€ è°ƒç”¨ QuestionnaireValidator.Exists()               â”‚
â”‚     â”œâ”€ è°ƒç”¨ QuestionnaireValidator.IsPublished()          â”‚
â”‚     â””â”€ æœªå‘å¸ƒ â†’ è¿”å› ErrQuestionnaireNotPublished         â”‚
â”‚                                                            â”‚
â”‚  3. éªŒè¯ AnswerSheet                                       â”‚
â”‚     â”œâ”€ è°ƒç”¨ AnswerSheetValidator.Exists()                 â”‚
â”‚     â”œâ”€ è°ƒç”¨ BelongsToQuestionnaire()                      â”‚
â”‚     â””â”€ ä¸åŒ¹é… â†’ è¿”å› ErrNotBelongs                        â”‚
â”‚                                                            â”‚
â”‚  4. éªŒè¯ MedicalScaleï¼ˆå¯é€‰ï¼‰                              â”‚
â”‚     â”œâ”€ è°ƒç”¨ ScaleValidator.Exists()                       â”‚
â”‚     â”œâ”€ è°ƒç”¨ IsLinkedToQuestionnaire()                     â”‚
â”‚     â””â”€ æœªå…³è” â†’ è¿”å› ErrNotLinked                         â”‚
â”‚                                                            â”‚
â”‚  5. åˆ›å»º Assessment                                        â”‚
â”‚     â”œâ”€ NewAssessment(...)                                 â”‚
â”‚     â””â”€ çŠ¶æ€ï¼šPending                                      â”‚
â”‚                                                            â”‚
â”‚  6. è‡ªåŠ¨æäº¤ï¼ˆAutoSubmit=trueï¼‰                           â”‚
â”‚     â”œâ”€ assess.Submit()                                    â”‚
â”‚     â”œâ”€ çŠ¶æ€ï¼šPending â†’ Submitted                          â”‚
â”‚     â””â”€ å‘å¸ƒï¼šAssessmentCreatedEvent                       â”‚
â”‚                                                            â”‚
â”‚  7. è¿”å› Assessment                                        â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äº”ã€é¢†åŸŸäº‹ä»¶è®¾è®¡

### 5.1 äº‹ä»¶æ¥å£

```go
// ä»£ç ä½ç½®ï¼šinternal/apiserver/domain/evaluation/assessment/events.go

// DomainEvent é¢†åŸŸäº‹ä»¶æ¥å£
type DomainEvent interface {
    EventID() string      // äº‹ä»¶å”¯ä¸€æ ‡è¯†
    EventType() string    // äº‹ä»¶ç±»å‹
    OccurredAt() time.Time // äº‹ä»¶å‘ç”Ÿæ—¶é—´
    AggregateID() ID      // èšåˆæ ¹ID
}
```

### 5.2 æ ¸å¿ƒäº‹ä»¶

#### 5.2.1 AssessmentCreatedEvent - æµ‹è¯„å·²åˆ›å»º

**è§¦å‘æ—¶æœº**ï¼šAssessment.Submit() è¢«è°ƒç”¨æ—¶

```go
type AssessmentCreatedEvent struct {
    baseEvent
    assessmentID     ID
    testeeID         testee.ID
    questionnaireRef QuestionnaireRef
    answerSheetRef   AnswerSheetRef
    medicalScaleRef  *MedicalScaleRef
    origin           Origin
    submittedAt      time.Time
}

// NewAssessmentCreatedEvent åˆ›å»ºäº‹ä»¶
func NewAssessmentCreatedEvent(
    assessmentID ID,
    testeeID testee.ID,
    questionnaireRef QuestionnaireRef,
    answerSheetRef AnswerSheetRef,
    medicalScaleRef *MedicalScaleRef,
    origin Origin,
    submittedAt time.Time,
) *AssessmentCreatedEvent {
    return &AssessmentCreatedEvent{
        baseEvent:        newBaseEvent("assessment.created"),
        assessmentID:     assessmentID,
        testeeID:         testeeID,
        questionnaireRef: questionnaireRef,
        answerSheetRef:   answerSheetRef,
        medicalScaleRef:  medicalScaleRef,
        origin:           origin,
        submittedAt:      submittedAt,
    }
}
```

**ç”¨é€”**ï¼š

- qs-worker æ¶ˆè´¹æ­¤äº‹ä»¶ï¼Œè§¦å‘è¯„ä¼°æµç¨‹
- é€šçŸ¥æœåŠ¡æ¶ˆè´¹æ­¤äº‹ä»¶ï¼Œå‘é€"ç­”å·å·²æäº¤"é€šçŸ¥
- ç»Ÿè®¡æœåŠ¡æ¶ˆè´¹æ­¤äº‹ä»¶ï¼Œæ›´æ–°å®æ—¶ç»Ÿè®¡æ•°æ®

#### 5.2.2 EvaluationCompletedEvent - è¯„ä¼°å·²å®Œæˆ

**è§¦å‘æ—¶æœº**ï¼šAssessment.ApplyEvaluation() è¢«è°ƒç”¨æ—¶

```go
type EvaluationCompletedEvent struct {
    baseEvent
    assessmentID  ID
    totalScore    float64
    riskLevel     RiskLevel
    completedAt   time.Time
}
```

**ç”¨é€”**ï¼š

- é€šçŸ¥æœåŠ¡æ¶ˆè´¹æ­¤äº‹ä»¶ï¼Œå‘é€"è¯„ä¼°å®Œæˆ"é€šçŸ¥
- ç»Ÿè®¡æœåŠ¡æ¶ˆè´¹æ­¤äº‹ä»¶ï¼Œæ›´æ–°ç»Ÿè®¡å›¾è¡¨
- è§¦å‘åç»­ä¸šåŠ¡æµç¨‹ï¼ˆå¦‚é«˜é£é™©é¢„è­¦ï¼‰

#### 5.2.3 EvaluationFailedEvent - è¯„ä¼°å¤±è´¥

**è§¦å‘æ—¶æœº**ï¼šAssessment.MarkAsFailed() è¢«è°ƒç”¨æ—¶

```go
type EvaluationFailedEvent struct {
    baseEvent
    assessmentID ID
    reason       string
    failedAt     time.Time
}
```

**ç”¨é€”**ï¼š

- å‘Šè­¦æœåŠ¡æ¶ˆè´¹æ­¤äº‹ä»¶ï¼Œå‘é€å‘Šè­¦é€šçŸ¥
- æ—¥å¿—æœåŠ¡è®°å½•å¤±è´¥åŸå› 
- é‡è¯•æœºåˆ¶åˆ¤æ–­æ˜¯å¦å¯ä»¥é‡è¯•

### 5.3 äº‹ä»¶æµè½¬å›¾

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  äº‹ä»¶æµè½¬å…¨æ™¯                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ç”¨æˆ·æ“ä½œ            Assessment          EventBus         è®¢é˜…è€…
     â”‚                    â”‚                  â”‚                â”‚
     â”‚ 1. æäº¤ç­”å·        â”‚                  â”‚                â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                  â”‚                â”‚
     â”‚                    â”‚                  â”‚                â”‚
     â”‚                    â”‚ 2. Submit()      â”‚                â”‚
     â”‚                    â”‚ - çŠ¶æ€è¿ç§»       â”‚                â”‚
     â”‚                    â”‚ - å‘å¸ƒäº‹ä»¶       â”‚                â”‚
     â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                â”‚
     â”‚                    â”‚ AssessmentCreatedâ”‚                â”‚
     â”‚                    â”‚                  â”‚                â”‚
     â”‚ 3. ç«‹å³è¿”å›        â”‚                  â”‚ 4. å¼‚æ­¥æ¶ˆè´¹    â”‚
     â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
     â”‚                    â”‚                  â”‚                qs-worker
     â”‚                    â”‚                  â”‚                â”‚
     â”‚                    â”‚                  â”‚ 5. Evaluate()  â”‚
     â”‚                    â”‚                  â”‚                â”‚
     â”‚                    â”‚ 6. ApplyEvaluation()              â”‚
     â”‚                    â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                    â”‚                  â”‚                â”‚
     â”‚                    â”‚ 7. å‘å¸ƒäº‹ä»¶      â”‚                â”‚
     â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                â”‚
     â”‚                    â”‚ EvaluationCompleted               â”‚
     â”‚                    â”‚                  â”‚                â”‚
     â”‚                    â”‚                  â”‚ 8. å¼‚æ­¥æ¶ˆè´¹    â”‚
     â”‚                    â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
     â”‚                    â”‚                  â”‚           é€šçŸ¥æœåŠ¡
     â”‚                    â”‚                  â”‚           ç»Ÿè®¡æœåŠ¡
     â”‚                    â”‚                  â”‚                â”‚
```

---

## å…­ã€æ•°æ®æŒä¹…åŒ–è®¾è®¡

### 6.1 MySQL è¡¨ç»“æ„

#### assessments è¡¨

```sql
CREATE TABLE assessments (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    org_id BIGINT UNSIGNED NOT NULL COMMENT 'æœºæ„ID',
    
    -- å…³è”å¼•ç”¨
    testee_id BIGINT UNSIGNED NOT NULL COMMENT 'å—è¯•è€…ID',
    questionnaire_code VARCHAR(50) NOT NULL COMMENT 'é—®å·ç¼–ç ',
    questionnaire_version VARCHAR(20) NOT NULL COMMENT 'é—®å·ç‰ˆæœ¬',
    answer_sheet_id VARCHAR(50) NOT NULL COMMENT 'ç­”å·ID',
    medical_scale_code VARCHAR(50) COMMENT 'é‡è¡¨ç¼–ç ï¼ˆå¯é€‰ï¼‰',
    
    -- ä¸šåŠ¡æ¥æº
    origin_type VARCHAR(20) NOT NULL COMMENT 'æ¥æºç±»å‹ï¼šadhoc/plan/screening',
    origin_ref_id VARCHAR(50) COMMENT 'æ¥æºå…³è”ID',
    
    -- çŠ¶æ€ä¸ç»“æœ
    status VARCHAR(20) NOT NULL COMMENT 'çŠ¶æ€ï¼špending/submitted/interpreted/failed',
    total_score DECIMAL(10,2) COMMENT 'æ€»åˆ†',
    risk_level VARCHAR(20) COMMENT 'é£é™©ç­‰çº§ï¼šlow/moderate/high',
    
    -- æ—¶é—´æˆ³
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    submitted_at TIMESTAMP NULL COMMENT 'æäº¤æ—¶é—´',
    interpreted_at TIMESTAMP NULL COMMENT 'è§£è¯»å®Œæˆæ—¶é—´',
    failed_at TIMESTAMP NULL COMMENT 'å¤±è´¥æ—¶é—´',
    
    -- å¤±è´¥ä¿¡æ¯
    failure_reason TEXT COMMENT 'å¤±è´¥åŸå› ',
    
    -- ç´¢å¼•
    INDEX idx_testee_status (testee_id, status),
    INDEX idx_origin (origin_type, origin_ref_id),
    INDEX idx_status (status),
    INDEX idx_created_at (created_at),
    INDEX idx_scale (medical_scale_code)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æµ‹è¯„è¡¨';
```

#### assessment_scores è¡¨

```sql
CREATE TABLE assessment_scores (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    assessment_id BIGINT UNSIGNED NOT NULL COMMENT 'æµ‹è¯„ID',
    
    -- å› å­ä¿¡æ¯ï¼ˆNULL è¡¨ç¤ºæ€»åˆ†ï¼‰
    factor_code VARCHAR(50) COMMENT 'å› å­ç¼–ç ',
    factor_name VARCHAR(100) COMMENT 'å› å­åç§°',
    
    -- å¾—åˆ†
    score DECIMAL(10,2) NOT NULL COMMENT 'å¾—åˆ†å€¼',
    percentage DECIMAL(5,2) COMMENT 'ç™¾åˆ†æ¯”',
    
    -- è§£è¯»
    level VARCHAR(50) COMMENT 'é£é™©ç­‰çº§',
    interpretation TEXT COMMENT 'è§£è¯»æ–‡æœ¬',
    
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    -- ç´¢å¼•
    FOREIGN KEY (assessment_id) REFERENCES assessments(id) ON DELETE CASCADE,
    INDEX idx_assessment (assessment_id),
    INDEX idx_factor (factor_code),
    UNIQUE KEY uk_assessment_factor (assessment_id, factor_code)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æµ‹è¯„å¾—åˆ†è¡¨';
```

### 6.2 ä»“å‚¨æ¥å£

```go
// ä»£ç ä½ç½®ï¼šinternal/apiserver/domain/evaluation/assessment/repository.go

// Repository Assessment ä»“å‚¨æ¥å£
type Repository interface {
    // Save ä¿å­˜æµ‹è¯„ï¼ˆåˆ›å»ºæˆ–æ›´æ–°ï¼‰
    Save(ctx context.Context, assessment *Assessment) error
    
    // FindByID æ ¹æ®IDæŸ¥è¯¢
    FindByID(ctx context.Context, id ID) (*Assessment, error)
    
    // FindByTestee æŸ¥è¯¢å—è¯•è€…çš„æµ‹è¯„åˆ—è¡¨
    FindByTestee(ctx context.Context, testeeID testee.ID, opts ...QueryOption) ([]*Assessment, error)
    
    // FindByOrigin æ ¹æ®æ¥æºæŸ¥è¯¢
    FindByOrigin(ctx context.Context, origin Origin) ([]*Assessment, error)
    
    // CountByStatus æŒ‰çŠ¶æ€ç»Ÿè®¡æ•°é‡
    CountByStatus(ctx context.Context, status Status) (int64, error)
}

// ScoreRepository Score ä»“å‚¨æ¥å£
type ScoreRepository interface {
    // SaveBatch æ‰¹é‡ä¿å­˜å¾—åˆ†
    SaveBatch(ctx context.Context, scores []*Score) error
    
    // FindByAssessment æŸ¥è¯¢æµ‹è¯„çš„æ‰€æœ‰å¾—åˆ†
    FindByAssessment(ctx context.Context, assessmentID ID) ([]*Score, error)
    
    // FindTotalScore æŸ¥è¯¢æ€»åˆ†
    FindTotalScore(ctx context.Context, assessmentID ID) (*Score, error)
}
```

---

## ä¸ƒã€ä½¿ç”¨ç¤ºä¾‹

### 7.1 åˆ›å»ºå¹¶æäº¤æµ‹è¯„

```go
// 1. åˆ›å»º AssessmentCreator
creator := assessment.NewDefaultAssessmentCreator(
    testeeValidator,
    questionnaireValidator,
    answerSheetValidator,
    scaleValidator,
)

// 2. æ„å»ºåˆ›å»ºè¯·æ±‚
req := assessment.NewCreateAssessmentRequest(
    orgID,
    testeeID,
    questionnaireRef,
    answerSheetRef,
    assessment.NewAdhocOrigin(),
).WithMedicalScale(medicalScaleRef)

// 3. åˆ›å»ºæµ‹è¯„ï¼ˆè‡ªåŠ¨æäº¤ï¼‰
assess, err := creator.Create(ctx, req)
if err != nil {
    return err
}

// 4. æŒä¹…åŒ–
if err := assessmentRepo.Save(ctx, assess); err != nil {
    return err
}

// 5. å‘å¸ƒé¢†åŸŸäº‹ä»¶
events := assess.GetEvents()
for _, event := range events {
    eventBus.Publish(ctx, event)
}

// assess.Status() == StatusSubmitted
// assess.SubmittedAt() != nil
```

### 7.2 åº”ç”¨è¯„ä¼°ç»“æœ

```go
// 1. åŠ è½½ Assessment
assess, err := assessmentRepo.FindByID(ctx, assessmentID)
if err != nil {
    return err
}

// 2. æ£€æŸ¥çŠ¶æ€
if !assess.Status().IsSubmitted() {
    return errors.New("æµ‹è¯„çŠ¶æ€ä¸æ­£ç¡®")
}

// 3. æ„å»ºè¯„ä¼°ç»“æœ
result := &assessment.EvaluationResult{
    TotalScore: 68.5,
    RiskLevel:  assessment.RiskLevelModerate,
    FactorScores: []assessment.FactorScore{
        {FactorCode: "F1", Score: 32.0},
        {FactorCode: "F2", Score: 28.5},
        {FactorCode: "F3", Score: 8.0},
    },
}

// 4. åº”ç”¨è¯„ä¼°ç»“æœ
if err := assess.ApplyEvaluation(result); err != nil {
    return err
}

// 5. ä¿å­˜å¾—åˆ†
scores := buildScoresFromResult(assess.ID(), result)
if err := scoreRepo.SaveBatch(ctx, scores); err != nil {
    return err
}

// 6. æ›´æ–° Assessment
if err := assessmentRepo.Save(ctx, assess); err != nil {
    return err
}

// 7. å‘å¸ƒäº‹ä»¶
events := assess.GetEvents()
for _, event := range events {
    eventBus.Publish(ctx, event)
}

// assess.Status() == StatusInterpreted
// assess.TotalScore() == 68.5
```

### 7.3 å¤„ç†è¯„ä¼°å¤±è´¥

```go
// 1. åŠ è½½ Assessment
assess, err := assessmentRepo.FindByID(ctx, assessmentID)
if err != nil {
    return err
}

// 2. æ ‡è®°å¤±è´¥
assess.MarkAsFailed("è®¡ç®—ç­–ç•¥æ‰§è¡Œå¤±è´¥: division by zero")

// 3. æŒä¹…åŒ–
if err := assessmentRepo.Save(ctx, assess); err != nil {
    return err
}

// 4. å‘å¸ƒäº‹ä»¶
events := assess.GetEvents()
for _, event := range events {
    eventBus.Publish(ctx, event)
}

// assess.Status() == StatusFailed
// assess.FailureReason() == "è®¡ç®—ç­–ç•¥æ‰§è¡Œå¤±è´¥: division by zero"
```

---

## å…«ã€è®¾è®¡æ¨¡å¼æ€»ç»“

### 8.1 èšåˆæ¨¡å¼

**åº”ç”¨**ï¼šAssessment ç®¡ç† Score å®ä½“

**ä¼˜åŠ¿**ï¼š

- âœ… ä¸€è‡´æ€§è¾¹ç•Œï¼šAssessment + Scores åœ¨åŒä¸€äº‹åŠ¡
- âœ… ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼šScore éš Assessment åˆ›å»ºå’Œé”€æ¯
- âœ… è®¿é—®æ§åˆ¶ï¼šå¤–éƒ¨åªèƒ½é€šè¿‡ Assessment è®¿é—® Score

### 8.2 çŠ¶æ€æœºæ¨¡å¼

**åº”ç”¨**ï¼šAssessment çš„çŠ¶æ€ç®¡ç†

**ä¼˜åŠ¿**ï¼š

- âœ… çŠ¶æ€çº¦æŸï¼šä»£ç å±‚é¢ä¿è¯çŠ¶æ€è¿ç§»åˆæ³•æ€§
- âœ… é¢†åŸŸè¯­ä¹‰ï¼šçŠ¶æ€è¿ç§»æ–¹æ³•åæ˜ ä¸šåŠ¡æœ¯è¯­
- âœ… å¯è¿½æº¯ï¼šæ—¶é—´æˆ³è®°å½•æ¯æ¬¡çŠ¶æ€å˜æ›´

### 8.3 å»ºé€ è€…æ¨¡å¼

**åº”ç”¨**ï¼šAssessmentCreator

**ä¼˜åŠ¿**ï¼š

- âœ… å°è£…å¤æ‚æ€§ï¼šéªŒè¯é€»è¾‘é›†ä¸­åœ¨ Creator
- âœ… æ­¥éª¤å¯æ§ï¼šåˆ†æ­¥éªŒè¯ï¼Œä»»ä¸€æ­¥éª¤å¤±è´¥å³åœæ­¢
- âœ… æ˜“äºæµ‹è¯•ï¼šä¾¿äº Mock å„ä¸ªéªŒè¯å™¨

### 8.4 äº‹ä»¶é©±åŠ¨æ¨¡å¼

**åº”ç”¨**ï¼šé¢†åŸŸäº‹ä»¶å‘å¸ƒ

**ä¼˜åŠ¿**ï¼š

- âœ… å¼‚æ­¥è§£è€¦ï¼šè¯„ä¼°æµç¨‹ä¸é˜»å¡ä¸»æµç¨‹
- âœ… å¯æ‰©å±•ï¼šæ–°å¢è®¢é˜…è€…ä¸å½±å“æ ¸å¿ƒé€»è¾‘
- âœ… å¯è¿½æº¯ï¼šäº‹ä»¶è®°å½•å®Œæ•´çš„æ“ä½œå†å²

---

## ä¹ã€å…³é”®è®¾è®¡å†³ç­–

### 9.1 ä¸ºä»€ä¹ˆä½¿ç”¨å¼•ç”¨å¯¹è±¡è€Œéç›´æ¥æŒæœ‰èšåˆæ ¹ï¼Ÿ

**åŸå› **ï¼š

1. **è§£è€¦**ï¼šä¸ä¾èµ–å…¶ä»–å­åŸŸçš„èšåˆæ ¹ç»“æ„
2. **è½»é‡**ï¼šåªå­˜å‚¨å¿…è¦çš„å¼•ç”¨ä¿¡æ¯ï¼Œå‡å°‘å†…å­˜å ç”¨
3. **ç‹¬ç«‹**ï¼šå¯ä»¥ç‹¬ç«‹éªŒè¯å¼•ç”¨çš„æœ‰æ•ˆæ€§
4. **æ¸…æ™°**ï¼šæ˜ç¡®è·¨èšåˆè¾¹ç•Œï¼Œé¿å…äº‹åŠ¡è†¨èƒ€

### 9.2 ä¸ºä»€ä¹ˆ Score æ˜¯å®ä½“è€Œéå€¼å¯¹è±¡ï¼Ÿ

**åŸå› **ï¼š

1. **æœ‰èº«ä»½**ï¼šæ¯ä¸ª Score æœ‰ç‹¬ç«‹çš„ ID
2. **å¯å˜**ï¼šå¾—åˆ†çš„è§£è¯»ä¿¡æ¯å¯èƒ½åç»­æ›´æ–°
3. **ç”Ÿå‘½å‘¨æœŸ**ï¼šScore çš„åˆ›å»ºå’Œåˆ é™¤ç”± Assessment ç®¡ç†

### 9.3 ä¸ºä»€ä¹ˆçŠ¶æ€æœºåªèƒ½å•å‘æµè½¬ï¼Ÿ

**åŸå› **ï¼š

1. **ä¸šåŠ¡ä¸å˜æ€§**ï¼šæµ‹è¯„ä¸€æ—¦å®Œæˆï¼Œä¸åº”è¯¥å›é€€
2. **æ•°æ®ä¸€è‡´æ€§**ï¼šé¿å…çŠ¶æ€å›é€€å¯¼è‡´çš„æ•°æ®ä¸ä¸€è‡´
3. **å®¡è®¡è¿½æº¯**ï¼šå•å‘æµè½¬æ›´æ˜“äºè¿½æº¯æ“ä½œå†å²

---

## åã€åç»­æ–‡æ¡£é¢„å‘Š

| æ–‡æ¡£ç¼–å· | æ ‡é¢˜ | æ ¸å¿ƒå†…å®¹ |
|---------|------|---------|
| **11-06-03** | Calculation è®¡ç®—ç­–ç•¥è®¾è®¡ | 8ç§è®¡ç®—ç­–ç•¥ã€æ³¨å†Œå™¨ã€æ‰©å±•ç¤ºä¾‹ |
| **11-06-04** | Interpretation è§£è¯»ç­–ç•¥è®¾è®¡ | é˜ˆå€¼ç­–ç•¥ã€å¤åˆç­–ç•¥ã€é«˜å±è¯†åˆ« |
| **11-06-05** | Report èšåˆè®¾è®¡ | æŠ¥å‘Šç»“æ„ã€Builderã€Exporter |
| **11-06-06** | åº”ç”¨æœåŠ¡å±‚è®¾è®¡ | EvaluationServiceã€QueryService |

---

## åä¸€ã€ç›¸å…³ä»£ç é“¾æ¥

- **èšåˆæ ¹**ï¼š[`assessment/assessment.go`](../../../internal/apiserver/domain/evaluation/assessment/assessment.go)
- **Score å®ä½“**ï¼š[`assessment/score.go`](../../../internal/apiserver/domain/evaluation/assessment/score.go)
- **å€¼å¯¹è±¡**ï¼š[`assessment/types.go`](../../../internal/apiserver/domain/evaluation/assessment/types.go)
- **é¢†åŸŸäº‹ä»¶**ï¼š[`assessment/events.go`](../../../internal/apiserver/domain/evaluation/assessment/events.go)
- **åˆ›å»ºå™¨**ï¼š[`assessment/creator.go`](../../../internal/apiserver/domain/evaluation/assessment/creator.go)
- **ä»“å‚¨æ¥å£**ï¼š[`assessment/repository.go`](../../../internal/apiserver/domain/evaluation/assessment/repository.go)

---

> **ä½œè€…**ï¼šEvaluation å­åŸŸè®¾è®¡å›¢é˜Ÿ  
> **å®¡é˜…**ï¼šé¢†åŸŸæ¶æ„å¸ˆ  
> **ç‰ˆæœ¬å†å²**ï¼š
>
> - V2.0 (2025-11-29)ï¼šé‡‡ç”¨æ–°çš„å†™ä½œé£æ ¼ï¼Œå¢åŠ 30ç§’é€Ÿè§ˆå’Œé—®é¢˜åŸŸé©±åŠ¨
> - V1.0 (2025-01-29)ï¼šåˆå§‹ç‰ˆæœ¬
