# 11-01 é—®å·&é‡è¡¨ BC é¢†åŸŸæ¨¡å‹æ€»è§ˆï¼ˆV2ï¼‰

> **ç‰ˆæœ¬ï¼š** V2.0  
> **æ¨¡å—ï¼š** é—®å·&é‡è¡¨ BCï¼ˆQuestionnaire & Scale Bounded Contextï¼‰  
> **é€‚ç”¨èŒƒå›´ï¼š** qs-apiserverã€qs-worker åŠæ‰€æœ‰é—®å·/é‡è¡¨æµ‹è¯„ç›¸å…³æœåŠ¡  
> **æœ€åæ›´æ–°ï¼š** 2025-01-19  
> **æ–‡æ¡£çŠ¶æ€ï¼š** âœ… å·²å®šç¨¿

---

## æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£åŸºäº **é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰** ç†å¿µï¼Œç³»ç»Ÿé˜è¿°é—®å·&é‡è¡¨é™ç•Œä¸Šä¸‹æ–‡ï¼ˆBounded Contextï¼‰åœ¨ V2 æ¶æ„ä¸­çš„é¢†åŸŸæ¨¡å‹è®¾è®¡ã€‚ä½œä¸ºé¢†åŸŸå±‚è®¾è®¡çš„æƒå¨å‚è€ƒï¼Œæœ¬æ–‡æ¡£ï¼š

- âœ… æ˜ç¡®å®šä¹‰ BC å†…çš„å­åŸŸåˆ’åˆ†ä¸èŒè´£è¾¹ç•Œ
- âœ… è¯¦ç»†æè¿°å„èšåˆæ ¹çš„æ ¸å¿ƒèŒè´£ä¸å…³é”®å±æ€§
- âœ… è§„èŒƒå­åŸŸé—´çš„ä¾èµ–å…³ç³»ä¸æ•°æ®æµå‘
- âœ… è¯´æ˜é—®å·æ¨¡å¼ä¸é‡è¡¨æ¨¡å¼çš„å·®å¼‚ä¸é€‚ç”¨åœºæ™¯
- âœ… æ˜ç¡® Assessment ä½œä¸ºæ¡¥æ¥èšåˆçš„ä¸­å¿ƒåœ°ä½
- âœ… é˜æ˜å†…å®¹å­˜å‚¨å±‚ï¼ˆMongoï¼‰ä¸ä¸šåŠ¡ç¼–æ’å±‚ï¼ˆMySQLï¼‰çš„èŒè´£åˆ†ç¦»

### ğŸ”¥ V2 æ ¸å¿ƒæ”¹è¿›

ç›¸æ¯” V1 è®¾è®¡ï¼ŒV2 ç‰ˆæœ¬åœ¨ä»¥ä¸‹æ–¹é¢åšäº†é‡å¤§ä¼˜åŒ–ï¼š

1. **å†…å®¹ä¸ä¸šåŠ¡åˆ†ç¦»**ï¼šAnswerSheetï¼ˆå†…å®¹ï¼‰ä¸ Assessmentï¼ˆä¸šåŠ¡ï¼‰å½»åº•è§£è€¦ï¼Œæ‰€æœ‰ä¸šåŠ¡æ¥æºå­—æ®µï¼ˆOriginType/PlanID/ScreeningIDï¼‰åªå­˜åœ¨äº Assessment
2. **Assessment ä¸­å¿ƒåŒ–**ï¼šæ˜ç¡® Assessment ä½œä¸ºç»Ÿè®¡åˆ†æé”šç‚¹ï¼Œæ‰€æœ‰æŠ¥è¡¨/å›¾è¡¨/è¶‹åŠ¿åˆ†æåŸºäº MySQL çš„ Assessment è¡¨
3. **FillerRef æ›¿ä»£ Writer**ï¼šåºŸå¼ƒ Writer/Viewer æ¦‚å¿µï¼Œä½¿ç”¨ FillerRef å€¼å¯¹è±¡è®°å½•å¡«å†™äººä¿¡æ¯
4. **å¹‚ç­‰åˆ›å»ºç­–ç•¥**ï¼šEnsureTestee æ”¯æŒå¤šä¸Šæ¸¸ BC å®‰å…¨è°ƒç”¨ï¼Œé¿å…é‡å¤åˆ›å»º
5. **äº‹ä»¶é©±åŠ¨ä¼˜åŒ–**ï¼šAssessmentSubmittedEvent/AssessmentInterpretedEvent é©±åŠ¨è¯„ä¼°å·¥ä½œæµï¼Œå®ç°å®Œå…¨å¼‚æ­¥è§£è€¦

### ğŸ¯ é˜…è¯»æŒ‡å¼•

**å»ºæ¨¡ä¾æ®ï¼š**

- äº‹ä»¶é£æš´å·¥ä½œåŠè¾“å‡º
- ã€Šã€Œé‡è¡¨æµ‹è¯„ã€é¢†åŸŸå»ºæ¨¡.pdfã€‹- å»ºæ¨¡è¿‡ç¨‹ä¸æ€è€ƒè®°å½•
- ã€Šã€Œé‡è¡¨æµ‹è¯„ã€éœ€æ±‚åˆ†æ.pdfã€‹- ä¸šåŠ¡éœ€æ±‚ä¸ç”¨ä¾‹åˆ†æ

**æ–‡æ¡£å®šä½ï¼š**

- âœ… é¢†åŸŸæ¨¡å‹çš„æƒå¨å®šç¨¿ç‰ˆæœ¬
- âœ… ä»£ç å®ç°çš„è®¾è®¡è“å›¾
- âŒ ä¸åŒ…å«å»ºæ¨¡è¿‡ç¨‹æ¨æ¼”
- âŒ ä¸æ¶‰åŠæŠ€æœ¯å®ç°ç»†èŠ‚

**é…å¥—æ–‡æ¡£ï¼š**

| æ–‡æ¡£ç¼–å· | æ–‡æ¡£åç§° | å…³ç³»è¯´æ˜ |
|---------|---------|---------|
| 11-02 | qs-apiserver é¢†åŸŸå±‚ä»£ç ç»“æ„è®¾è®¡ | æœ¬æ¨¡å‹çš„ä»£ç æ˜ å°„ |
| 11-03 | Testeeå’ŒStaffç”¨æˆ·æ¨¡å‹è®¾è®¡ | user å­åŸŸçš„è¯¦ç»†è®¾è®¡ |
| 12-01 | æ ¡éªŒè§„åˆ™è®¾è®¡ï¼ˆç­–ç•¥æ¨¡å¼ï¼‰ | survey å­åŸŸçš„æ ¡éªŒç­–ç•¥ |
| 12-02 | è®¡åˆ†ä¸è§£è¯»è§„åˆ™è®¾è®¡ï¼ˆç­–ç•¥+èŒè´£é“¾ï¼‰ | scale å­åŸŸçš„è¯„ä¼°ç­–ç•¥ |
| 12-03 | è¯„ä¼°å·¥ä½œæµä¸qs-workerè®¾è®¡ | assessment å­åŸŸçš„å·¥ä½œæµ |
| 12-04 | é«˜å¹¶å‘åœºæ™¯ä¸æŸ¥è¯¢ç­–ç•¥è®¾è®¡ | æ€§èƒ½ä¼˜åŒ–ä¸æŸ¥è¯¢ç­–ç•¥ |
| 12-05 | æµ‹è¯„è®¡åˆ’ä¸å…¥æ ¡ç­›æŸ¥å»ºæ¨¡ | plan/screening å­åŸŸè¯¦ç»†è®¾è®¡ |

### ğŸ’¡ æ ¸å¿ƒè®¾è®¡åŸåˆ™

| åŸåˆ™ | è¯´æ˜ | ä½“ç° |
|-----|------|-----|
| **èŒè´£åˆ†ç¦»** | é—®å·ï¼ˆsurveyï¼‰ä¸“æ³¨"æ•°æ®æ”¶é›†"ï¼Œé‡è¡¨ï¼ˆscaleï¼‰ä¸“æ³¨"ä¸“ä¸šè§£è¯»" | survey ä¸åšè¯„åˆ†è§£é‡Šï¼Œscale ä¸ç®¡é—®å·å±•ç¤º |
| **èšåˆè‡ªæ²»** | æ¯ä¸ªèšåˆç‹¬ç«‹å°è£…ä¸šåŠ¡ä¸å˜æ€§ï¼Œé€šè¿‡é¢†åŸŸäº‹ä»¶æ¾è€¦åˆåä½œ | Assessment çŠ¶æ€å˜æ›´å‘å¸ƒé¢†åŸŸäº‹ä»¶ |
| **ä¾èµ–å•å‘** | ä¸¥æ ¼æ§åˆ¶å­åŸŸä¾èµ–æ–¹å‘ï¼Œç¡®ä¿é¢†åŸŸå±‚æ— å¾ªç¯ä¾èµ– | survey â†’ scale â†’ assessment |
| **æ¨¡å¼çµæ´»** | åŒä¸€å¥—æ¨¡å‹æ”¯æŒçº¯é—®å·æ”¶é›†ä¸ä¸“ä¸šé‡è¡¨æµ‹è¯„ä¸¤ç§åœºæ™¯ | é€šè¿‡ MedicalScaleID æ˜¯å¦ç»‘å®šåŒºåˆ† |

---

## 1. é™ç•Œä¸Šä¸‹æ–‡ä¸å­åŸŸåˆ’åˆ†

### 1.1 BC å®šä½ä¸èŒƒå›´

**é—®å·&é‡è¡¨ BC** æ˜¯è´Ÿè´£ **"é—®å·æ•°æ®æ”¶é›†"** å’Œ **"ä¸“ä¸šé‡è¡¨æµ‹è¯„"** çš„æ ¸å¿ƒä¸šåŠ¡é™ç•Œä¸Šä¸‹æ–‡ã€‚è®¾è®¡ç›®æ ‡ï¼š

1. **é€šç”¨é—®å·èƒ½åŠ›**ï¼šæ”¯æŒä»»æ„ç±»å‹çš„é—®å·è°ƒæŸ¥ï¼ˆå®¢æˆ·æ»¡æ„åº¦ã€ç”¨æˆ·åé¦ˆã€å¸‚åœºè°ƒç ”ç­‰ï¼‰
2. **ä¸“ä¸šé‡è¡¨èƒ½åŠ›**ï¼šæ”¯æŒç¬¦åˆåŒ»å­¦/å¿ƒç†å­¦æ ‡å‡†çš„é‡è¡¨æµ‹è¯„ï¼ˆSDSã€SASã€Conners ç­‰ï¼‰
3. **çµæ´»æ¨¡å¼åˆ‡æ¢**ï¼šåŒä¸€å¥—é¢†åŸŸæ¨¡å‹æ”¯æŒ"çº¯é—®å·"å’Œ"é‡è¡¨æµ‹è¯„"ä¸¤ç§æ¨¡å¼
4. **å¯è¿½æº¯æ€§**ï¼šå®Œæ•´è®°å½•æµ‹è¯„ç”Ÿå‘½å‘¨æœŸï¼Œæ”¯æŒè¶‹åŠ¿åˆ†æä¸ç»Ÿè®¡æŠ¥è¡¨

**BC è¾¹ç•Œï¼š**

- âœ… åœ¨è¾¹ç•Œå†…ï¼šé—®å·ç»“æ„å®šä¹‰ã€ç­”å·æ”¶é›†ä¸æ ¡éªŒã€é‡è¡¨è§„åˆ™é…ç½®ã€è¯„åˆ†ç®—æ³•å°è£…ã€æµ‹è¯„æ¡ˆä¾‹ç®¡ç†ã€è®¡åˆ’/ç­›æŸ¥é¡¹ç›®é…ç½®
- âŒ åœ¨è¾¹ç•Œå¤–ï¼šç”¨æˆ·èº«ä»½è®¤è¯ï¼ˆIAM BCï¼‰ã€æ”¯ä»˜ï¼ˆPayment BCï¼‰ã€é€šçŸ¥æ¨é€ï¼ˆNotification BCï¼‰ã€ç»„ç»‡æ¶æ„ï¼ˆIAM BCï¼‰

**ä¸Šæ¸¸ BC ä¸é›†æˆå…³ç³»ï¼š**

æœ¬ BC ä¸ºå¤šä¸ªä¸Šæ¸¸ä¸šåŠ¡ BC æä¾›æµ‹è¯„èƒ½åŠ›ï¼Œå…¸å‹ä¸Šæ¸¸åŒ…æ‹¬ï¼š

| ä¸Šæ¸¸ BC | å…¸å‹åœºæ™¯ | é›†æˆæ–¹å¼ | æ•°æ®æµå‘ |
|---------|---------|---------|----------|
| **äº’è”ç½‘åŒ»é™¢ BC** | æ‚£è€…å‡ºé™¢åéšè®¿æµ‹è¯„ | gRPC è°ƒç”¨åˆ›å»º AssessmentPlan | äº’è”ç½‘åŒ»é™¢ â†’ é—®å·&é‡è¡¨ BC |
| **è¡Œä¸ºè®­ç»ƒä¸­å¿ƒ BC** | å­¦å‘˜å…¥æ ¡åå‘¨æœŸè¯„ä¼° | gRPC è°ƒç”¨åˆ›å»º AssessmentPlan | è®­ç»ƒä¸­å¿ƒ â†’ é—®å·&é‡è¡¨ BC |
| **å¥åº·ç®¡ç† BC** | æ…¢ç—…æ‚£è€…å®šæœŸæµ‹è¯„ | gRPC è°ƒç”¨åˆ›å»º AssessmentPlan | å¥åº·ç®¡ç† â†’ é—®å·&é‡è¡¨ BC |
| **å­¦æ ¡ç®¡ç† BC** | æ–°ç”Ÿå…¥å­¦å¿ƒç†ç­›æŸ¥ | gRPC è°ƒç”¨åˆ›å»º ScreeningProject | å­¦æ ¡ç®¡ç† â†’ é—®å·&é‡è¡¨ BC |

**ä¸‹æ¸¸è®¢é˜…è€…ï¼š**

| è®¢é˜…æ–¹ | è®¢é˜…äº‹ä»¶ | ç”¨é€” |
|-------|---------|------|
| é€šçŸ¥æ¨¡å— | AssessmentInterpretedEvent | æ¨é€æµ‹è¯„å®Œæˆé€šçŸ¥ç»™ç”¨æˆ· |
| ä¸Šæ¸¸ BC | AssessmentInterpretedEvent | å›å†™æµ‹è¯„ç»“æœåˆ°ä¸šåŠ¡ç³»ç»Ÿ |
| æ•°æ®åˆ†ææœåŠ¡ | æ‰€æœ‰ Assessment äº‹ä»¶ | å®æ—¶ç»Ÿè®¡ä¸ BI æŠ¥è¡¨ |

### 1.2 å­åŸŸåˆ’åˆ†æ€»è§ˆ

é—®å·&é‡è¡¨ BC æŒ‰ **èŒè´£å†…èšã€ä¾èµ–å•å‘** åŸåˆ™ï¼Œæ‹†åˆ†ä¸º 6 ä¸ªå­åŸŸï¼š

| å­åŸŸç¼–å· | ä¸­æ–‡å | è‹±æ–‡å | æ ¸å¿ƒå…³æ³¨ç‚¹ | æ ¸å¿ƒèšåˆ | ä¾èµ–å…³ç³» |
|---------|-------|--------|-----------|---------|---------|
| 1 | é—®å·å­åŸŸ | survey | æ•°æ®æ”¶é›†ä¸è¾“å…¥æ ¡éªŒ | Questionnaire, AnswerSheet | æ— ä¾èµ– |
| 2 | é‡è¡¨å­åŸŸ | scale | ä¸“ä¸šè§£è¯»ä¸è¯„åˆ†è§„åˆ™ | MedicalScale | ä¾èµ– survey |
| 3 | æµ‹è¯„æ¡ˆä¾‹å­åŸŸ | assessment | æµ‹è¯„ç”Ÿå‘½å‘¨æœŸç®¡ç† | Assessment, AssessmentScore, InterpretReport | ä¾èµ– surveyã€scaleã€user |
| 4 | ç”¨æˆ·å­åŸŸ | user | BCå†…ç”¨æˆ·é¢†åŸŸè§†å›¾ | Testee, Staff | æ— ä¾èµ– |
| 5 | æµ‹è¯„è®¡åˆ’å­åŸŸ | plan | å‘¨æœŸæ€§æµ‹è¯„ç®¡ç† | AssessmentPlan, AssessmentTask | æ— ä¾èµ– |
| 6 | å…¥æ ¡ç­›æŸ¥å­åŸŸ | screening | æ‰¹é‡ç­›æŸ¥é¡¹ç›®ç®¡ç† | ScreeningProject | æ— ä¾èµ– |

### 1.3 å„å­åŸŸè¯¦ç»†è¯´æ˜

#### ğŸ“‹ 1.3.1 survey å­åŸŸï¼ˆé—®å·æ”¶é›†ï¼‰

**æ ¸å¿ƒå®šä½ï¼š** é€šç”¨é—®å·æ”¶é›†èƒ½åŠ›å±‚ï¼Œä¸“æ³¨æ•°æ®é‡‡é›†è€Œéä¸“ä¸šè§£è¯»

**èŒè´£æ¸…å•ï¼š**

- âœ… **é—®å·ç»“æ„å®šä¹‰**ï¼šé¢˜ç›®ã€é€‰é¡¹ã€é¡µé¢å¸ƒå±€ã€é€»è¾‘è·³è½¬
- âœ… **ç­”å·æ•°æ®æ”¶é›†**ï¼šç»“æ„åŒ–å­˜å‚¨ç”¨æˆ·å¡«å†™å†…å®¹
- âœ… **è¾“å…¥å±‚æ ¡éªŒ**ï¼šå¿…å¡«ã€æ ¼å¼ã€èŒƒå›´ã€é¢˜é—´ä¾èµ–
- âœ… **è®¡åˆ†å…ƒæ•°æ®é…ç½®**ï¼šä¸º scale å­åŸŸæä¾›åŸå§‹åˆ†è®¡ç®—åŸºç¡€ï¼ˆScoringConfigï¼‰
- âŒ **ä¸åšä¸“ä¸šåˆ†æ•°è§£è¯»**ï¼šä¸æ¶‰åŠåˆ†æ•°çš„ä¸´åºŠ/å¿ƒç†å­¦æ„ä¹‰
- âŒ **ä¸ç®¡ç†æµ‹è¯„ç”Ÿå‘½å‘¨æœŸ**ï¼šä¸å…³å¿ƒæµ‹è¯„çš„æ‰§è¡Œè€…ã€æ—¶é—´ä¸ä¸Šä¸‹æ–‡

**æ ¸å¿ƒèšåˆï¼š**

1. **`Questionnaire`ï¼ˆé—®å·æ¨¡æ¿ï¼‰** - èšåˆæ ¹
   - å­—æ®µï¼šQuestionnaireIDã€Titleã€Versionã€Questionsã€Pagesã€JumpLogic
   - èŒè´£ï¼šå°è£…é—®å·ç»“æ„çš„å®Œæ•´æ€§çº¦æŸï¼Œæ”¯æŒç‰ˆæœ¬æ¼”è¿›

2. **`AnswerSheet`ï¼ˆç­”å·å®ä¾‹ï¼‰** - èšåˆæ ¹
   - å­—æ®µï¼šAnswerSheetIDã€QuestionnaireIDã€TesteeRefã€FillerRefã€AnswerItemsã€Statusã€SubmittedAt
   - èŒè´£ï¼šè®°å½•ä¸€æ¬¡å¡«å†™è¡Œä¸ºçš„å®Œæ•´ç­”æ¡ˆï¼Œç®¡ç†ç­”å·çŠ¶æ€ï¼ˆdraft/submittedï¼‰

**AnswerSheet å®Œæ•´ç»“æ„è®¾è®¡ï¼š**

```go
// ç­”å·çŠ¶æ€
type AnswerSheetStatus string

const (
    AnswerSheetDraft     AnswerSheetStatus = "draft"     // è‰ç¨¿ï¼ˆå¡«å†™ä¸­ï¼‰
    AnswerSheetSubmitted AnswerSheetStatus = "submitted" // å·²æäº¤
)

// å¡«å†™äººç±»å‹
type FillerType string

const (
    FillerTypeSelf   FillerType = "self"   // å—è¯•è€…æœ¬äºº
    FillerTypeParent FillerType = "parent" // å®¶é•¿ä»£å¡«
    FillerTypeStaff  FillerType = "staff"  // åå°äººå‘˜ååŠ©å¡«å†™
)

// TesteeRefï¼šå—è¯•è€…å¼•ç”¨ï¼ˆå€¼å¯¹è±¡ï¼‰
type TesteeRef struct {
    TesteeID   TesteeID  // å—è¯•è€… ID
    Name       string    // å§“åå¿«ç…§ï¼ˆä¾¿äºæŠ¥å‘Šå±•ç¤ºï¼‰
    Grade      *string   // å¹´çº§å¿«ç…§
    AgeAtTest  *int      // å¡«å†™æ—¶çš„å¹´é¾„ï¼ˆä¾¿äºå¸¸æ¨¡åŒ¹é…ï¼‰
}

// FillerRefï¼šå¡«å†™äººå¼•ç”¨ï¼ˆå€¼å¯¹è±¡ï¼‰
type FillerRef struct {
    FillerType FillerType   // å¡«å†™äººç±»å‹
    FillerID   *string      // å¡«å†™äºº IDï¼ˆIAM.UserID æˆ– Staff.StaffIDï¼‰ï¼Œå¤–éƒ¨å®¶é•¿å¯ä¸ºç©º
    FillerName *string      // å¡«å†™äººå§“åï¼ˆå¤–éƒ¨å®¶é•¿éœ€è®°å½•ï¼‰
}

// AnswerSheet èšåˆæ ¹
type AnswerSheet struct {
    ID              AnswerSheetID
    QuestionnaireID QuestionnaireID
    
    // å—è¯•è€…ä¸å¡«å†™äººä¿¡æ¯
    TesteeRef       TesteeRef   // å—è¯•è€…å¼•ç”¨
    FillerRef       FillerRef   // å¡«å†™äººå¼•ç”¨
    
    // ç­”æ¡ˆå†…å®¹
    AnswerItems     []AnswerItem    // é¢˜ç›®ç­”æ¡ˆåˆ—è¡¨
    
    // çŠ¶æ€ä¸æ—¶é—´
    Status          AnswerSheetStatus
    CreatedAt       time.Time
    SubmittedAt     *time.Time
    
    // å†—ä½™å­—æ®µï¼ˆä¾¿äºæŸ¥è¯¢ï¼‰
    OrgID           int64           // ç»„ç»‡ ID
    Version         int64           // ä¹è§‚é”ç‰ˆæœ¬å·
}

// AnswerItemï¼šå•é¢˜ç­”æ¡ˆï¼ˆå®ä½“ï¼‰
type AnswerItem struct {
    QuestionID   string      // é¢˜ç›® ID
    QuestionText string      // é¢˜ç›®æ–‡æœ¬å¿«ç…§
    Value        interface{} // ç­”æ¡ˆå€¼ï¼ˆå•é€‰/å¤šé€‰/å¡«ç©ºï¼‰
    Score        *float64    // é¢˜ç›®å¾—åˆ†ï¼ˆè®¡åˆ†åå¡«å……ï¼‰
}
```

**å…³é”®è®¾è®¡è¯´æ˜ï¼š**

| è®¾è®¡ç‚¹ | è¯´æ˜ | åŸå›  |
|-------|------|------|
| **TesteeRef vs FillerRef** | å—è¯•è€…â‰ å¡«å†™äººï¼Œåˆ†å¼€è®°å½• | å®¶é•¿ä»£å¡«å„¿ç«¥é‡è¡¨ã€åŒ»ç”ŸååŠ©æ‚£è€…å¡«å†™ |
| **FillerType æšä¸¾** | åŒºåˆ†è‡ªå¡«ã€å®¶é•¿ä»£å¡«ã€åå°ååŠ© | æ”¯æŒç»Ÿè®¡"ä»£å¡«ç‡"ã€å®¡è®¡"è°å¡«çš„" |
| **FillerID å¯ä¸ºç©º** | å¤–éƒ¨å®¶é•¿æ—  IAM ç”¨æˆ· ID | å…¥æ ¡ç­›æŸ¥åœºæ™¯ï¼Œæ‰«ç å®¶é•¿æ— éœ€æ³¨å†Œ |
| **TesteeRef å¿«ç…§** | è®°å½•å¡«å†™æ—¶çš„å¹´é¾„ã€å¹´çº§ | å¸¸æ¨¡åŒ¹é…éœ€è¦å¡«å†™æ—¶çš„å¹´é¾„ï¼Œè€Œéå½“å‰å¹´é¾„ |
| **AnswerItem å¿«ç…§** | è®°å½•é¢˜ç›®æ–‡æœ¬ | é—®å·ç‰ˆæœ¬æ¼”è¿›åï¼Œå†å²ç­”å·ä»å¯æ­£ç¡®å±•ç¤º |
| **ä¸å­˜å‚¨ä¸šåŠ¡æ¥æº** | ä¸åŒ…å« Scenarioã€PlanIDã€ScreeningID | ä¸šåŠ¡æ¥æºç”± Assessment ç®¡ç†ï¼Œä¿æŒ AnswerSheet çº¯ç²¹ |

**å­˜å‚¨ç­–ç•¥ï¼š**

- **å­˜å‚¨å¼•æ“**ï¼šMongoDB
- **åŸå› **ï¼šç­”æ¡ˆç»“æ„ä¸å›ºå®šï¼ˆå•é€‰/å¤šé€‰/å¡«ç©º/çŸ©é˜µé¢˜ï¼‰ï¼Œæ–‡æ¡£å‹æ•°æ®åº“æ›´çµæ´»
- **ç´¢å¼•è®¾è®¡**ï¼š
  - `{testee_ref.testee_id: 1, created_at: -1}` - æŸ¥è¯¢æŸäººçš„ç­”å·å†å²
  - `{questionnaire_id: 1, status: 1}` - ç»Ÿè®¡é—®å·æäº¤ç‡
  - `{org_id: 1, created_at: -1}` - æŒ‰ç»„ç»‡æŸ¥è¯¢ç­”å·

**é€‚ç”¨åœºæ™¯ï¼š**

| åœºæ™¯ç±»å‹ | å…¸å‹ç”¨ä¾‹ | æ˜¯å¦éœ€è¦é‡è¡¨ |
|---------|---------|------------|
| çº¯é—®å·æ¨¡å¼ | å®¢æˆ·æ»¡æ„åº¦è°ƒæŸ¥ã€ç”¨æˆ·åé¦ˆæ”¶é›†ã€å¸‚åœºè°ƒç ” | âŒ |
| é‡è¡¨æ¨¡å¼ | å¿ƒç†é‡è¡¨æµ‹è¯„ã€è¡Œä¸ºè¯„å®šã€è®¤çŸ¥è¯„ä¼° | âœ… |

**æ•°æ®å­˜å‚¨ç­–ç•¥ï¼š**

- Questionnaireï¼šMongoDBï¼ˆæ–‡æ¡£å‹ï¼Œæ”¯æŒå¤æ‚ç»“æ„ä¸ç‰ˆæœ¬æ¼”è¿›ï¼‰
- AnswerSheetï¼šMongoDBï¼ˆæ–‡æ¡£å‹ï¼Œç­”æ¡ˆç»“æ„ä¸å›ºå®šï¼‰

---

#### ğŸ§¬ 1.3.2 scale å­åŸŸï¼ˆé‡è¡¨è§£è¯»ï¼‰

**æ ¸å¿ƒå®šä½ï¼š** ä¸“ä¸šé‡è¡¨çš„è§„åˆ™åº“ä¸ç®—æ³•å°è£…

**èŒè´£æ¸…å•ï¼š**

- âœ… **é‡è¡¨ç»“æ„å®šä¹‰**ï¼šå› å­ã€ç»´åº¦ã€æµ‹é‡æŒ‡æ ‡
- âœ… **è®¡åˆ†è§„åˆ™é…ç½®**ï¼šé¢˜ç›®æƒé‡ã€åå‘è®¡åˆ†ã€å› å­èšåˆ
- âœ… **å¸¸æ¨¡ä¸é£é™©åŒºé—´ç®¡ç†**ï¼šå®šä¹‰æ­£å¸¸/è¾¹ç¼˜/å¼‚å¸¸åˆ†æ•°ç•Œé™
- âœ… **è§£è¯»è§„åˆ™ä¸ç»“è®ºæ¨¡æ¿**ï¼šä¸åŒåˆ†æ•°åŒºé—´å¯¹åº”çš„æ–‡æ¡ˆä¸å»ºè®®
- âœ… **è¯„ä¼°ç®—æ³•å°è£…**ï¼šé€šè¿‡ç­–ç•¥æ¨¡å¼ + èŒè´£é“¾å®ç°ï¼ˆè¯¦è§ 12-02ï¼‰
- âŒ **ä¸å­˜å‚¨å…·ä½“æµ‹è¯„è®°å½•**ï¼šä¸è®°å½•"è°åœ¨ä½•æ—¶å®Œæˆäº†å“ªä¸ªé‡è¡¨"
- âŒ **ä¸ç®¡ç†æµ‹è¯„æ‰§è¡Œæµç¨‹**ï¼šä¸å…³å¿ƒæµ‹è¯„çš„å‘èµ·ã€æŸ¥è¯¢ä¸ç»“æœæ¨é€

**æ ¸å¿ƒèšåˆï¼š**

1. **`MedicalScale`ï¼ˆé‡è¡¨å®šä¹‰ï¼‰** - èšåˆæ ¹
   - å­—æ®µï¼šMedicalScaleIDã€Nameã€Versionã€Factorsã€InterpretationRulesã€NormTable
   - èŒè´£ï¼šå°è£…é‡è¡¨çš„å®Œæ•´è¯­ä¹‰ï¼Œç¡®ä¿è¯„åˆ†è§„åˆ™ä¸è§£è¯»é€»è¾‘çš„ä¸€è‡´æ€§

**å†…éƒ¨å®ä½“/å€¼å¯¹è±¡ï¼š**

- `Factor`ï¼ˆå› å­/ç»´åº¦ï¼‰ï¼šå®ä½“ï¼ŒåŒ…å« FactorCodeã€Nameã€RelatedQuestions
- `InterpretationRule`ï¼ˆè§£è¯»è§„åˆ™ï¼‰ï¼šå€¼å¯¹è±¡ï¼Œå®šä¹‰åˆ†æ•°åŒºé—´ â†’ é£é™©ç­‰çº§ â†’ ç»“è®ºæ–‡æ¡ˆçš„æ˜ å°„
- `NormTable`ï¼ˆå¸¸æ¨¡è¡¨ï¼‰ï¼šå€¼å¯¹è±¡ï¼Œæ”¯æŒæŒ‰å¹´é¾„/æ€§åˆ«/åœ°åŒºçš„åˆ†å±‚å¸¸æ¨¡

**å…¸å‹é‡è¡¨ç¤ºä¾‹ï¼š**

| é‡è¡¨ç±»å‹ | å…¸å‹é‡è¡¨ | å› å­ç¤ºä¾‹ | åº”ç”¨åœºæ™¯ |
|---------|---------|---------|---------|
| å¿ƒç†é‡è¡¨ | SDSã€SASã€SCL-90 | æŠ‘éƒã€ç„¦è™‘ã€äººé™…æ•æ„Ÿ | æƒ…ç»ªçŠ¶æ€è¯„ä¼° |
| è¡Œä¸ºé‡è¡¨ | Connersã€CBCL | å¤šåŠ¨ã€å¯¹ç«‹è¿æŠ—ã€ç¤¾äº¤é—®é¢˜ | å„¿ç«¥è¡Œä¸ºé—®é¢˜ç­›æŸ¥ |
| è®¤çŸ¥é‡è¡¨ | MMSEã€MoCA | å®šå‘åŠ›ã€è®°å¿†ã€è¯­è¨€ | è®¤çŸ¥åŠŸèƒ½è¯„ä¼° |

**å…³é”®è®¾è®¡ç‚¹ï¼š**

- é‡è¡¨å®šä¹‰ä¸é—®å·å®šä¹‰åˆ†ç¦»ï¼šåŒä¸€ä»½é—®å·å¯å¯¹åº”å¤šä¸ªé‡è¡¨ï¼ˆå¦‚ SCL-90 å¯æ‹†åˆ†ä¸ºå¤šä¸ªç»´åº¦é‡è¡¨ï¼‰
- æ”¯æŒå¤šç‰ˆæœ¬ç®¡ç†ï¼šé‡è¡¨å¸¸æ¨¡ä¸è§£è¯»è§„åˆ™å¯èƒ½å› ç ”ç©¶è¿›å±•è€Œæ›´æ–°
- ç®—æ³•å¯æ’æ‹”ï¼šé€šè¿‡ Evaluator æ¥å£å®ç°ä¸åŒé‡è¡¨çš„è¯„åˆ†ç­–ç•¥

**æ•°æ®å­˜å‚¨ç­–ç•¥ï¼š**

- MedicalScaleï¼šMySQLï¼ˆç»“æ„åŒ–ï¼Œé¢‘ç¹æŸ¥è¯¢ï¼‰
- Factorsã€InterpretationRulesï¼šJSON å­—æ®µï¼ˆå¤æ‚ç»“æ„ï¼ŒæŸ¥è¯¢è¾ƒå°‘ï¼‰

---

#### ğŸ¯ 1.3.3 assessment å­åŸŸï¼ˆæµ‹è¯„æ¡ˆä¾‹ï¼‰

**æ ¸å¿ƒå®šä½ï¼š** ä¸€æ¬¡æµ‹è¯„è¡Œä¸ºçš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œä½œä¸ºæ¡¥æ¥èšåˆè¿æ¥å„å­åŸŸ

**èŒè´£æ¸…å•ï¼š**

- âœ… **è®°å½•å®Œæ•´æµ‹è¯„å…ƒä¿¡æ¯**ï¼šæµ‹è¯„å¯¹è±¡ï¼ˆTesteeï¼‰ã€æ—¶é—´ï¼ˆCreatedAtï¼‰ã€å†…å®¹ï¼ˆQuestionnaire + MedicalScaleï¼‰ã€æ¥æºï¼ˆPlan/Screening/Adhocï¼‰
- âœ… **ç®¡ç†æµ‹è¯„çŠ¶æ€æœº**ï¼špending â†’ submitted â†’ interpreted â†’ failed
- âœ… **æ¡¥æ¥å„å­åŸŸèšåˆ**ï¼šé€šè¿‡å¤–é”®å…³è” Testeeã€AnswerSheetã€MedicalScaleã€Plan/Screening
- âœ… **ä½œä¸ºç»Ÿè®¡åˆ†æé”šç‚¹**ï¼šæ”¯æŒæŒ‰äººã€æŒ‰æ—¶é—´ã€æŒ‰é¡¹ç›®èšåˆæŸ¥è¯¢
- âœ… **å‘å¸ƒé¢†åŸŸäº‹ä»¶**ï¼šAssessmentSubmittedEventã€AssessmentInterpretedEvent
- âŒ **ä¸è´Ÿè´£å…·ä½“è¯„åˆ†ç®—æ³•**ï¼šå§”æ‰˜ç»™ scale.Evaluator
- âŒ **ä¸è´Ÿè´£æ•°æ®æ”¶é›†**ï¼šå§”æ‰˜ç»™ survey.AnswerSheet

**æ ¸å¿ƒèšåˆï¼š**

1. **`Assessment`ï¼ˆæµ‹è¯„æ¡ˆä¾‹ï¼‰** - èšåˆæ ¹
   - å­˜å‚¨ï¼šMySQL
   - å­—æ®µï¼š
     - åŸºç¡€ä¿¡æ¯ï¼šAssessmentIDã€TesteeIDã€QuestionnaireIDã€AnswerSheetIDã€MedicalScaleID
     - æ¥æºä¿¡æ¯ï¼šOriginType (adhoc/plan/screening)ã€OriginID
     - çŠ¶æ€ä¿¡æ¯ï¼šStatusã€TotalScoreã€RiskLevel
     - æ—¶é—´ä¿¡æ¯ï¼šCreatedAtã€SubmittedAtã€InterpretedAt
   - èŒè´£ï¼šåè°ƒå„å­åŸŸèšåˆå®Œæˆæµ‹è¯„å…¨æµç¨‹ï¼Œå‘å¸ƒé¢†åŸŸäº‹ä»¶

**Assessment å®Œæ•´ç»“æ„è®¾è®¡ï¼š**

```go
// æµ‹è¯„æ¥æºç±»å‹
type AssessmentOriginType string

const (
    OriginAdhoc      AssessmentOriginType = "adhoc"      // ä¸´æ—¶æµ‹è¯„ï¼ˆåŒ»ç”Ÿå¼€å•/ç”¨æˆ·è‡ªåŠ©ï¼‰
    OriginPlan       AssessmentOriginType = "plan"       // æ¥è‡ªæµ‹è¯„è®¡åˆ’
    OriginScreening  AssessmentOriginType = "screening"  // æ¥è‡ªç­›æŸ¥é¡¹ç›®
)

// æµ‹è¯„çŠ¶æ€
type AssessmentStatus string

const (
    AssessmentPending    AssessmentStatus = "pending"     // å·²åˆ›å»ºï¼Œç­‰å¾…å¡«å†™
    AssessmentSubmitted  AssessmentStatus = "submitted"   // å·²æäº¤ç­”å·ï¼Œç­‰å¾…è§£è¯»
    AssessmentInterpreted AssessmentStatus = "interpreted"// å·²å®Œæˆè§£è¯»
    AssessmentFailed     AssessmentStatus = "failed"      // è§£è¯»å¤±è´¥
    AssessmentCanceled   AssessmentStatus = "canceled"    // å·²å–æ¶ˆ
)

// Assessment èšåˆæ ¹
type Assessment struct {
    ID             AssessmentID
    
    // åŸºç¡€å…³è”ä¿¡æ¯
    TesteeID       TesteeID
    OrgID          int64
    QuestionnaireID QuestionnaireID
    MedicalScaleID  *MedicalScaleID     // é‡è¡¨æ¨¡å¼æ—¶æœ‰å€¼
    AnswerSheetID   *AnswerSheetID      // æäº¤åæœ‰å€¼
    
    // æ¥æºä¿¡æ¯ï¼ˆæ ¸å¿ƒï¼šåŒºåˆ†ä¸šåŠ¡åœºæ™¯ï¼‰
    OriginType     AssessmentOriginType // adhoc / plan / screening
    PlanID         *PlanID              // OriginType = plan æ—¶æœ‰å€¼
    ScreeningID    *ScreeningProjectID  // OriginType = screening æ—¶æœ‰å€¼
    
    // çŠ¶æ€ä¸ç»“æœ
    Status         AssessmentStatus
    TotalScore     *float64             // æ€»åˆ†ï¼ˆè§£è¯»åæœ‰å€¼ï¼‰
    RiskLevel      *string              // é£é™©ç­‰çº§ï¼ˆè§£è¯»åæœ‰å€¼ï¼‰
    
    // æ—¶é—´ä¿¡æ¯
    CreatedAt      time.Time
    CreatedBy      *int64               // Staff.StaffID æˆ–ç‰¹æ®Šå€¼ï¼ˆè‡ªåŠ©æµ‹è¯„ï¼‰
    SubmittedAt    *time.Time
    InterpretedAt  *time.Time
    
    // ç‰ˆæœ¬ä¸è½¯åˆ é™¤
    DeletedAt      *time.Time
    Version        int64
}
```

**OriginType ä½¿ç”¨åœºæ™¯è¯´æ˜ï¼š**

| OriginType | å…¸å‹åœºæ™¯ | OriginID æŒ‡å‘ | ç»Ÿè®¡ç»´åº¦ |
|-----------|---------|--------------|---------|
| **adhoc** | åŒ»ç”Ÿä¸´æ—¶å¼€å•ã€ç”¨æˆ·è‡ªåŠ©æµ‹è¯„ | æ—  | æŒ‰äººã€æŒ‰æ—¶é—´ç»Ÿè®¡ |
| **plan** | äº’è”ç½‘åŒ»é™¢éšè®¿ã€è®­ç»ƒä¸­å¿ƒå‘¨æœŸè¯„ä¼° | AssessmentPlan.ID | è®¡åˆ’å®Œæˆç‡ã€è¶‹åŠ¿åˆ†æ |
| **screening** | å­¦æ ¡å…¥å­¦ç­›æŸ¥ã€ç¤¾åŒºå¥åº·æ™®æŸ¥ | ScreeningProject.ID | é¡¹ç›®è¦†ç›–ç‡ã€é£é™©åˆ†å¸ƒ |

**å…³é”®è®¾è®¡è¯´æ˜ï¼š**

| è®¾è®¡ç‚¹ | è¯´æ˜ | åŸå›  |
|-------|------|------|
| **OriginType å¿…å¡«** | æ‰€æœ‰æµ‹è¯„å¿…é¡»æ ‡è¯†æ¥æº | æ”¯æŒç»Ÿè®¡åˆ†æã€è¿½æº¯æµ‹è¯„ä¸Šä¸‹æ–‡ |
| **PlanID/ScreeningID äº’æ–¥** | æ ¹æ® OriginType å†³å®šå“ªä¸ªå­—æ®µæœ‰å€¼ | é¿å…æ•°æ®å†—ä½™ä¸ä¸ä¸€è‡´ |
| **MedicalScaleID å¯ä¸ºç©º** | çº¯é—®å·æ¨¡å¼æ—¶ä¸ºç©º | æ”¯æŒé—®å·æ¨¡å¼ä¸é‡è¡¨æ¨¡å¼åˆ‡æ¢ |
| **AnswerSheetID å¯ä¸ºç©º** | åˆ›å»ºæ—¶ä¸ºç©ºï¼Œæäº¤åå¡«å…… | æ”¯æŒ"å…ˆåˆ›å»ºæµ‹è¯„å…¥å£ï¼Œåå¡«å†™"æµç¨‹ |
| **RiskLevel å¯ä¸ºç©º** | é‡è¡¨æ¨¡å¼è§£è¯»åæœ‰å€¼ | é—®å·æ¨¡å¼æ— é£é™©è¯„ä¼° |

**çŠ¶æ€æœºæµè½¬ï¼š**

```text
pending â”€â”€Submit()â”€â”€> submitted â”€â”€Interpret()â”€â”€> interpreted
   â†“                      â†“                           â†“
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Fail() â”€â”€â”€â”€â”€â”€â”€â”€â”€> failed
                                    â†“
                                canceled
```

**ä¸šåŠ¡æ¥æºä¸ç»Ÿè®¡ç¤ºä¾‹ï¼š**

```sql
-- æŸ¥è¯¢æŸä¸ªè®¡åˆ’çš„å®Œæˆç‡
SELECT 
    COUNT(CASE WHEN status = 'interpreted' THEN 1 END) AS completed_count,
    COUNT(*) AS total_count
FROM assessments
WHERE origin_type = 'plan' AND plan_id = ?;

-- æŸ¥è¯¢æŸä¸ªç­›æŸ¥é¡¹ç›®çš„é£é™©åˆ†å¸ƒ
SELECT risk_level, COUNT(*) AS count
FROM assessments
WHERE origin_type = 'screening' AND screening_id = ?
GROUP BY risk_level;

-- æŸ¥è¯¢æŸäººçš„æ‰€æœ‰æµ‹è¯„è®°å½•ï¼ˆå«æ¥æºï¼‰
SELECT 
    a.id, a.origin_type, a.status, a.total_score,
    p.name AS plan_name,
    sp.name AS screening_name
FROM assessments a
LEFT JOIN assessment_plans p ON a.plan_id = p.id
LEFT JOIN screening_projects sp ON a.screening_id = sp.id
WHERE a.testee_id = ?
ORDER BY a.created_at DESC;
```

2. **`AssessmentScore`ï¼ˆå› å­å¾—åˆ†ï¼‰** - å®ä½“
   - å­˜å‚¨ï¼šMySQL
   - å­—æ®µï¼šAssessmentIDã€FactorCodeã€RawScoreã€StandardScoreã€RiskLevel
   - èŒè´£ï¼šä¾¿äºç»´åº¦è¶‹åŠ¿åˆ†æï¼ˆ"å¼ ä¸‰çš„ç„¦è™‘å› å­å¾—åˆ†åœ¨ 3 ä¸ªæœˆå†…çš„å˜åŒ–"ï¼‰

3. **`InterpretReport`ï¼ˆè§£è¯»æŠ¥å‘Šï¼‰** - èšåˆæ ¹
   - å­˜å‚¨ï¼šMongoDB
   - å­—æ®µï¼šReportIDã€AssessmentIDã€TotalScoreã€RiskLevelã€FactorScoresã€Conclusionã€Suggestions
   - èŒè´£ï¼šé¢å‘ç”¨æˆ·çš„æœ€ç»ˆæŠ¥å‘Šï¼Œæ”¯æŒå¯Œæ–‡æœ¬ã€å›¾è¡¨ã€å†å²å¯¹æ¯”

**å…³é”®è®¾è®¡ç‚¹ï¼š**

| è®¾è®¡è¦ç‚¹ | è¯´æ˜ | å®ç°æ–¹å¼ |
|---------|------|---------|
| **æ¡¥æ¥æ¨¡å¼** | é€šè¿‡å¤–é”®å…³è”å…¶ä»–èšåˆï¼Œé¿å…èšåˆé—´å¼ºè€¦åˆ | TesteeID, QuestionnaireID, AnswerSheetID, MedicalScaleID |
| **çŠ¶æ€æœº** | æ˜ç¡®çš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€è½¬æ¢ | Status å­—æ®µ + Submit()ã€Interpret()ã€Fail() æ–¹æ³• |
| **æ¥æºæ ‡è¯†** | åŒºåˆ†ä¸åŒä¸šåŠ¡åœºæ™¯çš„æµ‹è¯„ | OriginType (adhoc/plan/screening) + OriginID |
| **äº‹ä»¶é©±åŠ¨** | çŠ¶æ€å˜æ›´å‘å¸ƒé¢†åŸŸäº‹ä»¶ | PublishEvent(AssessmentSubmittedEvent) |
| **è¯»å†™åˆ†ç¦»** | Assessment å†™å…¥ MySQLï¼ŒInterpretReport æŸ¥è¯¢ MongoDB | æå‡æŸ¥è¯¢æ€§èƒ½ä¸çµæ´»æ€§ |

**çŠ¶æ€æœºæµè½¬ï¼š**

```text
pending â”€â”€Submit()â”€â”€> submitted â”€â”€Evaluate()â”€â”€> interpreted
   â†“                      â†“                          â†“
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Fail() â”€â”€â”€â”€â”€â”€â”€â”€â”€> failed
```

**æ•°æ®æµç¤ºä¾‹ï¼ˆSDS é‡è¡¨æµ‹è¯„ï¼‰ï¼š**

1. ç”¨æˆ·æ‰«ç è¿›å…¥æµ‹è¯„ â†’ åˆ›å»º Assessmentï¼ˆstatus=pendingï¼‰
2. ç”¨æˆ·å¡«å†™é—®å· â†’ åˆ›å»º AnswerSheetï¼ˆstatus=draftï¼‰
3. ç”¨æˆ·æäº¤ â†’ AnswerSheet.Submit() + Assessment.Submit() â†’ å‘å¸ƒ AssessmentSubmittedEvent
4. qs-worker æ¶ˆè´¹äº‹ä»¶ â†’ è°ƒç”¨ scale.Evaluator.Evaluate() â†’ ç”Ÿæˆ AssessmentScore ä¸ InterpretReport
5. æ›´æ–° Assessment.Status=interpreted â†’ å‘å¸ƒ AssessmentInterpretedEvent
6. å‰ç«¯è½®è¯¢æˆ–æ¥æ”¶æ¨é€ â†’ æŸ¥è¯¢ InterpretReport å±•ç¤ºç»“æœ

---

#### ğŸ‘¥ 1.3.4 user å­åŸŸï¼ˆBCå†…ç”¨æˆ·è§†å›¾ï¼‰

**æ ¸å¿ƒå®šä½ï¼š** é—®å·&é‡è¡¨ BC å¯¹ç”¨æˆ·çš„é¢†åŸŸç‰¹å®šè§†å›¾ï¼Œä¸ IAM BC è§£è€¦

**èŒè´£æ¸…å•ï¼š**

- âœ… **ç»´æŠ¤æµ‹è¯„ç›¸å…³çš„ç”¨æˆ·å±æ€§**ï¼šå¹´çº§ã€æ ‡ç­¾ã€ç»„ç»‡ã€è§’è‰²ç­‰
- âœ… **é€šè¿‡ ID æ˜ å°„ä¸ IAM BC å…³è”**ï¼šIAMUserIDã€IAMChildID
- âœ… **ä½œä¸ºç»Ÿè®¡åˆ†æçš„"äºº"ç»´åº¦å…¥å£**ï¼š"å¼ ä¸‰çš„æ‰€æœ‰æµ‹è¯„è®°å½•"
- âœ… **æ”¯æŒæŒ‰ç»„ç»‡/æ ‡ç­¾/å¹´çº§ç­‰ç»´åº¦æŸ¥è¯¢**ï¼š"ä¸€å¹´çº§æ‰€æœ‰å­¦ç”Ÿçš„æµ‹è¯„å®Œæˆç‡"
- âŒ **ä¸è´Ÿè´£è®¤è¯æˆæƒ**ï¼šç”± IAM BC çš„ AuthN/AuthZ æ¨¡å—è´Ÿè´£
- âŒ **ä¸æŒæœ‰æ•æ„Ÿä¿¡æ¯**ï¼šä¸å­˜å‚¨æ‰‹æœºå·ã€å¯†ç ã€èº«ä»½è¯å·ç­‰

**æ ¸å¿ƒèšåˆï¼š**

1. **`Testee`ï¼ˆå—è¯•è€…ï¼‰** - èšåˆæ ¹
   - å­—æ®µï¼šTesteeIDã€IAMUserIDã€IAMChildIDã€OrgIDã€Gradeã€Tagsã€CreatedAt
   - èŒè´£ï¼šè®°å½•"è¢«æµ‹äºº"çš„é¢†åŸŸå±æ€§ï¼Œä½œä¸º Assessment çš„å¤–é”®

2. **`Staff`ï¼ˆåå°äººå‘˜ï¼‰** - èšåˆæ ¹
   - å­—æ®µï¼šStaffIDã€IAMUserIDã€OrgIDã€Roleã€CreatedAt
   - èŒè´£ï¼šè®°å½•"æ‰§è¡Œæµ‹è¯„/æŸ¥çœ‹æŠ¥å‘Š"çš„åå°äººå‘˜ä¿¡æ¯

**ä¸ IAM BC çš„å…³ç³»ï¼š**

```text
IAM BC (ç»Ÿä¸€èº«ä»½è®¤è¯)       é—®å·&é‡è¡¨ BC (ä¸šåŠ¡é¢†åŸŸè§†å›¾)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User             â”‚ â—„â”€â”€â”€â”€â”€â”€â”¤ Testee               â”‚
â”‚ - UserID         â”‚  æ˜ å°„  â”‚ - TesteeID           â”‚
â”‚ - Phone          â”‚        â”‚ - IAMUserID (FK)     â”‚
â”‚ - Password       â”‚        â”‚ - Grade, Tags        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Child            â”‚ â—„â”€â”€â”€â”€â”€â”€â”¤ Testee               â”‚
â”‚ - ChildID        â”‚  æ˜ å°„  â”‚ - TesteeID           â”‚
â”‚ - ParentUserID   â”‚        â”‚ - IAMChildID (FK)    â”‚
â”‚ - Birthdate      â”‚        â”‚ - Grade, Tags        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®è®¾è®¡ç‚¹ï¼š**

- **å»¶è¿Ÿåˆ›å»º**ï¼šTestee åœ¨ç”¨æˆ·é¦–æ¬¡å‚ä¸æµ‹è¯„æ—¶åˆ›å»ºï¼Œè€Œéåœ¨ IAM æ³¨å†Œæ—¶åˆ›å»º
- **ID æ˜ å°„**ï¼šé€šè¿‡ IAMUserID/IAMChildID å…³è”ï¼Œé¿å…è·¨ BC èšåˆå¼•ç”¨
- **å±æ€§å†—ä½™**ï¼šOrgIDã€Grade ç­‰å±æ€§åœ¨æœ¬ BC ç»´æŠ¤ï¼Œä»¥å‡å°‘è·¨ BC æŸ¥è¯¢
- **è§’è‰²åˆ†ç¦»**ï¼šStaff ä¸ Testee æ˜¯ä¸åŒèšåˆï¼Œè§’è‰²èŒè´£æ¸…æ™°

**æ•°æ®å­˜å‚¨ç­–ç•¥ï¼š**

- Testeeã€Staffï¼šMySQLï¼ˆç»“æ„åŒ–ï¼Œé¢‘ç¹æŸ¥è¯¢ï¼‰

---

#### ğŸ“… 1.3.5 plan å­åŸŸï¼ˆæµ‹è¯„è®¡åˆ’ï¼‰

**æ ¸å¿ƒå®šä½ï¼š** å‘¨æœŸæ€§ã€è®¡åˆ’æ€§æµ‹è¯„çš„é…ç½®ä¸è°ƒåº¦

**èŒè´£æ¸…å•ï¼š**

- âœ… **æµ‹è¯„è®¡åˆ’çš„åˆ›å»ºä¸é…ç½®**ï¼šæŒ‡å®šå—è¯•è€…ã€é‡è¡¨ã€é¢‘ç‡ã€èµ·æ­¢æ—¶é—´
- âœ… **è®¡åˆ’ä»»åŠ¡çš„ç”Ÿæˆä¸æ—¶é—´è°ƒåº¦**ï¼šæŒ‰å‘¨æœŸè‡ªåŠ¨ç”Ÿæˆ AssessmentTask
- âœ… **ä¸ Assessment å…³è”**ï¼šé€šè¿‡ OriginType=plan æ ‡è¯†æµ‹è¯„æ¥æº
- âœ… **æ”¯æŒå¤šç§é¢‘ç‡æ¨¡å¼**ï¼šå›ºå®šé—´éš”ï¼ˆæ¯å‘¨/æ¯æœˆï¼‰ã€è‡ªå®šä¹‰å‘¨æ¬¡ï¼ˆç¬¬ 2/4/8/12 å‘¨ï¼‰
- âŒ **ä¸æ‰§è¡Œå…·ä½“æµ‹è¯„**ï¼šå§”æ‰˜ç»™ assessment å­åŸŸ
- âŒ **ä¸è´Ÿè´£æ¶ˆæ¯æé†’**ï¼šç”±ç‹¬ç«‹çš„é€šçŸ¥æ¨¡å—è´Ÿè´£

**æ ¸å¿ƒèšåˆï¼š**

1. **`AssessmentPlan`ï¼ˆæµ‹è¯„è®¡åˆ’ï¼‰** - èšåˆæ ¹
   - å­—æ®µï¼šPlanIDã€TesteeIDã€MedicalScaleIDã€FrequencyTypeã€FrequencyValueã€StartDateã€EndDateã€Status
   - èŒè´£ï¼šç®¡ç†è®¡åˆ’çš„é…ç½®ä¸çŠ¶æ€

2. **`AssessmentTask`ï¼ˆè®¡åˆ’ä»»åŠ¡ï¼‰** - å®ä½“
   - å­—æ®µï¼šTaskIDã€PlanIDã€ScheduledAtã€AssessmentIDã€Status
   - èŒè´£ï¼šè¡¨ç¤º"æŸæ¬¡åº”è¯¥å‘ç”Ÿçš„æµ‹è¯„"ï¼Œç”Ÿæˆæµ‹è¯„å…¥å£

**å…¸å‹ä¸šåŠ¡åœºæ™¯ï¼š**

| åœºæ™¯ | è§¦å‘æº | é¢‘ç‡ç¤ºä¾‹ | è¯´æ˜ |
|-----|--------|---------|------|
| æ‚£è€…éšè®¿ | äº’è”ç½‘åŒ»é™¢ BC | å‡ºé™¢å 2ã€4ã€8ã€12 å‘¨ | æœ¯åæ¢å¤è¿½è¸ªï¼Œè¯„ä¼°åº·å¤æ•ˆæœ |
| å­¦å‘˜è®­ç»ƒ | è¡Œä¸ºè®­ç»ƒä¸­å¿ƒ BC | å…¥æ ¡åæ¯æœˆä¸€æ¬¡ | è®­ç»ƒæ•ˆæœè¯„ä¼°ï¼Œè°ƒæ•´å¹²é¢„æ–¹æ¡ˆ |
| æ…¢ç—…ç®¡ç† | å¥åº·ç®¡ç† BC | æ¯å­£åº¦ä¸€æ¬¡ | é•¿æœŸå¥åº·ç›‘æµ‹ï¼Œé¢„é˜²ç–¾ç—…æ¶åŒ– |

**è®¡åˆ’ä»»åŠ¡ç”Ÿæˆé€»è¾‘ï¼š**

```text
AssessmentPlan (FrequencyType=FixedInterval, FrequencyValue=7)
   â†“ å®šæ—¶ä»»åŠ¡æ‰«æ
AssessmentTask (ScheduledAt = Plan.StartDate + 7*N days)
   â†“ åˆ°æœŸè§¦å‘
åˆ›å»º Assessment (OriginType=plan, OriginID=PlanID)
```

**æ•°æ®å­˜å‚¨ç­–ç•¥ï¼š**

- AssessmentPlanã€AssessmentTaskï¼šMySQL

---

#### ğŸ« 1.3.6 screening å­åŸŸï¼ˆå…¥æ ¡ç­›æŸ¥ï¼‰

**æ ¸å¿ƒå®šä½ï¼š** æ‰¹é‡ç­›æŸ¥é¡¹ç›®çš„é…ç½®ä¸ç»Ÿè®¡

**èŒè´£æ¸…å•ï¼š**

- âœ… **ç­›æŸ¥é¡¹ç›®çš„åˆ›å»ºä¸é…ç½®**ï¼šå­¦æ ¡ã€å¹´çº§ã€ç­çº§ã€é‡è¡¨ã€æ—¶é—´çª—å£
- âœ… **äºŒç»´ç å…¥å£ç”Ÿæˆä¸ç®¡ç†**ï¼šæ¯ä¸ªç­çº§/å¹´çº§ä¸€ä¸ªç‹¬ç«‹äºŒç»´ç 
- âœ… **é¡¹ç›®çº§ç»Ÿè®¡**ï¼šå‚ä¸ç‡ã€è¦†ç›–ç‡ã€é£é™©åˆ†å¸ƒã€å¼‚å¸¸åå•
- âœ… **ä¸ Assessment å…³è”**ï¼šé€šè¿‡ OriginType=screening æ ‡è¯†æµ‹è¯„æ¥æº
- âŒ **ä¸æ‰§è¡Œå…·ä½“æµ‹è¯„**ï¼šå§”æ‰˜ç»™ assessment å­åŸŸ
- âŒ **ä¸è´Ÿè´£å®¶é•¿é€šçŸ¥**ï¼šç”±ç‹¬ç«‹çš„é€šçŸ¥æ¨¡å—è´Ÿè´£

**æ ¸å¿ƒèšåˆï¼š**

1. **`ScreeningProject`ï¼ˆç­›æŸ¥é¡¹ç›®ï¼‰** - èšåˆæ ¹
   - å­—æ®µï¼šProjectIDã€Nameã€SchoolIDã€SchoolNameã€GradeListã€MedicalScaleIDã€StartDateã€EndDateã€QRCodeURLã€Status
   - èŒè´£ï¼šç®¡ç†ç­›æŸ¥é¡¹ç›®çš„é…ç½®ä¸ç»Ÿè®¡

**å…¸å‹ä¸šåŠ¡åœºæ™¯ï¼š**

| åœºæ™¯ | ç›®æ ‡äººç¾¤ | é‡è¡¨é€‰æ‹© | ç»Ÿè®¡ç»´åº¦ |
|-----|---------|---------|---------|
| æ–°ç”Ÿå…¥å­¦å¿ƒç†å¥åº·ç­›æŸ¥ | ä¸€å¹´çº§å…¨ä½“å­¦ç”Ÿ | SCL-90 | æŒ‰ç­çº§ç»Ÿè®¡å¼‚å¸¸ç‡ |
| å…¨æ ¡è§†åŠ›å¥åº·ç­›æŸ¥ | å…¨æ ¡å­¦ç”Ÿ | è§†åŠ›æ£€æŸ¥é‡è¡¨ | æŒ‰å¹´çº§ç»Ÿè®¡è¿‘è§†ç‡ |
| ç‰¹å®šå¹´çº§è¡Œä¸ºé—®é¢˜ç­›æŸ¥ | ä¸‰å¹´çº§é—®é¢˜å­¦ç”Ÿ | Conners | è¯†åˆ«é«˜å±å­¦ç”Ÿåå• |

**ç­›æŸ¥æµç¨‹ï¼š**

```text
1. åˆ›å»º ScreeningProject â†’ ç”ŸæˆäºŒç»´ç 
2. å­¦ç”Ÿæ‰«ç  â†’ è‡ªåŠ¨åˆ›å»º Testeeï¼ˆå¦‚ä¸å­˜åœ¨ï¼‰+ Assessmentï¼ˆOriginType=screeningï¼‰
3. å­¦ç”Ÿå¡«å†™é—®å· â†’ AnswerSheet.Submit()
4. å¼‚æ­¥è¯„ä¼° â†’ ç”Ÿæˆ InterpretReport
5. ç®¡ç†å‘˜æŸ¥çœ‹é¡¹ç›®ç»Ÿè®¡ â†’ æŒ‰ç­çº§/å¹´çº§èšåˆé£é™©åˆ†å¸ƒ
```

**æ•°æ®å­˜å‚¨ç­–ç•¥ï¼š**

- ScreeningProjectï¼šMySQL

---

## 2. å­åŸŸä¾èµ–å…³ç³»

ä¸ºé¿å…å¾ªç¯ä¾èµ–ï¼Œä¸¥æ ¼çº¦æŸå¦‚ä¸‹ï¼š

### 2.1 ä¾èµ–è§„åˆ™

| å­åŸŸ | ä¾èµ–é¡¹ | è¯´æ˜ |
|-----|-------|------|
| `survey` | æ—  | åŸºç¡€èƒ½åŠ›å±‚ï¼Œä¸ä¾èµ–å…¶ä»–å­åŸŸ |
| `scale` | `survey` | éœ€è¦è¯»å– Questionnaire çš„ ScoringConfig |
| `assessment` | `survey`ã€`scale`ã€`user`ã€`plan`ã€`screening` | ä½œä¸ºæ¡¥æ¥èšåˆï¼Œåè°ƒå„å­åŸŸ |
| `user` | æ—  | ç‹¬ç«‹çš„ç”¨æˆ·è§†å›¾ |
| `plan` | æ—  | ç‹¬ç«‹çš„è®¡åˆ’ç®¡ç† |
| `screening` | æ—  | ç‹¬ç«‹çš„ç­›æŸ¥é¡¹ç›®ç®¡ç† |

### 2.2 ä¾èµ–å›¾

```text
               common (å€¼å¯¹è±¡ã€é¢†åŸŸäº‹ä»¶)
                  â†‘
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚             â”‚             â”‚
  survey        user      plan  screening
    â†‘             â†‘         â†‘       â†‘
    â”‚             â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                  â”‚
  scale                â”‚
    â†‘                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€assessmentâ”˜
```

### 2.3 ä¾èµ–çº¦æŸ

1. **ä¸¥ç¦å¾ªç¯ä¾èµ–**ï¼šä»»ä½•å­åŸŸä¸å¾—åå‘ä¾èµ–å…¶ä¸‹æ¸¸å­åŸŸ
2. **åªè¯»ä¾èµ–**ï¼šä¸‹æ¸¸å­åŸŸåªèƒ½è¯»å–ä¸Šæ¸¸èšåˆçš„ ID å’Œå€¼å¯¹è±¡ï¼Œä¸å¾—ä¿®æ”¹ä¸Šæ¸¸çŠ¶æ€
3. **äº‹ä»¶è§£è€¦**ï¼šè·¨å­åŸŸçš„çŠ¶æ€åŒæ­¥é€šè¿‡é¢†åŸŸäº‹ä»¶å®ç°ï¼Œé¿å…ç›´æ¥è°ƒç”¨

**ç¤ºä¾‹ï¼š**

- âœ… æ­£ç¡®ï¼šassessment è¯»å– Testee.TesteeIDã€MedicalScale.MedicalScaleID
- âŒ é”™è¯¯ï¼šassessment è°ƒç”¨ Testee.UpdateGrade() ä¿®æ”¹ç”¨æˆ·å¹´çº§
- âœ… æ­£ç¡®ï¼šassessment å‘å¸ƒ AssessmentInterpretedEventï¼Œç”±é€šçŸ¥æ¨¡å—è®¢é˜…åæ¨é€æ¶ˆæ¯
- âŒ é”™è¯¯ï¼šassessment ç›´æ¥è°ƒç”¨é€šçŸ¥æ¨¡å—çš„ SendSMS() æ–¹æ³•

---

## 3. å…¸å‹ä¸šåŠ¡æµç¨‹ä¸æ•°æ®æµ

### 3.1 æµç¨‹ä¸€ï¼šçº¯é—®å·è°ƒæŸ¥ï¼ˆSurvey Onlyï¼‰

**åœºæ™¯ï¼š** å®¢æˆ·æ»¡æ„åº¦è°ƒæŸ¥ï¼Œä¸æ¶‰åŠä¸“ä¸šé‡è¡¨è¯„åˆ†

```text
1. ç®¡ç†å‘˜åˆ›å»º Questionnaireï¼ˆé—®å·æ¨¡æ¿ï¼‰
2. ç”¨æˆ·æ‰«ç è¿›å…¥ â†’ åˆ›å»º AnswerSheetï¼ˆstatus=draftï¼‰
3. ç”¨æˆ·å¡«å†™ç­”æ¡ˆ â†’ AnswerSheet.AddAnswerItem()
4. ç”¨æˆ·æäº¤ â†’ AnswerSheet.Submit() + æ ¡éªŒé€šè¿‡
5. ï¼ˆå¯é€‰ï¼‰åˆ›å»º Assessment è®°å½•ï¼ˆä¸ç»‘å®š MedicalScaleï¼‰
6. ç®¡ç†å‘˜å¯¼å‡ºç­”å·æ•°æ®è¿›è¡Œç»Ÿè®¡åˆ†æ
```

**å…³é”®ç‚¹ï¼š**

- ä¸éœ€è¦ MedicalScale
- ä¸éœ€è¦è§¦å‘è¯„ä¼°å·¥ä½œæµ
- å¯é€‰æ˜¯å¦åˆ›å»º Assessmentï¼ˆå¦‚éœ€è¿½è¸ªç”¨æˆ·å¡«å†™å†å²ï¼‰

---

### 3.2 æµç¨‹äºŒï¼šä¸“ä¸šé‡è¡¨æµ‹è¯„ï¼ˆSurvey + Scale + Assessmentï¼‰

**åœºæ™¯ï¼š** æ‚£è€…æ‰«ç å¡«å†™ SDSï¼ˆæŠ‘éƒè‡ªè¯„é‡è¡¨ï¼‰

```text
1. ç®¡ç†å‘˜é…ç½® MedicalScaleï¼ˆSDS é‡è¡¨å®šä¹‰ï¼‰
2. ç®¡ç†å‘˜åˆ›å»º Questionnaire å¹¶ç»‘å®š MedicalScale
3. ç”¨æˆ·æ‰«ç è¿›å…¥ â†’ åˆ›å»º Assessmentï¼ˆstatus=pending, OriginType=adhocï¼‰
4. ç”¨æˆ·å¡«å†™é—®å· â†’ åˆ›å»º AnswerSheetï¼ˆstatus=draftï¼‰
5. ç”¨æˆ·æäº¤ â†’ AnswerSheet.Submit() + Assessment.Submit()
6. å‘å¸ƒ AssessmentSubmittedEvent â†’ MQ
7. qs-worker æ¶ˆè´¹äº‹ä»¶ï¼š
   a. è¯»å– AnswerSheet ç­”æ¡ˆ
   b. è°ƒç”¨ scale.Evaluator.Evaluate(MedicalScale, AnswerSheet)
   c. ç”Ÿæˆ AssessmentScoreï¼ˆå„å› å­å¾—åˆ†ï¼‰
   d. ç”Ÿæˆ InterpretReportï¼ˆè§£è¯»æŠ¥å‘Šï¼‰
   e. æ›´æ–° Assessmentï¼ˆstatus=interpreted, TotalScore, RiskLevelï¼‰
8. å‘å¸ƒ AssessmentInterpretedEvent
9. å‰ç«¯è½®è¯¢æˆ–æ¥æ”¶æ¨é€ â†’ æŸ¥è¯¢ InterpretReport å±•ç¤ºç»“æœ
```

**å…³é”®ç‚¹ï¼š**

- å¿…é¡»ç»‘å®š MedicalScale
- å¿…é¡»åˆ›å»º Assessment
- æäº¤åè§¦å‘å¼‚æ­¥è¯„ä¼°å·¥ä½œæµ
- é€šè¿‡é¢†åŸŸäº‹ä»¶é©±åŠ¨å„ç¯èŠ‚

---

### 3.3 æµç¨‹ä¸‰ï¼šæµ‹è¯„è®¡åˆ’ï¼ˆPlan-driven Assessmentï¼‰

**åœºæ™¯ï¼š** äº’è”ç½‘åŒ»é™¢ä¸ºæœ¯åæ‚£è€…åˆ¶å®šéšè®¿è®¡åˆ’ï¼Œå‡ºé™¢åç¬¬ 2ã€4ã€8ã€12 å‘¨å„åšä¸€æ¬¡é‡è¡¨æµ‹è¯„

```text
1. åŒ»ç”Ÿåˆ›å»º AssessmentPlanï¼š
   - TesteeID: æ‚£è€…å¼ ä¸‰
   - MedicalScaleID: SDS
   - FrequencyType: CustomWeeks
   - FrequencyValue: [2, 4, 8, 12]
   - StartDate: å‡ºé™¢æ—¥æœŸ
2. ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ AssessmentTaskï¼š
   - Task1: ScheduledAt = StartDate + 2 weeks
   - Task2: ScheduledAt = StartDate + 4 weeks
   - Task3: ScheduledAt = StartDate + 8 weeks
   - Task4: ScheduledAt = StartDate + 12 weeks
3. åˆ°æœŸè§¦å‘ï¼ˆTask1 åˆ°æœŸï¼‰ï¼š
   - åˆ›å»º Assessmentï¼ˆOriginType=plan, OriginID=PlanID, status=pendingï¼‰
   - å‘é€æé†’é€šçŸ¥ï¼ˆç”±é€šçŸ¥æ¨¡å—è´Ÿè´£ï¼‰
4. æ‚£è€…ç‚¹å‡»é€šçŸ¥ â†’ è¿›å…¥å¡«å†™æµç¨‹ï¼ˆåŒæµç¨‹äºŒï¼‰
5. æäº¤åæ›´æ–° AssessmentTask.Status=completed
```

**å…³é”®ç‚¹ï¼š**

- è®¡åˆ’é©±åŠ¨ï¼Œè‡ªåŠ¨ç”Ÿæˆä»»åŠ¡
- é€šè¿‡ OriginType=plan æ ‡è¯†æ¥æº
- æ”¯æŒè¶‹åŠ¿åˆ†æï¼ˆ"å¼ ä¸‰ 4 æ¬¡æµ‹è¯„çš„æŠ‘éƒåˆ†æ•°å˜åŒ–"ï¼‰

---

### 3.4 æµç¨‹å››ï¼šå…¥æ ¡ç­›æŸ¥ï¼ˆScreening Projectï¼‰

**åœºæ™¯ï¼š** æŸå°å­¦ä¸ºä¸€å¹´çº§å…¨ä½“å­¦ç”Ÿè¿›è¡Œå¿ƒç†å¥åº·ç­›æŸ¥

```text
1. ç®¡ç†å‘˜åˆ›å»º ScreeningProjectï¼š
   - Name: "2025 æ˜¥å­£ä¸€å¹´çº§å¿ƒç†å¥åº·ç­›æŸ¥"
   - SchoolID: æŸå°å­¦
   - GradeList: ["ä¸€å¹´çº§"]
   - MedicalScaleID: SCL-90
   - StartDate: 2025-03-01
   - EndDate: 2025-03-31
2. ç³»ç»Ÿç”Ÿæˆé¡¹ç›®äºŒç»´ç  QRCodeURL
3. ç­ä¸»ä»»å°†äºŒç»´ç åˆ†äº«åˆ°å®¶é•¿ç¾¤
4. å®¶é•¿æ‰«ç  â†’ è‡ªåŠ¨åˆ›å»º Testeeï¼ˆå¦‚ä¸å­˜åœ¨ï¼‰ + Assessmentï¼ˆOriginType=screeningï¼‰
5. å­¦ç”Ÿå¡«å†™é—®å· â†’ æäº¤ â†’ å¼‚æ­¥è¯„ä¼°ï¼ˆåŒæµç¨‹äºŒï¼‰
6. ç®¡ç†å‘˜æŸ¥çœ‹é¡¹ç›®ç»Ÿè®¡ï¼š
   - å‚ä¸ç‡ï¼šå·²å‚ä¸äººæ•° / åº”å‚ä¸äººæ•°
   - é£é™©åˆ†å¸ƒï¼šæ­£å¸¸ 60%ã€è¾¹ç¼˜ 30%ã€å¼‚å¸¸ 10%
   - å¼‚å¸¸åå•ï¼šæŒ‰ç­çº§åˆ—å‡ºé«˜å±å­¦ç”Ÿ
7. å¯¼å‡ºæŠ¥å‘Šæäº¤ç»™å­¦æ ¡/æ•™è‚²å±€
```

**å…³é”®ç‚¹ï¼š**

- æ‰¹é‡æµ‹è¯„ï¼ŒæŒ‰ç»„ç»‡å•ä½ç»Ÿè®¡
- é€šè¿‡ OriginType=screening æ ‡è¯†æ¥æº
- æ”¯æŒé¡¹ç›®çº§èšåˆç»Ÿè®¡

---

## 4. é—®å·æ¨¡å¼ vs é‡è¡¨æ¨¡å¼

### 4.1 æ¨¡å¼å¯¹æ¯”

| å¯¹æ¯”ç»´åº¦ | é—®å·æ¨¡å¼ï¼ˆSurvey Onlyï¼‰ | é‡è¡¨æ¨¡å¼ï¼ˆSurvey + Scaleï¼‰ |
|---------|----------------------|--------------------------|
| **æ ¸å¿ƒç›®çš„** | æ•°æ®æ”¶é›† | ä¸“ä¸šè¯„ä¼° |
| **MedicalScale** | âŒ ä¸ç»‘å®š | âœ… å¿…é¡»ç»‘å®š |
| **Assessment** | å¯é€‰åˆ›å»º | å¿…é¡»åˆ›å»º |
| **è¯„ä¼°å·¥ä½œæµ** | âŒ ä¸è§¦å‘ | âœ… è§¦å‘ |
| **InterpretReport** | âŒ ä¸ç”Ÿæˆ | âœ… ç”Ÿæˆ |
| **AssessmentScore** | âŒ ä¸è®°å½• | âœ… è®°å½•ï¼ˆä¾¿äºè¶‹åŠ¿åˆ†æï¼‰ |
| **é€‚ç”¨åœºæ™¯** | å®¢æˆ·æ»¡æ„åº¦ã€å¸‚åœºè°ƒç ”ã€ç”¨æˆ·åé¦ˆ | å¿ƒç†æµ‹è¯„ã€è¡Œä¸ºè¯„ä¼°ã€è®¤çŸ¥è¯„ä¼° |
| **æ•°æ®ä»·å€¼** | ç»Ÿè®¡åˆ†æï¼ˆé¢‘æ¬¡ã€åˆ†å¸ƒï¼‰ | ä¸´åºŠè¯Šæ–­ã€å¹²é¢„å†³ç­–ã€æ•ˆæœè¯„ä¼° |

### 4.2 æŠ€æœ¯å®ç°å·®å¼‚

#### é—®å·æ¨¡å¼

```go
// 1. åˆ›å»ºé—®å·
questionnaire := survey.NewQuestionnaire(title, questions)

// 2. ç”¨æˆ·å¡«å†™
answerSheet := survey.NewAnswerSheet(questionnaire.ID)
answerSheet.AddAnswerItem(questionID, value)
answerSheet.Submit() // ä»…æ ¡éªŒè¾“å…¥åˆæ³•æ€§

// 3. å¯¼å‡ºæ•°æ®åˆ†æï¼ˆä¸ç”ŸæˆæŠ¥å‘Šï¼‰
```

#### é‡è¡¨æ¨¡å¼

```go
// 1. é…ç½®é‡è¡¨
medicalScale := scale.NewMedicalScale(name, factors, interpretRules)

// 2. åˆ›å»ºé—®å·å¹¶ç»‘å®šé‡è¡¨
questionnaire := survey.NewQuestionnaire(title, questions)
questionnaire.BindScale(medicalScale.ID)

// 3. åˆ›å»ºæµ‹è¯„
assessment := assessment.NewAssessment(testeeID, questionnaire.ID, medicalScale.ID)

// 4. ç”¨æˆ·å¡«å†™
answerSheet := survey.NewAnswerSheet(questionnaire.ID)
answerSheet.AddAnswerItem(questionID, value)
answerSheet.Submit()

// 5. æäº¤æµ‹è¯„
assessment.Submit(answerSheet.ID)
eventBus.Publish(AssessmentSubmittedEvent{AssessmentID: assessment.ID})

// 6. å¼‚æ­¥è¯„ä¼°ï¼ˆqs-workerï¼‰
evaluator := scale.NewEvaluator(medicalScale)
scores := evaluator.Evaluate(answerSheet)
report := assessment.GenerateReport(scores, medicalScale.InterpretRules)
assessment.Interpret(report, scores)
eventBus.Publish(AssessmentInterpretedEvent{AssessmentID: assessment.ID})
```

### 4.3 æ¨¡å¼åˆ‡æ¢

**åŒä¸€ä»½é—®å·å¯åŒæ—¶æ”¯æŒä¸¤ç§æ¨¡å¼ï¼š**

- é—®å·æ¨¡å¼ï¼šMedicalScaleID = NULLï¼Œä¸åˆ›å»º Assessment
- é‡è¡¨æ¨¡å¼ï¼šMedicalScaleID â‰  NULLï¼Œåˆ›å»º Assessment å¹¶è§¦å‘è¯„ä¼°

**ç¤ºä¾‹ï¼š**

- é—®å· Aï¼ˆå®¢æˆ·æ»¡æ„åº¦è°ƒæŸ¥ï¼‰â†’ ä»…é—®å·æ¨¡å¼
- é—®å· Bï¼ˆSDS è‡ªè¯„é‡è¡¨ï¼‰â†’ ä»…é‡è¡¨æ¨¡å¼
- é—®å· Cï¼ˆç”¨æˆ·åŸºæœ¬ä¿¡æ¯ + å¿ƒç†è¯„ä¼°ï¼‰â†’ æ ¹æ® MedicalScaleID æ˜¯å¦ç»‘å®šï¼Œçµæ´»åˆ‡æ¢

---

## 5. è·¨ BC é›†æˆè®¾è®¡

### 5.1 ä¸ IAM BC çš„å…³ç³»

#### 5.1.1 èŒè´£åˆ’åˆ†

| BC | èŒè´£ | æ ¸å¿ƒèšåˆ |
|---|------|---------|
| **IAM BC** | ç»Ÿä¸€èº«ä»½è®¤è¯ã€æˆæƒã€ç»„ç»‡ç®¡ç† | User, Child, Org, Role, Permission |
| **é—®å·&é‡è¡¨ BC** | ä¸šåŠ¡é¢†åŸŸè§†å›¾ã€æµ‹è¯„ç›¸å…³å±æ€§ | Testee, Staff |

#### 5.1.2 é›†æˆæ–¹å¼

***ID æ˜ å°„***

```go
// IAM BC
type User struct {
    UserID   string
    Phone    string
    Password string
}

type Child struct {
    ChildID      string
    ParentUserID string
    Name         string
    Birthdate    time.Time
}

// é—®å·&é‡è¡¨ BC
type Testee struct {
    TesteeID    string       // æœ¬ BC çš„ä¸»é”®
    IAMUserID   *string      // å¯é€‰ï¼šæˆäººç”¨æˆ·
    IAMChildID  *string      // å¯é€‰ï¼šå„¿ç«¥ç”¨æˆ·
    OrgID       string       // ç»„ç»‡ IDï¼ˆå†—ä½™è‡ª IAMï¼‰
    Grade       string       // å¹´çº§ï¼ˆæœ¬ BC ç‰¹æœ‰ï¼‰
    Tags        []string     // æ ‡ç­¾ï¼ˆæœ¬ BC ç‰¹æœ‰ï¼‰
}
```

***è®¤è¯æµç¨‹***

```text
1. ç”¨æˆ·ç™»å½• â†’ IAM BC éªŒè¯ç”¨æˆ·åå¯†ç 
2. é¢å‘ JWT Tokenï¼ˆåŒ…å« UserIDã€OrgIDã€Roleï¼‰
3. ç”¨æˆ·è®¿é—®é—®å·&é‡è¡¨ BC æ¥å£ â†’ æºå¸¦ Token
4. é—®å·&é‡è¡¨ BC éªŒè¯ Tokenï¼ˆè°ƒç”¨ IAM BC æˆ–æœ¬åœ°è§£æï¼‰
5. æ ¹æ® IAM.UserID æŸ¥è¯¢ Testee è¡¨ â†’ è·å– TesteeID
6. æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼ˆåˆ›å»º Assessmentã€æŸ¥è¯¢æŠ¥å‘Šç­‰ï¼‰
```

***æˆæƒæµç¨‹***

```text
1. ç”¨æˆ·è¯·æ±‚æŸ¥çœ‹æŸæŠ¥å‘Š â†’ ReportID
2. æŸ¥è¯¢ InterpretReport â†’ è·å– AssessmentID
3. æŸ¥è¯¢ Assessment â†’ è·å– TesteeID
4. æ ¡éªŒï¼šTestee.IAMUserID == å½“å‰ç”¨æˆ·çš„ UserIDï¼Ÿ
5. é€šè¿‡ â†’ è¿”å›æŠ¥å‘Šï¼›å¦åˆ™ â†’ 403 Forbidden
```

#### 5.1.3 æ•°æ®åŒæ­¥ç­–ç•¥

| åœºæ™¯ | ç­–ç•¥ | è¯´æ˜ |
|-----|------|------|
| **åˆ›å»º Testee** | å»¶è¿Ÿåˆ›å»º | é¦–æ¬¡å‚ä¸æµ‹è¯„æ—¶åˆ›å»ºï¼Œè€Œé IAM æ³¨å†Œæ—¶åˆ›å»º |
| **åŒæ­¥ OrgID** | å†—ä½™å­˜å‚¨ | Testee è¡¨å†—ä½™ OrgIDï¼Œå‡å°‘è·¨ BC æŸ¥è¯¢ |
| **åŒæ­¥ User ä¿¡æ¯** | äº‹ä»¶é©±åŠ¨ | IAM BC å‘å¸ƒ UserUpdatedEventï¼Œé—®å·&é‡è¡¨ BC è®¢é˜…å¹¶æ›´æ–° Testee |
| **åˆ é™¤ User** | é€»è¾‘åˆ é™¤ | Testee ä¸ç‰©ç†åˆ é™¤ï¼Œé€šè¿‡ Status=deleted æ ‡è®° |

---

### 5.2 ä¸ä¸Šæ¸¸ BC çš„å…³ç³»

é—®å·&é‡è¡¨ BC ä½œä¸º**èƒ½åŠ›æä¾›æ–¹**ï¼Œä¸ºå¤šä¸ªä¸Šæ¸¸ BC æä¾›æµ‹è¯„æœåŠ¡ã€‚

#### 5.2.1 ä¸Šæ¸¸ BC æ¸…å•

| ä¸Šæ¸¸ BC | å…¸å‹åœºæ™¯ | é›†æˆæ–¹å¼ | æ¥æºæ ‡è¯† |
|---------|---------|---------|---------|
| **äº’è”ç½‘åŒ»é™¢ BC** | æ‚£è€…éšè®¿ã€æœ¯åè¯„ä¼° | gRPC / REST API | OriginType=plan + PlanID |
| **è¡Œä¸ºè®­ç»ƒä¸­å¿ƒ BC** | å­¦å‘˜è®­ç»ƒæ•ˆæœè¯„ä¼° | gRPC / REST API | OriginType=plan + PlanID |
| **å¥åº·ç®¡ç† BC** | æ…¢ç—…ç®¡ç†ã€å®šæœŸç­›æŸ¥ | gRPC / REST API | OriginType=plan + PlanID |
| **å­¦æ ¡ç®¡ç† BC** | å…¥å­¦ç­›æŸ¥ã€æœŸä¸­è¯„ä¼° | gRPC / REST API | OriginType=screening + ScreeningID |

#### 5.2.2 å…¸å‹é›†æˆæµç¨‹

***åœºæ™¯ï¼šäº’è”ç½‘åŒ»é™¢ä¸ºæ‚£è€…åˆ›å»ºéšè®¿è®¡åˆ’***

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ äº’è”ç½‘åŒ»é™¢ BC     â”‚                          â”‚ é—®å·&é‡è¡¨ BC      â”‚
â”‚ (Hospital BC)    â”‚                          â”‚ (QS BC)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                               â”‚
        â”‚ 1. åŒ»ç”Ÿå¼€å…·éšè®¿è®¡åˆ’                            â”‚
        â”‚    Doctor.CreateFollowUpPlan()              â”‚
        â”‚                                               â”‚
        â”‚ 2. è°ƒç”¨ QS BC åˆ›å»ºæµ‹è¯„è®¡åˆ’                     â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
        â”‚   gRPC: CreateAssessmentPlan                 â”‚
        â”‚   {                                           â”‚
        â”‚     testee_iam_id: "iam_user_123",          â”‚ 3. EnsureTestee
        â”‚     scale_id: "SDS",                        â”œâ”€â”€> æŸ¥è¯¢/åˆ›å»º Testee
        â”‚     frequency_type: "custom_weeks",         â”‚
        â”‚     frequency_value: [2,4,8,12],            â”‚ 4. åˆ›å»º Plan + ç”Ÿæˆ Task
        â”‚     start_date: "2025-03-01"                â”œâ”€â”€> AssessmentPlan
        â”‚   }                                           â”‚    AssessmentTask(4æ¡)
        â”‚                                               â”‚
        â”‚ 5. è¿”å›è®¡åˆ’ ID                                 â”‚
        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚   {plan_id: "plan_xxx"}                      â”‚
        â”‚                                               â”‚
        â”‚ 6. å­˜å‚¨ FollowUpPlan.QSPlanID                â”‚
        â”‚    FollowUpPlan {                            â”‚
        â”‚      ...                                      â”‚
        â”‚      qs_plan_id: "plan_xxx"                  â”‚
        â”‚    }                                          â”‚
        â”‚                                               â”‚
        â”‚ 7. å®šæ—¶æ£€æŸ¥è®¡åˆ’çŠ¶æ€                            â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
        â”‚   gRPC: GetAssessmentPlanStatus              â”‚
        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚   {                                           â”‚
        â”‚     completed_count: 2,                      â”‚
        â”‚     total_count: 4,                          â”‚
        â”‚     tasks: [...]                             â”‚
        â”‚   }                                           â”‚
        â”‚                                               â”‚
        â”‚ 8. è®¢é˜…æµ‹è¯„å®Œæˆäº‹ä»¶                            â”‚
        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚   Event: AssessmentInterpretedEvent          â”‚
        â”‚   {                                           â”‚
        â”‚     assessment_id: "xxx",                    â”‚
        â”‚     origin_type: "plan",                     â”‚
        â”‚     origin_id: "plan_xxx",                   â”‚
        â”‚     risk_level: "high"                       â”‚
        â”‚   }                                           â”‚
        â”‚                                               â”‚
        â”‚ 9. æ›´æ–°éšè®¿è®°å½• + è§¦å‘åŒ»ç”Ÿé¢„è­¦                  â”‚
        â”‚    FollowUpRecord.UpdateStatus()             â”‚
        â”‚    Notification.AlertDoctor()                â”‚
```

#### 5.2.3 æ¥å£è®¾è®¡ï¼ˆgRPCï¼‰

```protobuf
service AssessmentPlanService {
  // åˆ›å»ºæµ‹è¯„è®¡åˆ’
  rpc CreateAssessmentPlan(CreateAssessmentPlanRequest) returns (CreateAssessmentPlanResponse);
  
  // æŸ¥è¯¢è®¡åˆ’çŠ¶æ€
  rpc GetAssessmentPlanStatus(GetAssessmentPlanStatusRequest) returns (AssessmentPlanStatus);
  
  // å–æ¶ˆè®¡åˆ’
  rpc CancelAssessmentPlan(CancelAssessmentPlanRequest) returns (Empty);
}

message CreateAssessmentPlanRequest {
  string testee_iam_id = 1;         // IAM ç”¨æˆ· ID æˆ– Child ID
  string scale_id = 2;               // é‡è¡¨ ID
  string frequency_type = 3;         // "fixed_interval" | "custom_weeks"
  string frequency_value = 4;        // JSON: "7" æˆ– "[2,4,8,12]"
  string start_date = 5;             // ISO 8601
  optional string end_date = 6;      // å¯é€‰ï¼šç»“æŸæ—¥æœŸ
  string created_by_bc = 7;          // è°ƒç”¨æ–¹ BC åç§°ï¼ˆå¦‚ "hospital_bc"ï¼‰
  string external_ref_id = 8;        // å¤–éƒ¨ä¸šåŠ¡ IDï¼ˆå¦‚ FollowUpPlan.IDï¼‰
}

message CreateAssessmentPlanResponse {
  string plan_id = 1;
  repeated AssessmentTask tasks = 2; // ç”Ÿæˆçš„ä»»åŠ¡åˆ—è¡¨
}

message AssessmentPlanStatus {
  string plan_id = 1;
  string status = 2;                 // "active" | "completed" | "canceled"
  int32 completed_count = 3;
  int32 total_count = 4;
  repeated AssessmentTask tasks = 5;
}

message AssessmentTask {
  string task_id = 1;
  string scheduled_at = 2;
  string status = 3;                 // "pending" | "completed" | "expired"
  optional string assessment_id = 4; // å·²å®Œæˆæ—¶æœ‰å€¼
  optional string entry_url = 5;     // æµ‹è¯„å…¥å£ URL
}
```

#### 5.2.4 å¹‚ç­‰æ€§ä¿è¯

***EnsureTestee å¹‚ç­‰åˆ›å»º***

```go
// åº”ç”¨æœåŠ¡æ¥å£
func (svc *TesteeAppService) EnsureTestee(ctx context.Context, req EnsureTesteeRequest) (TesteeID, error) {
    // 1. æ ¹æ® IAM ID æŸ¥è¯¢
    testee, err := svc.testeeRepo.FindByIAMID(ctx, req.IAMUserID, req.IAMChildID)
    if err == nil {
        // å·²å­˜åœ¨ï¼Œç›´æ¥è¿”å›
        return testee.ID, nil
    }
    
    // 2. ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–° Testee
    testee = user.NewTestee(
        iamUserID:  req.IAMUserID,
        iamChildID: req.IAMChildID,
        orgID:      req.OrgID,
        grade:      req.Grade,
        tags:       req.Tags,
        source:     req.Source,  // "hospital" | "training_center" | "screening"
    )
    
    // 3. ä¿å­˜ï¼ˆæ•°æ®åº“å”¯ä¸€çº¦æŸï¼šiam_user_id + iam_child_id + org_idï¼‰
    err = svc.testeeRepo.Save(ctx, testee)
    if errors.Is(err, ErrDuplicateKey) {
        // å¹¶å‘åˆ›å»ºï¼Œé‡æ–°æŸ¥è¯¢
        testee, _ = svc.testeeRepo.FindByIAMID(ctx, req.IAMUserID, req.IAMChildID)
    }
    
    return testee.ID, nil
}
```

***CreateAssessmentPlan å¹‚ç­‰æ€§***

```go
// åº”ç”¨æœåŠ¡å®ç°
func (svc *PlanAppService) CreateAssessmentPlan(ctx context.Context, req CreatePlanRequest) (*Plan, error) {
    // 1. æ£€æŸ¥å¹‚ç­‰é”®ï¼ˆå¤–éƒ¨ä¸šåŠ¡ IDï¼‰
    if req.ExternalRefID != "" {
        plan, err := svc.planRepo.FindByExternalRef(ctx, req.CreatedByBC, req.ExternalRefID)
        if err == nil {
            // å·²åˆ›å»ºè¿‡ï¼Œç›´æ¥è¿”å›
            return plan, nil
        }
    }
    
    // 2. EnsureTesteeï¼ˆå¹‚ç­‰ï¼‰
    testeeID, err := svc.testeeAppSvc.EnsureTestee(ctx, EnsureTesteeRequest{
        IAMUserID:  req.TesteeIAMID,
        IAMChildID: req.TesteeIAMChildID,
        OrgID:      req.OrgID,
    })
    if err != nil {
        return nil, err
    }
    
    // 3. åˆ›å»ºè®¡åˆ’
    plan := plan.NewAssessmentPlan(...)
    err = svc.planRepo.Save(ctx, plan)
    
    // 4. ç”Ÿæˆä»»åŠ¡
    tasks := plan.GenerateTasks()
    for _, task := range tasks {
        svc.taskRepo.Save(ctx, task)
    }
    
    return plan, nil
}
```

#### 5.2.5 é¢†åŸŸäº‹ä»¶è®¢é˜…

***ä¸Šæ¸¸ BC è®¢é˜…å…³é”®äº‹ä»¶***

```go
// äº’è”ç½‘åŒ»é™¢ BC çš„äº‹ä»¶æ¶ˆè´¹è€…
type AssessmentEventConsumer struct {
    followUpSvc *FollowUpService
}

func (c *AssessmentEventConsumer) HandleAssessmentInterpreted(ctx context.Context, event AssessmentInterpretedEvent) error {
    // 1. æ ¹æ® OriginType è¿‡æ»¤
    if event.OriginType != "plan" {
        return nil
    }
    
    // 2. æŸ¥è¯¢æœ¬ BC çš„éšè®¿è®°å½•
    followUp, err := c.followUpSvc.FindByQSPlanID(ctx, event.OriginID)
    if err != nil {
        return err
    }
    
    // 3. æ›´æ–°éšè®¿è®°å½•
    followUp.MarkTaskCompleted(event.AssessmentID, event.TotalScore, event.RiskLevel)
    
    // 4. é«˜é£é™©é¢„è­¦
    if event.RiskLevel == "high" {
        c.followUpSvc.AlertDoctor(ctx, followUp.DoctorID, followUp.PatientID)
    }
    
    return nil
}
```

---

## 6. æ•°æ®å­˜å‚¨ç­–ç•¥

### 6.1 å­˜å‚¨é€‰å‹

| èšåˆ | å­˜å‚¨å¼•æ“ | åŸå›  |
|-----|---------|------|
| `Questionnaire` | MongoDB | æ–‡æ¡£å‹ï¼Œæ”¯æŒå¤æ‚åµŒå¥—ç»“æ„ä¸ç‰ˆæœ¬æ¼”è¿› |
| `AnswerSheet` | MongoDB | æ–‡æ¡£å‹ï¼Œç­”æ¡ˆç»“æ„ä¸å›ºå®š |
| `MedicalScale` | MySQL | ç»“æ„åŒ–ï¼Œé¢‘ç¹æŸ¥è¯¢ï¼Œæ”¯æŒäº‹åŠ¡ |
| `Assessment` | MySQL | ç»“æ„åŒ–ï¼Œé¢‘ç¹æŸ¥è¯¢ï¼Œæ”¯æŒäº‹åŠ¡ |
| `AssessmentScore` | MySQL | ç»“æ„åŒ–ï¼Œä¾¿äºè¶‹åŠ¿åˆ†æä¸ JOIN æŸ¥è¯¢ |
| `InterpretReport` | MongoDB | æ–‡æ¡£å‹ï¼Œæ”¯æŒå¯Œæ–‡æœ¬ã€å›¾è¡¨ã€å†å²å¯¹æ¯” |
| `Testee` / `Staff` | MySQL | ç»“æ„åŒ–ï¼Œé¢‘ç¹æŸ¥è¯¢ |
| `AssessmentPlan` / `AssessmentTask` | MySQL | ç»“æ„åŒ–ï¼Œæ”¯æŒäº‹åŠ¡ |
| `ScreeningProject` | MySQL | ç»“æ„åŒ–ï¼Œæ”¯æŒäº‹åŠ¡ |

### 6.2 è¯»å†™åˆ†ç¦»ç­–ç•¥

| åœºæ™¯ | è¯»åº“ | å†™åº“ | è¯´æ˜ |
|-----|------|------|------|
| **æäº¤æµ‹è¯„** | MySQL | MySQL | å†™å…¥ Assessment, AssessmentScore |
| **æŸ¥è¯¢æŠ¥å‘Š** | MongoDB | - | è¯»å– InterpretReport |
| **ç»Ÿè®¡åˆ†æ** | MySQL | - | æŒ‰äººã€æŒ‰æ—¶é—´ã€æŒ‰é¡¹ç›®èšåˆ |
| **å¯¼å‡ºç­”å·** | MongoDB | - | è¯»å– AnswerSheet |

### 6.3 ç¼“å­˜ç­–ç•¥

| æ•°æ®ç±»å‹ | ç¼“å­˜å±‚ | TTL | è¯´æ˜ |
|---------|--------|-----|------|
| `MedicalScale` | Redis | 1 å°æ—¶ | é‡è¡¨å®šä¹‰å˜æ›´é¢‘ç‡ä½ |
| `Questionnaire` | Redis | 30 åˆ†é’Ÿ | é—®å·æ¨¡æ¿å˜æ›´é¢‘ç‡ä½ |
| `Assessment.Status` | Redis | 5 åˆ†é’Ÿ | é«˜å¹¶å‘åœºæ™¯ä¸‹çš„çŠ¶æ€è½®è¯¢ |
| `InterpretReport` | Redis | 10 åˆ†é’Ÿ | æŠ¥å‘Šå†…å®¹ä¸å˜ï¼Œé«˜é¢‘æŸ¥è¯¢ |

---

## 7. é¢†åŸŸäº‹ä»¶

### 7.1 äº‹ä»¶æ¸…å•

| äº‹ä»¶åç§° | å‘å¸ƒæ–¹ | è®¢é˜…æ–¹ | è¯´æ˜ |
|---------|-------|-------|------|
| `AssessmentSubmittedEvent` | assessment å­åŸŸ | qs-worker | è§¦å‘å¼‚æ­¥è¯„ä¼°å·¥ä½œæµ |
| `AssessmentInterpretedEvent` | assessment å­åŸŸ | é€šçŸ¥æ¨¡å—ã€ç»Ÿè®¡æ¨¡å— | æµ‹è¯„å®Œæˆï¼Œæ¨é€ç»“æœ |
| `AssessmentFailedEvent` | assessment å­åŸŸ | é€šçŸ¥æ¨¡å— | è¯„ä¼°å¤±è´¥ï¼Œäººå·¥ä»‹å…¥ |
| `TesteeCreatedEvent` | user å­åŸŸ | ç»Ÿè®¡æ¨¡å— | æ–°ç”¨æˆ·åˆ›å»ºï¼Œæ›´æ–°ç»Ÿè®¡ |
| `ScreeningProjectCompletedEvent` | screening å­åŸŸ | é€šçŸ¥æ¨¡å— | ç­›æŸ¥é¡¹ç›®ç»“æŸï¼Œç”ŸæˆæŠ¥å‘Š |

### 7.2 äº‹ä»¶é©±åŠ¨æµç¨‹ç¤ºä¾‹

```text
Assessment.Submit()
   â†“ publish
AssessmentSubmittedEvent {AssessmentID, TesteeID, MedicalScaleID}
   â†“ MQ (NSQ / Redis)
qs-worker.Consume()
   â†“ evaluate
scale.Evaluator.Evaluate()
   â†“ generate report
Assessment.Interpret()
   â†“ publish
AssessmentInterpretedEvent {AssessmentID, TotalScore, RiskLevel}
   â†“ subscribe
NotificationService.SendSMS() / PushService.Send()
```

---

## 8. AnswerSheet ä¸ Assessment çš„èŒè´£è¾¹ç•Œ

### 8.1 ä¸ºä»€ä¹ˆåˆ†ç¦»ï¼Ÿ

***æ¶æ„åŸåˆ™ï¼šå†…å®¹å­˜å‚¨å±‚ vs ä¸šåŠ¡ç¼–æ’å±‚***

- **AnswerSheetï¼ˆå†…å®¹å­˜å‚¨å±‚ï¼‰**ï¼šåªå…³å¿ƒ"ç­”äº†ä»€ä¹ˆé¢˜ã€ç­”æ¡ˆæ˜¯ä»€ä¹ˆ"ï¼Œæ˜¯çº¯ç²¹çš„æ•°æ®å®¹å™¨
- **Assessmentï¼ˆä¸šåŠ¡ç¼–æ’å±‚ï¼‰**ï¼šå…³å¿ƒ"è¿™æ¬¡æµ‹è¯„ä»å“ªæ¥ã€ä¸ºä»€ä¹ˆåšã€åšç»™è°çœ‹"ï¼Œæ˜¯ä¸šåŠ¡ä¸Šä¸‹æ–‡çš„è½½ä½“

**åæ¨¡å¼è­¦å‘Šï¼š**

âŒ **ä¸è¦åœ¨ AnswerSheet ä¸Šå †ä¸šåŠ¡å­—æ®µ**ï¼šScenarioã€PlanIDã€ScreeningID ç­‰ä¸šåŠ¡æ¥æºå­—æ®µä¼šæ±¡æŸ“å†…å®¹å­˜å‚¨å±‚

âŒ **ä¸è¦è®© AnswerSheet æ‰¿æ‹…ç»Ÿè®¡èŒè´£**ï¼šæŒ‰é¡¹ç›®ç»Ÿè®¡ã€æŒ‰è®¡åˆ’åˆ†æåº”é€šè¿‡ Assessment ç»´åº¦è¿›è¡Œ

âœ… **æ­£ç¡®åšæ³•**ï¼šä¸šåŠ¡æ¥æºå­—æ®µå…¨éƒ¨ç”± Assessment ç®¡ç†ï¼ŒAnswerSheet é€šè¿‡ AssessmentID å…³è”

### 8.2 èŒè´£å¯¹æ¯”

| ç»´åº¦ | AnswerSheetï¼ˆMongoï¼‰ | Assessmentï¼ˆMySQLï¼‰ |
|-----|---------------------|-------------------|
| **æ ¸å¿ƒèŒè´£** | å­˜å‚¨ç­”é¢˜å†…å®¹ | ç®¡ç†æµ‹è¯„ç”Ÿå‘½å‘¨æœŸ |
| **å­˜å‚¨å†…å®¹** | é¢˜ç›®å¿«ç…§ + ç­”æ¡ˆ + å¾—åˆ† | æ¥æº + çŠ¶æ€ + å…³è” + ç»“æœ |
| **ä¸šåŠ¡æ¥æº** | âŒ ä¸å…³å¿ƒ | âœ… OriginType + PlanID/ScreeningID |
| **çŠ¶æ€ç®¡ç†** | draft/submittedï¼ˆå¡«å†™çŠ¶æ€ï¼‰ | pending/submitted/interpretedï¼ˆä¸šåŠ¡çŠ¶æ€ï¼‰ |
| **ç»Ÿè®¡ç»´åº¦** | âŒ ä¸å‚ä¸ | âœ… ä¸»å…¥å£ï¼ˆæŒ‰äºº/æŒ‰é¡¹ç›®/æŒ‰æ—¶é—´ï¼‰ |
| **æŸ¥è¯¢åœºæ™¯** | å¯¼å‡ºç­”å·ã€æŸ¥çœ‹å†å²ç­”æ¡ˆ | æµ‹è¯„åˆ—è¡¨ã€å®Œæˆç‡ã€é£é™©åˆ†å¸ƒ |
| **æ•°æ®ç»“æ„** | åµŒå¥—æ–‡æ¡£ï¼ˆçµæ´»ï¼‰ | å…³ç³»è¡¨ï¼ˆè§„èŒƒï¼‰ |

### 8.3 å…³è”å…³ç³»

```text
Assessment (MySQL)
   â†“ answer_sheet_id
AnswerSheet (MongoDB)

å…³ç³»ï¼š1:0..1
- Assessment åˆ›å»ºæ—¶ï¼šanswer_sheet_id = NULLï¼ˆç­‰å¾…å¡«å†™ï¼‰
- ç”¨æˆ·æäº¤åï¼šanswer_sheet_id = {Mongo ObjectID}
```

**å…³é”®çº¦æŸï¼š**

1. **å•å‘ä¾èµ–**ï¼šAssessment â†’ AnswerSheetï¼Œåå‘ä¸ä¾èµ–
2. **å»¶è¿Ÿå…³è”**ï¼šAnswerSheet åœ¨æäº¤æ—¶æ‰å…³è”åˆ° Assessment
3. **å¹‚ç­‰åˆ›å»º**ï¼šåŒä¸€ä¸ª Assessment åªèƒ½å…³è”ä¸€ä¸ª AnswerSheet

### 8.4 å…¸å‹åœºæ™¯ç¤ºä¾‹

#### åœºæ™¯ä¸€ï¼šéšè®¿è®¡åˆ’è§¦å‘æµ‹è¯„

```go
// 1. åˆ›å»º Assessmentï¼ˆä¸šåŠ¡ç¼–æ’å±‚ï¼‰
assessment := assessment.NewAssessment(
    testeeID:    testeeID,
    scaleID:     scaleID,
    originType:  assessment.OriginPlan,   // æ¥è‡ªè®¡åˆ’
    planID:      planID,                  // å…³è”è®¡åˆ’ ID
)
assessmentRepo.Save(ctx, assessment)

// 2. ç”¨æˆ·å¡«å†™é—®å·ï¼ˆå†…å®¹å­˜å‚¨å±‚ï¼‰
answerSheet := survey.NewAnswerSheet(
    questionnaireID: qID,
    testeeRef:       testeeRef,
    fillerRef:       fillerRef,
)
answerSheetRepo.Save(ctx, answerSheet)

// 3. æäº¤åå»ºç«‹å…³è”
assessment.Submit(answerSheet.ID)
assessmentRepo.Save(ctx, assessment)

// 4. ç»Ÿè®¡è®¡åˆ’å®Œæˆç‡ï¼ˆé€šè¿‡ Assessmentï¼‰
SELECT COUNT(*) FROM assessments
WHERE origin_type = 'plan' AND plan_id = ? AND status = 'interpreted';
```

#### åœºæ™¯äºŒï¼šç­›æŸ¥é¡¹ç›®ç»Ÿè®¡

```go
// æŸ¥è¯¢é¡¹ç›®é£é™©åˆ†å¸ƒï¼ˆé€šè¿‡ Assessmentï¼Œä¸æŸ¥ Mongoï¼‰
SELECT risk_level, COUNT(*) AS count
FROM assessments
WHERE origin_type = 'screening' AND screening_id = ?
GROUP BY risk_level;

// å¯¼å‡ºæŸä¸ªå­¦ç”Ÿçš„ç­”å·å†…å®¹ï¼ˆæ‰æŸ¥ Mongoï¼‰
answerSheet := answerSheetRepo.FindByID(ctx, answerSheetID)
return answerSheet.AnswerItems // è¿”å›é¢˜ç›®ç­”æ¡ˆè¯¦æƒ…
```

### 8.5 è®¾è®¡æ”¶ç›Š

| æ”¶ç›Š | è¯´æ˜ |
|-----|------|
| **èŒè´£æ¸…æ™°** | AnswerSheet ä¸“æ³¨å†…å®¹ï¼ŒAssessment ä¸“æ³¨ä¸šåŠ¡ï¼Œè¾¹ç•Œæ˜ç¡® |
| **å­˜å‚¨ä¼˜åŒ–** | MySQL é€‚åˆç»Ÿè®¡æŸ¥è¯¢ï¼ŒMongo é€‚åˆæ–‡æ¡£å­˜å‚¨ï¼Œå„å–æ‰€é•¿ |
| **æ‰©å±•çµæ´»** | æ–°å¢ä¸šåŠ¡åœºæ™¯ï¼ˆå¦‚"åŸ¹è®­æµ‹è¯„"ï¼‰åªéœ€æ‰©å±• Assessment.OriginType |
| **æŸ¥è¯¢é«˜æ•ˆ** | ç»Ÿè®¡ç±»æŸ¥è¯¢ä¸éœ€è¦æ‰«æ Mongoï¼Œç›´æ¥åœ¨ MySQL èšåˆ |
| **å†å²å…¼å®¹** | AnswerSheet ç»“æ„ç¨³å®šï¼Œä¸šåŠ¡æ¼”è¿›åªå½±å“ Assessment |

---

## 9. æ€»ç»“ä¸åç»­æ–‡æ¡£

### 9.1 æ ¸å¿ƒè®¾è®¡äº®ç‚¹

1. **èŒè´£åˆ†ç¦»**ï¼šsurveyï¼ˆæ•°æ®æ”¶é›†ï¼‰ã€scaleï¼ˆä¸“ä¸šè§£è¯»ï¼‰ã€assessmentï¼ˆç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼‰ä¸‰å±‚åˆ†ç¦»ï¼Œå„å¸å…¶èŒ
2. **èšåˆè‡ªæ²»**ï¼šæ¯ä¸ªèšåˆç‹¬ç«‹å°è£…ä¸šåŠ¡ä¸å˜æ€§ï¼Œé€šè¿‡é¢†åŸŸäº‹ä»¶æ¾è€¦åˆåä½œ
3. **ä¾èµ–å•å‘**ï¼šä¸¥æ ¼æ§åˆ¶å­åŸŸä¾èµ–æ–¹å‘ï¼Œé¿å…å¾ªç¯ä¾èµ–
4. **æ¨¡å¼çµæ´»**ï¼šåŒä¸€å¥—æ¨¡å‹æ”¯æŒé—®å·æ¨¡å¼ä¸é‡è¡¨æ¨¡å¼ï¼Œé™ä½ç³»ç»Ÿå¤æ‚åº¦
5. **æ¡¥æ¥æ¨¡å¼**ï¼šAssessment ä½œä¸ºæ¡¥æ¥èšåˆï¼Œè¿æ¥å„å­åŸŸï¼Œä½œä¸ºç»Ÿè®¡åˆ†æçš„é”šç‚¹
6. **äº‹ä»¶é©±åŠ¨**ï¼šé€šè¿‡é¢†åŸŸäº‹ä»¶é©±åŠ¨å¼‚æ­¥è¯„ä¼°ã€æ¶ˆæ¯æ¨é€ã€ç»Ÿè®¡æ›´æ–°ï¼Œæå‡ç³»ç»Ÿè§£è€¦ä¸æ€§èƒ½
7. **å†…å®¹ä¸ä¸šåŠ¡åˆ†ç¦»**ï¼šAnswerSheet å­˜å‚¨å†…å®¹ï¼ŒAssessment ç®¡ç†ä¸šåŠ¡ï¼Œå­˜å‚¨ä¸ç»Ÿè®¡å„å–æ‰€é•¿

### 9.2 åç»­æ–‡æ¡£

| æ–‡æ¡£ç¼–å· | æ–‡æ¡£åç§° | è¯´æ˜ |
|---------|---------|------|
| **11-02** | qs-apiserver é¢†åŸŸå±‚ä»£ç ç»“æ„è®¾è®¡ | æœ¬æ¨¡å‹çš„ä»£ç æ˜ å°„ï¼Œç›®å½•ç»“æ„ã€èšåˆå®ç°ã€Repository æ¥å£ |
| **11-03** | Testeeå’ŒStaffç”¨æˆ·æ¨¡å‹è®¾è®¡ | user å­åŸŸçš„è¯¦ç»†è®¾è®¡ï¼Œä¸ IAM BC çš„é›†æˆæ–¹æ¡ˆ |
| **12-01** | æ ¡éªŒè§„åˆ™è®¾è®¡ï¼ˆç­–ç•¥æ¨¡å¼ï¼‰ | survey å­åŸŸçš„æ ¡éªŒç­–ç•¥ï¼ŒQuestionRule æ¥å£ä¸å®ç° |
| **12-02** | è®¡åˆ†ä¸è§£è¯»è§„åˆ™è®¾è®¡ï¼ˆç­–ç•¥+èŒè´£é“¾ï¼‰ | scale å­åŸŸçš„è¯„ä¼°ç­–ç•¥ï¼ŒEvaluator æ¥å£ä¸èŒè´£é“¾å®ç° |
| **12-03** | è¯„ä¼°å·¥ä½œæµä¸qs-workerè®¾è®¡ | assessment å­åŸŸçš„å·¥ä½œæµï¼ŒMQ æ¶ˆè´¹ã€é‡è¯•ã€å¹‚ç­‰æ€§è®¾è®¡ |
| **12-04** | é«˜å¹¶å‘åœºæ™¯ä¸æŸ¥è¯¢ç­–ç•¥è®¾è®¡ | æ€§èƒ½ä¼˜åŒ–ï¼Œç¼“å­˜ç­–ç•¥ã€è¯»å†™åˆ†ç¦»ã€çŸ­è½®è¯¢ä¼˜åŒ– |
| **12-05** | æµ‹è¯„è®¡åˆ’ä¸å…¥æ ¡ç­›æŸ¥å»ºæ¨¡ | plan/screening å­åŸŸè¯¦ç»†è®¾è®¡ï¼Œä»»åŠ¡ç”Ÿæˆã€ç»Ÿè®¡åˆ†æ |

### 9.3 å®æ–½è·¯å¾„

1. âœ… **é˜¶æ®µä¸€ï¼šæ ¸å¿ƒé¢†åŸŸå»ºæ¨¡**ï¼ˆå½“å‰æ–‡æ¡£ï¼‰
   - ç¡®å®š BC è¾¹ç•Œä¸å­åŸŸåˆ’åˆ†
   - å®šä¹‰æ ¸å¿ƒèšåˆä¸ä¾èµ–å…³ç³»
   - æ˜ç¡®é—®å·æ¨¡å¼ä¸é‡è¡¨æ¨¡å¼çš„å·®å¼‚

2. â³ **é˜¶æ®µäºŒï¼šä»£ç ç»“æ„è®¾è®¡**ï¼ˆ11-02 æ–‡æ¡£ï¼‰
   - è®¾è®¡ internal/domain ç›®å½•ç»“æ„
   - å®šä¹‰èšåˆæ ¹ã€å®ä½“ã€å€¼å¯¹è±¡çš„ Go ä»£ç 
   - è®¾è®¡ Repository æ¥å£ä¸é¢†åŸŸäº‹ä»¶

3. â³ **é˜¶æ®µä¸‰ï¼šè¯¦ç»†è®¾è®¡æ–‡æ¡£**ï¼ˆ12-01 è‡³ 12-05ï¼‰
   - æ ¡éªŒè§„åˆ™çš„ç­–ç•¥æ¨¡å¼å®ç°
   - è¯„åˆ†ä¸è§£è¯»çš„èŒè´£é“¾å®ç°
   - è¯„ä¼°å·¥ä½œæµçš„ MQ æ¶ˆè´¹é€»è¾‘
   - é«˜å¹¶å‘åœºæ™¯çš„ä¼˜åŒ–ç­–ç•¥
   - è®¡åˆ’ä¸ç­›æŸ¥çš„è¯¦ç»†å»ºæ¨¡

4. â³ **é˜¶æ®µå››ï¼šä»£ç å®ç°ä¸æµ‹è¯•**
   - æŒ‰å­åŸŸé€æ­¥å®ç°é¢†åŸŸå±‚ä»£ç 
   - ç¼–å†™å•å…ƒæµ‹è¯•ä¸é›†æˆæµ‹è¯•
   - éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒéªŒè¯

---

## 10. æœ¯è¯­è¡¨ä¸æ¦‚å¿µç»Ÿä¸€

### 10.1 æ ¸å¿ƒæœ¯è¯­å¯¹ç…§

| ä¸­æ–‡æœ¯è¯­ | è‹±æ–‡æœ¯è¯­ | å®šä¹‰ | æ‰€å±å±‚æ¬¡ |
|---------|---------|------|---------|
| **å—è¯•è€…** | Testee | æ¥å—æµ‹è¯„çš„äººï¼ˆæˆäºº/å„¿ç«¥ï¼‰ï¼Œæœ¬ BC çš„é¢†åŸŸå®ä½“ | èšåˆæ ¹ |
| **åå°äººå‘˜** | Staff | æ“ä½œåå°ç³»ç»Ÿçš„å·¥ä½œäººå‘˜ï¼ˆåŒ»ç”Ÿ/è€å¸ˆ/è¿è¥ï¼‰ï¼Œæœ¬ BC çš„é¢†åŸŸå®ä½“ | èšåˆæ ¹ |
| **å¡«å†™äºº** | Filler | å®é™…æ“ä½œå¡«å†™é—®å·çš„äººï¼ˆå¯èƒ½æ˜¯å—è¯•è€…æœ¬äººã€å®¶é•¿ã€å·¥ä½œäººå‘˜ï¼‰ | è¡Œä¸ºè§’è‰² |
| **å¡«å†™äººå¼•ç”¨** | FillerRef | è®°å½•å¡«å†™åŠ¨ä½œæ‰§è¡Œè€…çš„å€¼å¯¹è±¡ | å€¼å¯¹è±¡ |
| **IAM ç”¨æˆ·** | IAM.User | IAM BC ä¸­çš„ç”¨æˆ·å®ä½“ï¼Œè´Ÿè´£è®¤è¯ä¸æˆæƒ | å¤–éƒ¨ BC èšåˆ |
| **IAM å­å¥³** | IAM.Child | IAM BC ä¸­çš„å­å¥³å®ä½“ï¼Œå®¶é•¿è´¦å·ä¸‹çš„å„¿ç«¥ | å¤–éƒ¨ BC èšåˆ |
| **å½“å‰è¯·æ±‚ç”¨æˆ·** | Principal | å½“å‰ HTTP è¯·æ±‚çš„è®¤è¯ç”¨æˆ·ä¿¡æ¯ï¼ˆå« UserIDã€Roleã€OrgIDï¼‰ | ä¸Šä¸‹æ–‡å¯¹è±¡ |
| **é—®å·** | Questionnaire | é—®é¢˜é›†åˆçš„æ¨¡æ¿å®šä¹‰ | èšåˆæ ¹ |
| **ç­”å·** | AnswerSheet | ä¸€æ¬¡å¡«å†™è¡Œä¸ºçš„ç­”æ¡ˆå†…å®¹ | èšåˆæ ¹ |
| **é‡è¡¨** | MedicalScale | ä¸“ä¸šé‡è¡¨çš„è¯„åˆ†ä¸è§£è¯»è§„åˆ™ | èšåˆæ ¹ |
| **æµ‹è¯„æ¡ˆä¾‹** | Assessment | ä¸€æ¬¡æµ‹è¯„è¡Œä¸ºçš„ä¸šåŠ¡å®ä¾‹ï¼Œè¿æ¥å„å­åŸŸ | èšåˆæ ¹ |
| **æµ‹è¯„è®¡åˆ’** | AssessmentPlan | å‘¨æœŸæ€§æµ‹è¯„çš„é…ç½®ä¸è°ƒåº¦ | èšåˆæ ¹ |
| **ç­›æŸ¥é¡¹ç›®** | ScreeningProject | æ‰¹é‡ç­›æŸ¥æ´»åŠ¨çš„é…ç½®ä¸ç»Ÿè®¡ | èšåˆæ ¹ |

### 10.2 åºŸå¼ƒæœ¯è¯­è­¦å‘Š

**âŒ ä»¥ä¸‹æœ¯è¯­ä¸åº”å‡ºç°åœ¨ä»£ç ä¸æ–‡æ¡£ä¸­ï¼š**

| åºŸå¼ƒæœ¯è¯­ | åŸå›  | æ›¿ä»£æ–¹æ¡ˆ |
|---------|------|---------|
| **Writer** | å«ä¹‰æ¨¡ç³Šï¼Œä¸æ˜ç¡®æ˜¯"åˆ›å»ºé—®å·çš„äºº"è¿˜æ˜¯"å¡«å†™é—®å·çš„äºº" | ä½¿ç”¨ **Filler**ï¼ˆå¡«å†™äººï¼‰æˆ– **FillerRef**ï¼ˆå¡«å†™äººå¼•ç”¨ï¼‰ |
| **Viewer** | ä¸æ˜¯å®ä½“ï¼Œæ˜¯è®¿é—®æ§åˆ¶çš„è¿è¡Œæ—¶æ¦‚å¿µ | é€šè¿‡ **CanViewAnswerSheet(Principal, AnswerSheet)** ç­‰ç­–ç•¥å‡½æ•°åˆ¤æ–­ |
| **User**ï¼ˆæ— å‰ç¼€ï¼‰ | ä¸æ˜ç¡®æŒ‡ä»£ IAM.User è¿˜æ˜¯ Testee è¿˜æ˜¯ Staff | å§‹ç»ˆä½¿ç”¨å®Œæ•´å‰ç¼€ï¼š**IAM.User**ã€**Testee**ã€**Staff** |
| **ç­”é¢˜äºº** | ä¸"å—è¯•è€…"å’Œ"å¡«å†™äºº"æ··æ·† | ä½¿ç”¨ **Testee**ï¼ˆå—è¯•è€…ï¼‰+ **Filler**ï¼ˆå¡«å†™äººï¼‰ |

### 10.3 å‘½åè§„èŒƒ

#### 10.3.1 èšåˆæ ¹ä¸å®ä½“å‘½å

```go
// âœ… æ­£ç¡®ï¼šä½¿ç”¨å®Œæ•´çš„é¢†åŸŸæœ¯è¯­
type Testee struct { ... }
type Staff struct { ... }
type AssessmentPlan struct { ... }
type ScreeningProject struct { ... }

// âŒ é”™è¯¯ï¼šç¼©å†™æˆ–æ¨¡ç³Šæœ¯è¯­
type User struct { ... }       // åº”æŒ‡æ˜æ˜¯ IAM.User è¿˜æ˜¯ Testee
type Writer struct { ... }     // åº”æ”¹ä¸º Filler
type Plan struct { ... }       // åº”æ”¹ä¸º AssessmentPlan
```

#### 10.3.2 å€¼å¯¹è±¡å‘½å

```go
// âœ… æ­£ç¡®ï¼šRef åç¼€è¡¨ç¤ºå¼•ç”¨ï¼ŒType åç¼€è¡¨ç¤ºæšä¸¾
type TesteeRef struct { ... }
type FillerRef struct { ... }
type FillerType string

// âŒ é”™è¯¯ï¼šä¸æ˜ç¡®çš„å‘½å
type TesteeInfo struct { ... }  // ä¸æ¸…æ¥šæ˜¯å¿«ç…§è¿˜æ˜¯å®Œæ•´å¯¹è±¡
type WriterType string          // åº”æ”¹ä¸º FillerType
```

#### 10.3.3 å‡½æ•°å‘½å

```go
// âœ… æ­£ç¡®ï¼šåŠ¨è¯å¼€å¤´ï¼Œæ˜ç¡®æ“ä½œå¯¹è±¡
func (svc *TesteeAppService) EnsureTestee(ctx context.Context, req EnsureTesteeRequest) (TesteeID, error)
func CanViewAnswerSheet(principal Principal, sheet *AnswerSheet) bool

// âŒ é”™è¯¯ï¼šä¸æ˜ç¡®çš„å‘½å
func (svc *UserService) GetOrCreate(req CreateUserRequest) (*User, error)  // User æ˜¯å“ªä¸ª Userï¼Ÿ
func CheckPermission(userID int64, sheetID string) bool                   // å‚æ•°ç±»å‹ä¸æ˜ç¡®
```

### 10.4 è·¨æ–‡æ¡£æœ¯è¯­ä¸€è‡´æ€§æ£€æŸ¥è¡¨

| æ£€æŸ¥é¡¹ | è§„èŒƒ | ç¤ºä¾‹ |
|-------|------|------|
| **Testee vs User** | æœ¬ BC ç»Ÿä¸€ä½¿ç”¨ Testeeï¼Œæ¶‰åŠ IAM æ—¶ç”¨ IAM.User | âœ… Testee.IAMUserID<br>âŒ User.ID |
| **Filler vs Writer** | ç»Ÿä¸€ä½¿ç”¨ Filler/FillerRef | âœ… FillerRef.FillerType<br>âŒ Writer.Role |
| **Assessment vs Evaluation** | Assessment æ˜¯æµ‹è¯„æ¡ˆä¾‹ï¼ŒEvaluation æ˜¯è¯„ä¼°ç®—æ³• | âœ… Assessment.Status<br>âœ… Evaluator.Evaluate() |
| **Plan vs AssessmentPlan** | æ¶‰åŠæµ‹è¯„è®¡åˆ’æ—¶ä½¿ç”¨å®Œæ•´åç§° | âœ… AssessmentPlan.PlanID<br>âŒ Plan.IDï¼ˆé™¤éä¸Šä¸‹æ–‡æ˜ç¡®ï¼‰ |
| **Screening vs Project** | ç­›æŸ¥é¡¹ç›®ç»Ÿä¸€ä½¿ç”¨ ScreeningProject | âœ… ScreeningProject.ProjectID<br>âŒ Screening.ID |

### 10.5 é¢†åŸŸå¯¹è±¡å…³ç³»æœ¯è¯­

| å…³ç³»ç±»å‹ | æœ¯è¯­ | è¯´æ˜ | ç¤ºä¾‹ |
|---------|------|------|------|
| **èšåˆæ ¹** | Aggregate Root | æ‹¥æœ‰å…¨å±€å”¯ä¸€ IDï¼Œä½œä¸ºèšåˆè¾¹ç•Œçš„å…¥å£ | Questionnaire, AnswerSheet, Assessment |
| **å®ä½“** | Entity | æœ‰ ID ä½†ä¸æ˜¯èšåˆæ ¹ï¼Œä»å±äºèšåˆæ ¹ | AssessmentScore, AnswerItem |
| **å€¼å¯¹è±¡** | Value Object | æ—  IDï¼Œé€šè¿‡å±æ€§ç›¸ç­‰æ€§åˆ¤æ–­ï¼Œä¸å¯å˜ | TesteeRef, FillerRef, Principal |
| **é¢†åŸŸæœåŠ¡** | Domain Service | è·¨èšåˆçš„é¢†åŸŸé€»è¾‘ï¼Œæ— çŠ¶æ€ | Evaluatorï¼ˆè¯„ä¼°ç®—æ³•ï¼‰ |
| **åº”ç”¨æœåŠ¡** | Application Service | ç¼–æ’ç”¨ä¾‹ï¼Œåè°ƒèšåˆä¸åŸºç¡€è®¾æ–½ | TesteeAppService, PlanAppService |
| **ä»“å‚¨** | Repository | èšåˆçš„æŒä¹…åŒ–æŠ½è±¡æ¥å£ | TesteeRepository, AssessmentRepository |
| **é¢†åŸŸäº‹ä»¶** | Domain Event | èšåˆçŠ¶æ€å˜æ›´çš„é€šçŸ¥ | AssessmentSubmittedEvent |

---

**æœ¬æ–‡æ¡£å®šç¨¿ï¼Œæ‰€æœ‰åç»­è®¾è®¡ä¸å®ç°å‡ä»¥æ­¤ä¸ºå‡†ã€‚**
