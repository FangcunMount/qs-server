# questionnaire-scale é—®å·æ”¶é›†&é‡è¡¨æµ‹è¯„ç³»ç»Ÿ

questionnaire and scale system, æ”¯æŒé—®å·æ”¶é›†ã€é‡è¡¨æµ‹è¯„ã€æ•°æ®åˆ†æã€æ•°æ®å¯è§†åŒ–ç­‰åŠŸèƒ½ã€‚

## è½¯ä»¶æ¶æ„

### ç³»ç»Ÿæ¶æ„

![ç³»ç»Ÿæ¶æ„](./docs/images/system-architecture.png)

### ç³»ç»Ÿç»„ä»¶è¯´æ˜

åºå·|åˆ†ç±»|ç»„ä»¶|èŒè´£|æ‰¿è½½åŠŸèƒ½
--|--|--|--|--
1|æ ¸å¿ƒç»„ä»¶|api-server|æ ¸å¿ƒé¢†åŸŸæœåŠ¡|é—®å·èšåˆæ ¹ã€é‡è¡¨èšåˆæ ¹ã€ç­”å·èšåˆæ ¹ã€è§£è¯»æŠ¥å‘Šèšåˆæ ¹
2|æ ¸å¿ƒç»„ä»¶|collection-server|é—®å·æ”¶é›†æœåŠ¡|æ£€éªŒæ¨¡å—
3|æ ¸å¿ƒç»„ä»¶|evaluation-server|æµ‹è¯„è§£è¯»æœåŠ¡|è®¡ç®—æ¨¡å—ã€è§£ææ¨¡å—
4|æ—è·¯ç»„ä»¶|qs-collection-system|é—®å·å°ç¨‹åº|é—®å·ç¼“å­˜é¢„çƒ­ã€é—®å·ç¼“å­˜æ›´æ–°ã€ç­”å·æ ¡éªŒã€ç­”å·ä¿å­˜ã€ç­”å·æŸ¥çœ‹ã€è§£è¯»æŠ¥å‘ŠæŸ¥çœ‹
5|æ—è·¯ç»„ä»¶|qs-operating-system|é—®å·&é‡è¡¨åå°|é—®å·ã€é‡è¡¨ã€ç­”å·ã€è§£è¯»æŠ¥å‘Šçš„åå°ç¼–è¾‘
6|æ—è·¯ç»„ä»¶|qs-sdk-php|PHPç‰ˆSDK|é—®å·ã€é‡è¡¨ã€ç­”å·ã€è§£è¯»æŠ¥å‘Šçš„SDK

### åˆ†å±‚æ¶æ„

![åˆ†å±‚æ¶æ„å›¾](./docs/images/layered-architecture.png)

#### åˆ†å±‚æ¶æ„è¯´æ˜

å±‚çº§|èŒè´£
--|--
å¤–éƒ¨æ¥å£å±‚|æ¥æ”¶ç”¨æˆ·è¯·æ±‚ï¼ˆWeb/SDKï¼‰ï¼Œé€šè¿‡ REST æ¥å£å‘èµ·æ“ä½œ
åº”ç”¨æœåŠ¡å±‚|æ‰¿æ¥è¯·æ±‚é€»è¾‘ï¼Œå®Œæˆç¼“å­˜å¤„ç†ã€è°ƒç”¨é¢†åŸŸæœåŠ¡ã€äº‹ä»¶å‘å¸ƒ
é¢†åŸŸæœåŠ¡å±‚|æ‰¿è½½é¢†åŸŸèšåˆæ“ä½œï¼Œå®šä¹‰ç³»ç»Ÿæ ¸å¿ƒè¡Œä¸ºå’Œä¸šåŠ¡è§„åˆ™
é¢†åŸŸæ¨¡å‹å±‚|æŒ‰ DDD èšåˆè®¾è®¡ï¼Œå®šä¹‰é—®å·ã€é‡è¡¨ã€ç­”å·ã€æŠ¥å‘Šç»“æ„ä¸è¡Œä¸ºï¼Œå®šä¹‰é¢†åŸŸæœåŠ¡
å­˜å‚¨ä¸åŸºç¡€è®¾æ–½å±‚|æä¾›æ•°æ®å­˜å‚¨ä¸ç¼“å­˜ï¼Œæ”¯æ’‘ Pub/Subã€Redis JSONã€æŒä¹…åŒ–ç­‰

### æ¨¡å—è®¾è®¡

#### èšåˆæ ¹æ¨¡å—ï¼ˆPersisted in MongoDBï¼‰

æ¨¡å—å|è¾“å…¥|è¾“å‡º|è°ƒç”¨ä¾èµ–
--|--|--|--
questionnaire|é—®å·ç»“æ„ã€é—®é¢˜ã€é€‰é¡¹è¡¨å•|é—®å·æ–‡æ¡£|-
medical-scale|é‡è¡¨ç»“æ„ã€å› å­è®¾ç½®|é‡è¡¨æ–‡æ¡£|-
answer-sheet|æäº¤ç­”å·ï¼ˆç”¨æˆ· IDã€ç­”æ¡ˆå†…å®¹ï¼‰|ç­”å·æ–‡æ¡£|-questionnaireã€-medical-scale
interpret-report|ç­”å·ã€å¾—åˆ†ç»“æœã€è§£è¯»è§„åˆ™|è§£è¯»æŠ¥å‘Šæ–‡æ¡£|-answer-sheetã€-medical-scale

#### æ— çŠ¶æ€åŠŸèƒ½æ¨¡å—ï¼ˆStatelessï¼‰

æ¨¡å—å|è¾“å…¥|è¾“å‡º|è°ƒç”¨ä¾èµ–
--|--|--|--
validation|æ ¡éªŒè§„åˆ™ã€æäº¤æ•°æ®|æ ¡éªŒç»“æœ|-
calculation|è¿ç®—è§„åˆ™ã€ç­”é¢˜æ•°æ®|ç­”æ¡ˆå¾—åˆ†ã€å› å­å¾—åˆ†|-
evaluation|è§£è¯»è§„åˆ™ã€å¾—åˆ†æ•°æ®|è§£è¯»æ–‡æ¡ˆ|-
scoring|è§£è¯»æ–‡æ¡ˆ|-|-

## åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½

- **é—®å·ç®¡ç†**: æ”¯æŒé—®å·çš„åˆ›å»ºã€ç¼–è¾‘ã€å‘å¸ƒã€åˆ é™¤ã€ç‰ˆæœ¬æ§åˆ¶ç­‰åŠŸèƒ½
- **é‡è¡¨æµ‹è¯„**: æ”¯æŒåŒ»å­¦é‡è¡¨ã€å¿ƒç†é‡è¡¨ç­‰å¤šç§ä¸“ä¸šé‡è¡¨çš„åˆ›å»ºå’Œç®¡ç†
- **ç­”å·æ”¶é›†**: æ”¯æŒå¤šç§é¢˜å‹çš„ç­”å·æ”¶é›†ï¼ŒåŒ…æ‹¬å•é€‰ã€å¤šé€‰ã€æ–‡æœ¬ã€æ•°å­—ç­‰
- **æ•°æ®æ ¡éªŒ**: æä¾›å¼ºå¤§çš„æ•°æ®æ ¡éªŒåŠŸèƒ½ï¼Œç¡®ä¿ç­”å·æ•°æ®çš„å®Œæ•´æ€§å’Œå‡†ç¡®æ€§
- **æ™ºèƒ½è®¡ç®—**: æ”¯æŒå¤æ‚çš„åˆ†æ•°è®¡ç®—å’Œå› å­åˆ†æç®—æ³•
- **è§£è¯»æŠ¥å‘Š**: è‡ªåŠ¨ç”Ÿæˆä¸“ä¸šçš„è§£è¯»æŠ¥å‘Šï¼Œæ”¯æŒå¤šç§æŠ¥å‘Šæ ¼å¼
- **æ•°æ®å¯è§†åŒ–**: æä¾›ä¸°å¯Œçš„æ•°æ®åˆ†æå’Œå¯è§†åŒ–åŠŸèƒ½

### æŠ€æœ¯ç‰¹æ€§

- **é«˜å¹¶å‘**: æ”¯æŒé«˜å¹¶å‘è®¿é—®ï¼Œé‡‡ç”¨å¼‚æ­¥å¤„ç†å’Œç¼“å­˜ä¼˜åŒ–
- **å¯æ‰©å±•**: å¾®æœåŠ¡æ¶æ„è®¾è®¡ï¼Œæ”¯æŒæ°´å¹³æ‰©å±•
- **é«˜å¯ç”¨**: å¤šå®ä¾‹éƒ¨ç½²ï¼Œæ•…éšœè‡ªåŠ¨æ¢å¤
- **æ•°æ®å®‰å…¨**: å®Œå–„çš„æ•°æ®åŠ å¯†å’Œæƒé™æ§åˆ¶æœºåˆ¶
- **ç›‘æ§å‘Šè­¦**: å…¨é¢çš„ç³»ç»Ÿç›‘æ§å’Œå‘Šè­¦æœºåˆ¶

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **Go**: 1.21+
- **MySQL**: 8.0+
- **MongoDB**: 5.0+
- **Redis**: 6.0+
- **Docker**: 20.10+ (å¯é€‰)

### å®‰è£…éƒ¨ç½²

#### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/yshujie/questionnaire-scale.git
cd questionnaire-scale
```

#### 2. ç¯å¢ƒè¦æ±‚

ç¡®ä¿å·²å®‰è£…å¹¶å¯åŠ¨ä»¥ä¸‹åŸºç¡€è®¾æ–½ç»„ä»¶ï¼ˆç”±ç‹¬ç«‹çš„ infra é¡¹ç›®ç®¡ç†ï¼‰ï¼š

- MySQL 8.0+
- MongoDB 6.0+
- Redis 7.0+
- NSQï¼ˆå¯é€‰ï¼Œç”¨äºæ¶ˆæ¯é˜Ÿåˆ—ï¼‰

> **æ³¨æ„**ï¼šå¼€å‘ç¯å¢ƒä¸­çš„æ‰€æœ‰åŸºç¡€è®¾æ–½ç»„ä»¶ç”±å¤–éƒ¨ infra é¡¹ç›®ç»Ÿä¸€ç®¡ç†ï¼Œæ— éœ€åœ¨æœ¬é¡¹ç›®ä¸­é…ç½®ã€‚

#### 3. é…ç½®ç¯å¢ƒå˜é‡

```bash
# åŠ è½½å¼€å‘ç¯å¢ƒé…ç½®
source configs/env/.env.dev

# æ£€æŸ¥åŸºç¡€è®¾æ–½æ˜¯å¦å°±ç»ª
make check-infra
```

**ç¯å¢ƒå˜é‡é…ç½®è¯´æ˜ï¼š**

- `configs/env/.env.dev` - å¼€å‘ç¯å¢ƒé…ç½®ï¼ˆåŒ…å«æ‰€æœ‰åŸºç¡€è®¾æ–½è¿æ¥ä¿¡æ¯ï¼‰
- `configs/env/.env.prod` - ç”Ÿäº§ç¯å¢ƒæ¨¡æ¿
- è¯¦ç»†ä½¿ç”¨è¯´æ˜è¯·æŸ¥çœ‹ [ç¯å¢ƒé…ç½®æ–‡æ¡£](configs/env/README.md)

#### 4. ç¼–è¯‘è¿è¡Œ

```bash
# ç¼–è¯‘æ‰€æœ‰æœåŠ¡
make build

# å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆè‡ªåŠ¨æ£€æŸ¥åŸºç¡€è®¾æ–½ï¼‰
make run-all

# æˆ–å•ç‹¬å¯åŠ¨æœåŠ¡
make run-apiserver       # å¯åŠ¨ API Server (ç«¯å£: 9080)
make run-collection      # å¯åŠ¨ Collection Server (ç«¯å£: 9081)
```

#### 5. éªŒè¯éƒ¨ç½²

```bash
# æ£€æŸ¥æ‰€æœ‰æœåŠ¡çŠ¶æ€
make status-all

# æ£€æŸ¥ API Server å¥åº·çŠ¶æ€
curl http://localhost:9080/health

# æ£€æŸ¥ Collection Server å¥åº·çŠ¶æ€
curl http://localhost:9081/health

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
make logs
```

### åŸºç¡€è®¾æ–½æ£€æŸ¥

åœ¨å¯åŠ¨æœåŠ¡å‰ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥åŸºç¡€è®¾æ–½æ˜¯å¦å°±ç»ªï¼š

```bash
# æ£€æŸ¥æ‰€æœ‰åŸºç¡€è®¾æ–½ç»„ä»¶
make check-infra

# å•ç‹¬æ£€æŸ¥å„ä¸ªç»„ä»¶
make check-mysql     # æ£€æŸ¥ MySQL æ•°æ®åº“
make check-redis     # æ£€æŸ¥ Redis ç¼“å­˜
make check-mongodb   # æ£€æŸ¥ MongoDB æ•°æ®åº“
make check-nsq       # æ£€æŸ¥ NSQ æ¶ˆæ¯é˜Ÿåˆ—
```

**æ£€æŸ¥è¾“å‡ºç¤ºä¾‹ï¼š**

```text
===========================================
æ£€æŸ¥åŸºç¡€è®¾æ–½ç»„ä»¶
===========================================

MySQL           [âœ“] è¿è¡Œæ­£å¸¸ (127.0.0.1:3306)
Redis           [âœ“] è¿è¡Œæ­£å¸¸ (127.0.0.1:6379)
MongoDB         [âœ“] è¿è¡Œæ­£å¸¸ (127.0.0.1:27017)
NSQ             [âœ“] è¿è¡Œæ­£å¸¸ (lookupd:4161, nsqd:4151)

âœ“ æ‰€æœ‰åŸºç¡€è®¾æ–½ç»„ä»¶å°±ç»ªï¼
```

> **æç¤º**ï¼šå¦‚æœæ£€æŸ¥å¤±è´¥ï¼Œè¯·ç¡®ä¿ infra é¡¹ç›®å·²æ­£ç¡®å¯åŠ¨ã€‚è¯¦è§ [ç‹¬ç«‹å¯åŠ¨æœåŠ¡æŒ‡å—](docs/ç‹¬ç«‹å¯åŠ¨æœåŠ¡æŒ‡å—.md)

### å¼€å‘ç¯å¢ƒ

#### 1. å®‰è£…ä¾èµ–

```bash
# å®‰è£… Go ä¾èµ–
go mod download

# å®‰è£…å¼€å‘å·¥å…·
go install github.com/cosmtrek/air@latest
```

#### 2. å¯åŠ¨å¼€å‘æ¨¡å¼

```bash
# API Server çƒ­é‡è½½
make dev-apiserver

# Collection Server çƒ­é‡è½½
make dev-collection-server

# Evaluation Server çƒ­é‡è½½
make dev-evaluation-server
```

## å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```text
questionnaire-scale/
â”œâ”€â”€ api/                    # API å®šä¹‰
â”œâ”€â”€ cmd/                    # æœåŠ¡å…¥å£
â”‚   â”œâ”€â”€ apiserver/         # API Server
â”‚   â”œâ”€â”€ collection-server/ # Collection Server
â”‚   â””â”€â”€ evaluation-server/ # Evaluation Server
â”œâ”€â”€ configs/               # é…ç½®æ–‡ä»¶
â”œâ”€â”€ docs/                  # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ internal/              # å†…éƒ¨åŒ…
â”‚   â”œâ”€â”€ apiserver/        # API Server å®ç°
â”‚   â”œâ”€â”€ collection-server/ # Collection Server å®ç°
â”‚   â””â”€â”€ evaluation-server/ # Evaluation Server å®ç°
â”œâ”€â”€ pkg/                   # å…¬å…±åŒ…
â”œâ”€â”€ scripts/               # è„šæœ¬æ–‡ä»¶
â””â”€â”€ test/                  # æµ‹è¯•æ–‡ä»¶
```

### å¼€å‘è§„èŒƒ

#### ä»£ç è§„èŒƒ

- éµå¾ª Go å®˜æ–¹ä»£ç è§„èŒƒ
- ä½¿ç”¨ `gofmt` æ ¼å¼åŒ–ä»£ç 
- ä½¿ç”¨ `golint` æ£€æŸ¥ä»£ç è´¨é‡
- ä½¿ç”¨ `go vet` æ£€æŸ¥æ½œåœ¨é—®é¢˜

#### æäº¤è§„èŒƒ

```bash
# æäº¤æ ¼å¼
<type>(<scope>): <subject>

# ç¤ºä¾‹
feat(questionnaire): æ·»åŠ é—®å·åˆ›å»ºåŠŸèƒ½
fix(validation): ä¿®å¤æ•°æ®æ ¡éªŒbug
docs(readme): æ›´æ–°é¡¹ç›®æ–‡æ¡£
```

### éƒ¨ç½²æŒ‡å—

#### Docker éƒ¨ç½²

```bash
# æ„å»ºé•œåƒ
docker build -t questionnaire-scale:latest .

# è¿è¡Œå®¹å™¨
docker run -d \
  --name questionnaire-scale \
  -p 8080:8080 \
  -p 8081:8081 \
  -p 8082:8082 \
  questionnaire-scale:latest
```

#### Kubernetes éƒ¨ç½²

```yaml
# deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: questionnaire-scale
spec:
  replicas: 3
  selector:
    matchLabels:
      app: questionnaire-scale
  template:
    metadata:
      labels:
        app: questionnaire-scale
    spec:
      containers:
      - name: questionnaire-scale
        image: questionnaire-scale:latest
        ports:
        - containerPort: 8080
        - containerPort: 8081
        - containerPort: 8082
```

## ç›‘æ§è¿ç»´

### ç›‘æ§æŒ‡æ ‡

#### ç³»ç»ŸæŒ‡æ ‡

- CPU ä½¿ç”¨ç‡
- å†…å­˜ä½¿ç”¨ç‡
- ç£ç›˜ä½¿ç”¨ç‡
- ç½‘ç»œæµé‡

#### ä¸šåŠ¡æŒ‡æ ‡

- é—®å·åˆ›å»ºæ•°é‡
- ç­”å·æäº¤æ•°é‡
- è§£è¯»æŠ¥å‘Šç”Ÿæˆæ•°é‡
- API å“åº”æ—¶é—´
- é”™è¯¯ç‡

### æ—¥å¿—ç®¡ç†

#### æ—¥å¿—çº§åˆ«

- **DEBUG**: è°ƒè¯•ä¿¡æ¯
- **INFO**: ä¸€èˆ¬ä¿¡æ¯
- **WARN**: è­¦å‘Šä¿¡æ¯
- **ERROR**: é”™è¯¯ä¿¡æ¯
- **FATAL**: è‡´å‘½é”™è¯¯

#### æ—¥å¿—æ ¼å¼

```json
{
  "timestamp": "2024-01-01T12:00:00Z",
  "level": "INFO",
  "service": "api-server",
  "message": "é—®å·åˆ›å»ºæˆåŠŸ",
  "request_id": "req-123",
  "user_id": "user-456"
}
```

### å‘Šè­¦é…ç½®

#### å‘Šè­¦è§„åˆ™

- CPU ä½¿ç”¨ç‡ > 80%
- å†…å­˜ä½¿ç”¨ç‡ > 85%
- ç£ç›˜ä½¿ç”¨ç‡ > 90%
- API é”™è¯¯ç‡ > 5%
- å“åº”æ—¶é—´ > 2s

## å¸¸è§é—®é¢˜

### FAQ

**Q: å¦‚ä½•æ·»åŠ æ–°çš„é¢˜å‹ï¼Ÿ**

A: å‚è€ƒ `docs/apiserver/01-é—®å·&ç­”å·çš„è®¾è®¡ä¸å®ç°.md` ä¸­çš„æ‰©å±•æŒ‡å—ã€‚

**Q: å¦‚ä½•ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½ï¼Ÿ**

A: å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¼˜åŒ–ï¼š

- å¢åŠ ç¼“å­˜å±‚
- ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢
- ä½¿ç”¨è¿æ¥æ± 
- å¼‚æ­¥å¤„ç†

**Q: å¦‚ä½•å¤‡ä»½æ•°æ®ï¼Ÿ**

A: å®šæœŸå¤‡ä»½ MySQL å’Œ MongoDB æ•°æ®ï¼š

```bash
# MySQL å¤‡ä»½
mysqldump -u root -p questionnaire > backup.sql

# MongoDB å¤‡ä»½
mongodump --db questionnaire --out backup/
```

## è´¡çŒ®æŒ‡å—

### è´¡çŒ®æµç¨‹

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤ä»£ç 
4. åˆ›å»º Pull Request
5. ä»£ç å®¡æŸ¥
6. åˆå¹¶ä»£ç 

### è´¡çŒ®è§„èŒƒ

- éµå¾ªé¡¹ç›®ä»£ç è§„èŒƒ
- æ·»åŠ å¿…è¦çš„æµ‹è¯•
- æ›´æ–°ç›¸å…³æ–‡æ¡£
- æä¾›æ¸…æ™°çš„æäº¤ä¿¡æ¯

## è”ç³»æ–¹å¼

- **é¡¹ç›®åœ°å€**: <https://github.com/yshujie/questionnaire-scale>
- **é—®é¢˜åé¦ˆ**: <https://github.com/yshujie/questionnaire-scale/issues>
- **é‚®ç®±**: <yshujie@163.com>

## æ›´æ–°æ—¥å¿—

### v1.0.0 (2025-07-21)

- ğŸ‰ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ¨ æ”¯æŒé—®å·åˆ›å»ºå’Œç®¡ç†
- âœ¨ æ”¯æŒç­”å·æ”¶é›†å’Œæ ¡éªŒ
- âœ¨ æ”¯æŒè§£è¯»æŠ¥å‘Šç”Ÿæˆ
- âœ¨ æ”¯æŒå¤šç§é¢˜å‹å’Œç­”æ¡ˆç±»å‹
- ğŸ› ä¿®å¤å·²çŸ¥é—®é¢˜
- ğŸ“š å®Œå–„é¡¹ç›®æ–‡æ¡£

---
