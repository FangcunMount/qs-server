# ============================================================
# qs-worker 开发环境配置
# ============================================================
# 用途：后台任务处理、事件消费、消息队列 Worker
# 维护人：DevOps Team
# 最后更新：2025-01-20
# 主要职责：
#   1. 消费消息队列中的领域事件
#   2. 执行测评计算、缓存刷新等后台任务
#   3. 调用 apiserver gRPC 服务完成业务操作
# ============================================================

# ============================================================
# 1. 应用配置
# ============================================================
# 应用级别的基础配置（开发环境）

# -------------------------------------------------------
# 1.1 服务器模式
# -------------------------------------------------------
server:
  mode: debug  # server mode: release, debug, test

# -------------------------------------------------------
# 1.2 Worker 配置
# -------------------------------------------------------
worker:
  service-name: "qs-worker"   # 服务名称（用于日志和监控）
  concurrency: 5              # 并发处理数（开发环境适度）
  max-retries: 3              # 最大重试次数

# ============================================================
# 2. 消息队列配置
# ============================================================
# NSQ 或 RabbitMQ 消息队列配置（开发环境）

messaging:
  provider: nsq               # 消息队列提供者: nsq, rabbitmq
  # NSQ 配置（开发环境默认）
  nsq-addr: "127.0.0.1:4150"           # NSQ Daemon 地址
  nsq-lookupd-addr: "127.0.0.1:4161"   # NSQ Lookupd 地址
  # RabbitMQ 配置（可选）
  rabbitmq-url: "amqp://guest:guest@localhost:5672/"

# ============================================================
# 3. gRPC 客户端配置
# ============================================================
# 调用 apiserver 的 gRPC 服务

grpc:
  apiserver-addr: "127.0.0.1:9090"  # qs-apiserver gRPC 地址

# ============================================================
# 4. 存储配置
# ============================================================
# MySQL、MongoDB、Redis 数据库配置（开发环境）

# -------------------------------------------------------
# 4.1 MySQL 数据库
# -------------------------------------------------------
mysql:
  host: "127.0.0.1:3306"          # MySQL 服务器地址
  username: "app_user"             # 数据库用户名
  password: "dev_app_pass_123"     # 数据库密码
  database: "qs"  # 数据库名称
  max-idle-connections: 10         # 最大空闲连接数
  max-open-connections: 50         # 最大打开连接数
  max-connection-life-time: "1h"   # 连接最大生存时间
  log-level: 4                     # 日志级别 (1=Silent, 2=Error, 3=Warn, 4=Info)

# -------------------------------------------------------
# 4.2 MongoDB 数据库
# -------------------------------------------------------
# 支持两种方式：分离参数（推荐）或直接 URL
mongodb:
  host: "127.0.0.1:27017"
  username: "app_user"
  password: "dev_app_pass_123"
  database: "questionnaire_scale"
  # url: ""  # 可选，如果设置则优先使用
  use-ssl: false
  ssl-insecure-skip-verify: false
  ssl-allow-invalid-hostnames: false
  ssl-ca-file: ""
  ssl-pem-keyfile: ""
  # MongoDB 日志配置
  enable-logger: true               # 开发环境启用 MongoDB 命令日志
  slow-threshold: 200ms             # 慢查询阈值
  
  # 详细日志配置（component-base v0.4.1+ 已支持）
  log-command-detail: true          # 开发环境启用查询详情（便于调试）
  log-reply-detail: false           # 记录响应详情（通常不需要）
  log-started: false                # 记录命令开始事件（减少日志量）

# -------------------------------------------------------
# 4.3 Redis 缓存（Cache Redis）
# -------------------------------------------------------
# 用途：缓存、会话、限流等临时数据
redis:
  cache:
    host: "127.0.0.1"
    port: 6379
    username: "app"  # Redis 6.0+ ACL 用户名
    password: "dev_app_123"
    database: 0  # 缓存使用 DB 0
    max-idle: 50
    max-active: 100
    timeout: 5
    enable-cluster: false
    use-ssl: false
    enable-logging: true  # 开发环境启用日志便于调试
  
  # -------------------------------------------------------
  # 4.4 Redis 存储（Store Redis）
  # -------------------------------------------------------
  # 用途：持久化存储、队列、发布订阅等
  store:
    host: "127.0.0.1"
    port: 6380  # 使用 Store Redis 实例（端口 6380）
    username: "app"  # Redis 6.0+ ACL 用户名
    password: "dev_app_123"
    database: 0  # Store Redis 使用 DB 0
    max-idle: 50
    max-active: 100
    timeout: 5
    enable-cluster: false
    use-ssl: false
    enable-logging: true  # 开发环境启用日志便于调试

# -------------------------------------------------------
# 4.5 缓存控制
# -------------------------------------------------------
cache:
  disable_statistics_cache: false  # 若想暂停统计缓存，请设为 true

# ============================================================
# 5. 系统配置
# ============================================================
# 日志等系统级配置（开发环境）

# -------------------------------------------------------
# 5.1 日志配置（开发环境 - 控制台友好）
# -------------------------------------------------------
# 说明：开发环境使用 console 格式，启用颜色便于阅读
log:
  disable-caller: false         # 开发环境显示调用者信息
  disable-stacktrace: false     # 开发环境显示堆栈
  level: debug                  # 日志级别: debug, info, warn, error, fatal, panic
  format: console               # 日志格式: console(开发), json(生产)
  enable-color: true            # 开发环境启用颜色
  development: true             # 开发模式
  name: "qs-worker"             # 日志名称
  max-size: 100                 # 单个日志文件最大 100MB
  max-age: 7                    # 保留 7 天
  max-backups: 3                # 保留 3 个备份文件
  compress: false               # 开发环境不压缩
  output-paths:
    - stdout
  error-output-paths:
    - stderr
