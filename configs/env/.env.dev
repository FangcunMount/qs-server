# ==========================================
# QS-Server 开发环境配置
# Development Environment Configuration
# ==========================================
# 
# 使用说明：
# 1. 本文件包含开发环境的所有基础设施连接信息
# 2. 密码等敏感信息仅供开发环境使用
# 3. 生产环境请使用独立的 .env.prod 文件
# 4. 使用方式: source configs/env/.env.dev 或在脚本中加载
#
# ==========================================

# ==========================================
# 🌍 环境基础配置
# ==========================================
APP_ENV=development
NODE_ENV=development
ENV=dev
LOG_LEVEL=debug
DEBUG=true
TZ=Asia/Shanghai
LANG=zh_CN.UTF-8

# ==========================================
# 📍 服务端口配置
# ==========================================
# QS API Server
QS_APISERVER_HTTP_PORT=18082
QS_APISERVER_HTTPS_PORT=18442
QS_APISERVER_GRPC_PORT=9090
QS_APISERVER_GRPC_HEALTH_PORT=9091

# Collection Server
COLLECTION_SERVER_HTTP_PORT=18083
COLLECTION_SERVER_HTTPS_PORT=18443

# ==========================================
# 🗄️  MySQL 数据库配置（来自 infra 项目）
# ==========================================
MYSQL_HOST=127.0.0.1
MYSQL_PORT=3306
MYSQL_ROOT_PASSWORD=dev_root_123

# QS-Server 应用数据库配置
MYSQL_DATABASE=questionnaire_scale
MYSQL_USER=app_user
MYSQL_PASSWORD=dev_app_pass_123

# MySQL 连接配置
MYSQL_MAX_IDLE_CONNECTIONS=10
MYSQL_MAX_OPEN_CONNECTIONS=100
MYSQL_MAX_CONNECTION_LIFE_TIME=1h
MYSQL_LOG_LEVEL=4

# ==========================================
# 🔐 Redis 配置（双实例架构）
# ==========================================

# Redis Cache 实例（端口 6379 - 来自 infra 项目）
REDIS_CACHE_HOST=127.0.0.1
REDIS_CACHE_PORT=6379
REDIS_CACHE_USERNAME=app
REDIS_CACHE_PASSWORD=dev_app_123
REDIS_CACHE_DB=0
REDIS_CACHE_DATABASE=0
REDIS_CACHE_MAX_IDLE=50
REDIS_CACHE_MAX_ACTIVE=100
REDIS_CACHE_TIMEOUT=5

# Redis Store 实例（端口 6380 - 来自 infra 项目）
REDIS_STORE_HOST=127.0.0.1
REDIS_STORE_PORT=6380
REDIS_STORE_USERNAME=app
REDIS_STORE_PASSWORD=dev_app_123
REDIS_STORE_DB=0
REDIS_STORE_DATABASE=0
REDIS_STORE_MAX_IDLE=50
REDIS_STORE_MAX_ACTIVE=100
REDIS_STORE_TIMEOUT=5

# Redis 旧版兼容配置（单实例模式）
REDIS_HOST=127.0.0.1
REDIS_PORT=6379
REDIS_USERNAME=app
REDIS_PASSWORD=dev_app_123
REDIS_DATABASE=0
REDIS_MAX_IDLE=50
REDIS_MAX_ACTIVE=100

# ==========================================
# 🍃 MongoDB 配置（来自 infra 项目）
# ==========================================
MONGO_HOST=127.0.0.1
MONGO_PORT=27017
MONGO_INITDB_ROOT_USERNAME=root
MONGO_INITDB_ROOT_PASSWORD=dev_mongo_123

# QS-Server 应用数据库配置
MONGO_DATABASE=questionnaire_scale
MONGO_USER=app_user
MONGO_PASSWORD=dev_app_pass_123

# MongoDB 连接 URL（应用使用）
MONGO_URL=mongodb://app_user:dev_app_pass_123@127.0.0.1:27017/questionnaire_scale?authSource=admin
MONGO_USE_SSL=false
MONGO_SSL_INSECURE_SKIP_VERIFY=false
MONGO_SSL_ALLOW_INVALID_HOSTNAMES=false

# ==========================================
# 📬 NSQ 配置（来自 infra 项目）
# ==========================================
NSQ_HOST=127.0.0.1
NSQLOOKUPD_TCP_PORT=4160
NSQLOOKUPD_HTTP_PORT=4161
NSQD_TCP_PORT=4150
NSQD_HTTP_PORT=4151
NSQADMIN_PORT=4171

# NSQ 连接地址
NSQLOOKUPD_TCP_ADDRESS=127.0.0.1:4160
NSQD_TCP_ADDRESS=127.0.0.1:4150
NSQLOOKUPD_HTTP_ADDRESS=http://127.0.0.1:4161
NSQD_HTTP_ADDRESS=http://127.0.0.1:4151

# ==========================================
# 🔑 JWT 配置
# ==========================================
# API Server JWT
JWT_REALM="qs jwt"
JWT_SECRET_KEY=questionnaire-scale-jwt-secret-key-2024-dev
JWT_TIMEOUT=24h
JWT_MAX_REFRESH=168h

# Collection Server JWT
COLLECTION_JWT_SECRET_KEY=qs-collection-server-jwt-secret-key-2024-dev
COLLECTION_JWT_TOKEN_DURATION=168

# ==========================================
# 📊 日志配置
# ==========================================
LOG_NAME=qs-server
LOG_FORMAT=console
LOG_ENABLE_COLOR=true
LOG_DISABLE_CALLER=false
LOG_DISABLE_STACKTRACE=false
LOG_DEVELOPMENT=true

# 日志文件配置
LOG_DIR=/data/logs/qs
LOG_MAX_SIZE=100
LOG_MAX_AGE=30
LOG_MAX_BACKUPS=10
LOG_COMPRESS=true

# ==========================================
# 🚀 数据库迁移配置
# ==========================================
MIGRATION_ENABLED=true
MIGRATION_AUTOSEED=true
MIGRATION_DATABASE=questionnaire_scale

# ==========================================
# 🔒 TLS/SSL 证书配置
# ==========================================
TLS_CERT_DIR=./configs/cert
QS_APISERVER_CERT_FILE=./configs/cert/qs-apiserver.crt
QS_APISERVER_KEY_FILE=./configs/cert/qs-apiserver.key
COLLECTION_SERVER_CERT_FILE=./configs/cert/collection-server.crt
COLLECTION_SERVER_KEY_FILE=./configs/cert/collection-server.key

# ==========================================
# 🌐 GRPC 客户端配置
# ==========================================
GRPC_CLIENT_ENDPOINT=127.0.0.1:9090
GRPC_CLIENT_TIMEOUT=30
GRPC_CLIENT_INSECURE=true

# ==========================================
# 🏗️  服务器模式配置
# ==========================================
SERVER_MODE=debug
SERVER_HEALTHZ=true
SERVER_MAX_PING_COUNT=3

# Gin 中间件配置
SERVER_MIDDLEWARES=recovery,enhanced_logger,secure,nocache,cors,dump

# ==========================================
# 💾 数据与日志路径
# ==========================================
DATA_ROOT_PATH=/data
LOG_ROOT_PATH=/data/logs
INFRA_DATA_ROOT=/data/infra
INFRA_LOG_ROOT=/data/logs

# ==========================================
# 📝 开发环境说明
# ==========================================
# 
# 1. 基础设施依赖：
#    - 本配置文件假设 infra 项目已启动
#    - 所有端口和密码与 infra 项目的 .env.dev 保持一致
# 
# 2. 密码安全：
#    - 当前密码仅供开发环境使用
#    - 生产环境必须使用强密码
#    - 不要将此文件提交到公共仓库
# 
# 3. 使用方式：
#    - 方式1: source configs/env/.env.dev
#    - 方式2: 在代码中使用 godotenv 等库加载
#    - 方式3: 在 Makefile 中通过 include 指令加载
# 
# 4. 配置优先级：
#    - 环境变量 > 配置文件 > 默认值
#    - 可以通过环境变量覆盖此文件中的配置
# 
# 5. 健康检查：
#    - 使用 make check-infra 检查所有基础设施
#    - 启动服务前会自动检查基础设施状态
# 
# ==========================================
