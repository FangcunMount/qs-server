# ============================================================
# qs-worker 生产环境配置
# ============================================================
# 用途：后台任务处理、事件消费、消息队列 Worker
# 维护人：DevOps Team
# 最后更新：2025-01-20
# 说明：Worker 无对外暴露端口，仅消费消息队列
# ============================================================

# ============================================================
# 1. 应用配置
# ============================================================
# 应用级别的基础配置

# -------------------------------------------------------
# 1.1 服务器模式
# -------------------------------------------------------
server:
  mode: release  # server mode: release, debug, test

# -------------------------------------------------------
# 1.2 Worker 配置
# -------------------------------------------------------
worker:
  service-name: "qs-worker"   # 服务名称（用于日志和监控）
  concurrency: 10             # 并发处理数（生产环境提高）
  max-retries: 5              # 最大重试次数

# ============================================================
# 2. 消息队列配置
# ============================================================
# NSQ 或 RabbitMQ 消息队列配置

messaging:
  provider: nsq  # 消息队列提供者: nsq, rabbitmq
  nsq-addr: "127.0.0.1:4150"
  nsq-lookupd-addr: "127.0.0.1:4161"
  rabbitmq-url: "amqp://guest:guest@127.0.0.1:5672/"

# ============================================================
# 3. gRPC 客户端配置
# ============================================================
# 调用 apiserver 的 gRPC 服务

grpc:
  apiserver-addr: "qs-apiserver:9090"  # Docker 容器服务名

# ============================================================
# 4. 存储配置
# ============================================================
# MySQL、MongoDB、Redis 数据库配置

# -------------------------------------------------------
# 4.1 MySQL 数据库
# -------------------------------------------------------
mysql:
  host: "127.0.0.1:3306"
  username: "app_user"
  password: ""
  database: "qs"
  max-idle-connections: 20
  max-open-connections: 100
  max-connection-life-time: "1h"
  log-level: 2  # 生产环境只记录 Error

# -------------------------------------------------------
# 4.2 MongoDB 数据库
# -------------------------------------------------------
# 支持两种方式：分离参数（推荐）或直接 URL
mongodb:
  host: "127.0.0.1:27017"
  username: "app_user"
  password: ""
  database: "questionnaire_scale"
  # url: ""  # 可选，如果设置则优先使用
  use-ssl: false
  ssl-insecure-skip-verify: false
  ssl-allow-invalid-hostnames: false
  ssl-ca-file: ""
  ssl-pem-keyfile: ""
  # MongoDB 日志配置
  enable-logger: true             # 生产环境启用 MongoDB 命令日志
  slow-threshold: 500ms           # 生产环境慢查询阈值（可以调高）

# -------------------------------------------------------
# 4.3 Redis 缓存（Cache Redis）
# -------------------------------------------------------
# 用途：缓存、会话、限流等临时数据
redis:
  cache:
    host: "127.0.0.1"
    port: 6379
    username: ""
    password: ""
    database: 0
    max-idle: 50
    max-active: 100
    timeout: 5
    enable-cluster: false
    use-ssl: false
    enable-logging: false

  # -------------------------------------------------------
  # 4.4 Redis 存储（Store Redis）
  # -------------------------------------------------------
  # 用途：持久化存储、队列、发布订阅等
  store:
    host: "127.0.0.1"
    port: 6380
    username: ""
    password: ""
    database: 1
    max-idle: 50
    max-active: 100
    timeout: 5
    enable-cluster: false
    use-ssl: false
    enable-logging: false

# ============================================================
# 5. 系统配置
# ============================================================
# 日志等系统级配置

# -------------------------------------------------------
# 5.1 日志配置（生产环境 - JSON 格式）
# -------------------------------------------------------
# 说明：生产环境使用 JSON 格式便于日志采集和分析
log:
  disable-caller: true          # 生产环境禁用调用者信息（性能优化）
  disable-stacktrace: true      # 仅在 panic 时记录堆栈
  level: info                   # 日志级别: debug, info, warn, error, fatal, panic
  format: json                  # 日志格式: console(开发), json(生产)
  enable-color: false           # 生产环境禁用颜色
  development: false            # 生产模式
  name: "qs-worker"             # 日志名称
  max-size: 100                 # 单个日志文件最大 100MB
  max-age: 30                   # 保留 30 天
  max-backups: 10               # 保留 10 个备份文件
  compress: true                # 压缩旧文件节省空间
  enable-time-rotation: true
  time-rotation-format: "2006-01-02"
  enable-level-output: true
  level-output-mode: "duplicate"
  level-output-paths:
    all:
      - stdout
      - /data/logs/qs/qs-worker.log
    warn:
      - /data/logs/qs/qs-worker-warn.log
    error:
      - stderr
      - /data/logs/qs/qs-worker-error.log
